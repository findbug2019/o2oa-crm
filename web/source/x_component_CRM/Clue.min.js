MWF.xApplication.CRM=MWF.xApplication.CRM||{},MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xDesktop.requireApp("CRM","Template",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xApplication.CRM.Clue=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,n){this.setOptions(n),this.app=e,this.lp=this.app.lp.clue,this.path="/x_component_CRM/$Clue/",this.loadCss(),this.actions=i,this.node=$(t),this.ddown=null},loadCss:function(){this.cssPath="/x_component_CRM/$Clue/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){this.formContentArr&&this.formContentArr.empty(),this.formContentArr=[],this.formMarkArr&&this.formMarkArr.empty(),this.formMarkArr=[],this.rightContentDiv=this.app.rightContentDiv,this.createHeadContent(),this.createClueContent(),this.loadEvent(),this.resizeWindow(),this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this)),jQuery("body").unbind("click")},reload:function(){this.createClueContent(),this.resizeWindow()},loadEvent:function(){},createHeadContent:function(){(that=this).headContentDiv&&this.headContentDiv.destroy(),this.headContentDiv=new Element("div.headContentDiv",{styles:this.css.headContentDiv}).inject(this.rightContentDiv),this.headTitleDiv=new Element("div.headTitleDiv",{styles:this.css.headTitleDiv,text:this.lp.head.headTitle}).inject(this.headContentDiv),this.headSearchDiv=new Element("div.headSearchDiv",{styles:this.css.headSearchDiv}).inject(this.headContentDiv),this.headSearchTextDiv=new Element("div.headSearchTextDiv",{styles:this.css.headSearchTextDiv}).inject(this.headSearchDiv),this.headSearchImg=new Element("img.headSearchImg",{styles:this.css.headSearchImg,src:this.path+"default/icons/search.png"}).inject(this.headSearchTextDiv),this.headSearchInput=new Element("input.headSearchInput",{styles:this.css.headSearchInput,placeholder:this.lp.head.searchText}).inject(this.headSearchTextDiv),this.headSearchInput.addEvents({keyup:function(){""!=this.headSearchInput.get("value")&&this.headSearchRemoveImg.setStyles({display:"inline-block"})}.bind(this)}),this.headSearchRemoveImg=new Element("img.headSearchRemoveImg",{styles:this.css.headSearchRemoveImg,src:this.path+"default/icons/remove.png"}).inject(this.headSearchTextDiv),this.headSearchRemoveImg.addEvents({click:function(){this.headSearchInput.set("value","")}.bind(this)}),this.headSearchBottonDiv=new Element("div.headSearchBottonDiv",{styles:this.css.headSearchBottonDiv,text:this.lp.head.search}).inject(this.headSearchDiv),this.headBottonDiv=new Element("div.headBottonDiv",{styles:this.css.headBottonDiv}).inject(this.headContentDiv),this.headNewBottonDiv=new Element("div.headNewBottonDiv",{styles:this.css.headNewBottonDiv,text:this.lp.head.create}).inject(this.headBottonDiv),this.headNewBottonDiv.addEvents({click:function(){MWF.xDesktop.requireApp("CRM","ClueEdit",function(){this.explorer=new MWF.xApplication.CRM.ClueEdit(this,this.actions,{},{isEdited:!0,isNew:!0,onReloadView:function(){this.reload()}.bind(this)}),this.explorer.load()}.bind(this))}.bind(this)}),this.headMoreBottonDiv=new Element("div.headMoreBottonDiv",{styles:this.css.headMoreBottonDiv,text:this.lp.head.moreAction}).inject(this.headBottonDiv),this.headMoreImg=new Element("img.headMoreImg",{styles:this.css.headMoreImg,src:this.path+"default/icons/arrow.png"}).inject(this.headMoreBottonDiv),this.headMoreConentDiv=new Element("ul.el-dropdown-type",{styles:{display:"none",width:"105px"},id:"inputleads"}).inject(this.rightContentDiv),this.headInputLi=new Element("li.el-dropdown-menu__item",{styles:{"font-size":"13px"},text:"导入"}).inject(this.headMoreConentDiv),this.arrowDiv=new Element("div.popper__arrow",{styles:{"box-sizing":"border-box !important","border-bottom-style":"none"}}).inject(this.headMoreConentDiv),this.ddown=jQuery("body")[0].getElement("#inputleads"),this.ddown&&this.ddown.setStyles({top:jQuery(".headMoreBottonDiv").offset().top+30+"px",left:jQuery(".headMoreBottonDiv").offset().left-49+"px"}),this.headMoreBottonDiv.addEvents({click:function(){jQuery(this.ddown).toggle(100)}.bind(this)}),input=this,jQuery(this.ddown).find(".el-dropdown-menu__item").click(function(){"导入"==jQuery(this).text()&&input.inputObject(),jQuery(this).text()})},inputObject:function(){that=this;Showbo.Msg.confirm("导入线索",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 0px 10px;line-height:20px;font-size:13px;"><div class="handle-item-name" style="margin-top: 8px;width:30px;">一、</div><div style="margin-top: 8px;width:460px;">请按照数据模板的格式准备要导入的数据。点击下载<a href="/x_component_CRM/%E7%BA%BF%E7%B4%A2%E5%AF%BC%E5%85%A5%E6%A8%A1%E6%9D%BF.xlsx">《线索导入模板》</a></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 0px 20px 0px 10px;line-height:20px;font-size:13px;"><div class="handle-item-name" style="margin-top: 8px;width:30px;"> </div><div style="margin-top: 8px;width:460px;font-size:12px;color:#a9a9a9;line-height:10px;">注意事项：<p>1、模板中的表头名称不能更改，表头行不能删除</p><p>2、其中标*为必填项，必须填写</p></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 0px 20px 0px 10px;line-height:20px;font-size:13px;"><div class="handle-item-name" style="margin-top: 8px;width:30px;">二、</div><div style="margin-top: 8px;;width:460px;">请选择需要导入的文件</div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 0px 20px 30px 10px;line-height:20px;font-size:13px;"><div class="handle-item-name" style="margin-top: 8px;width:30px;"> </div><div style="margin-top: 8px;;width:460px;"><div class="el-input is-disabled" style="display: inline-block;padding-right: 20px;"><input type="text" disabled="disabled" autocomplete="off" class="el-input__inner" style="width: 270px;min-height:25px;" /></div><div style="display: inline-block;color: #fff;background-color: #3e84e9;border-color: #3e84e9;padding: 5px 10px;"><input type="file" id="bar-file" accept="*.*" multiple="multiple" class="bar-input" style="position: absolute;height: 30px;width: 72px;opacity: 0;font-size: 0;cursor: pointer;" /><div><div>选择文件</div></div></div></div></div>',function(){that.inputData()},function(){jQuery(that.ddown).toggle(100)},550),jQuery("#dvMsgCT").find(".bar-input").change(function(t){var e=t.target.files;if(e&&0<e.length){var i=e[0];jQuery("#dvMsgCT").find(".el-input__inner").val(i.name)}})},inputData:function(){that=this;var t=jQuery("#dvMsgCT").find("#bar-file")[0].files;if(t&&0<t.length){var e=t[0];({file:e,fileName:e.name});var i=new FormData;i.append("fileName",e.name),i.append("file",e),that.actions.inputLeads(i,e,function(t){"success"==t.type&&Showbo.Msg.alert("导入成功!",jQuery("#clue").click()),jQuery(that.ddown).toggle(100)}.bind(that))}else jQuery(that.ddown).toggle(100)},createToolBarContent:function(){},createClueContent:function(){this.contentListDiv&&this.contentListDiv.destroy(),this.contentListDiv=new Element("div.contentListDiv",{styles:this.css.contentListDiv}).inject(this.rightContentDiv),this.contentListInDiv&&this.contentListInDiv.destroy(),this.contentListInDiv=new Element("div.contentListInDiv",{styles:this.css.contentListInDiv}).inject(this.contentListDiv);var t=this.rightContentDiv.getSize();this.contentListDiv&&this.contentListDiv.setStyles({height:t.y-this.headContentDiv.getHeight()-8+"px"}),this.contentListInDiv&&this.contentListInDiv.setStyles({height:this.contentListDiv.getHeight()+"px",width:"100%"}),this.clueView&&delete this.clueView;var e=this.path+"clueView.json";this.clueView=new MWF.xApplication.CRM.Clue.View(this.contentListInDiv,this.openDiv,this.app,this,{templateUrl:e,filterData:{}},{lp:this.app.lp.clueView,isAdmin:this.options.isAdmin}),this.clueView.load()},resizeWindow:function(){var t=this.rightContentDiv.getSize(),e=this.headTitleDiv.getSize(),i=this.headBottonDiv.getSize();if(this.headSearchDiv){var n=this.headSearchDiv.getSize().x;this.headSearchDiv.setStyles({"margin-left":(t.x-e.x-i.x)/2-n/2+"px"})}this.contentListDiv&&this.contentListDiv.setStyles({height:t.y-this.headContentDiv.getHeight()-8+"px"}),this.contentListInDiv&&this.contentListInDiv.setStyles({height:this.contentListDiv.getHeight()+"px"})}}),MWF.xApplication.CRM.Clue.View=new Class({Extends:MWF.xApplication.CRM.Template.ComplexView,_createDocument:function(t){return new MWF.xApplication.CRM.Clue.Document(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(e,t,i,n,s){this.category=this.options.category;t||(t=15),i||(i=1);this.items.length&&this.items[this.items.length-1].data.id;var h=this.options.filterData;h={key:n?n.trim():"",orderFieldName:"updateTime",orderType:"desc"},s||(s="我负责的线索"),"下属负责的线索"==s&&this.actions.ListNestedSubPerson(i,t,h,function(t){e&&e(t)}.bind(this)),"我负责的线索"==s&&this.actions.ListMyDuty(i,t,h,function(t){e&&e(t)}.bind(this)),"已转化的线索"==s&&this.actions.ListTransfer(i,t,h,function(t){e&&e(t)}.bind(this)),"全部线索"==s&&(this.isAdmin?this.actions.getClueListPage(i,t,h,function(t){e&&e(t)}.bind(this)):this.actions.ListAllMy(i,t,h,function(t){e&&e(t)}.bind(this)))},_create:function(){},_openDocument:function(t,e){MWF.xDesktop.requireApp("CRM","ClueOpen",function(){this.explorer=new MWF.xApplication.CRM.ClueOpen(this,this.actions,{},{clueId:t,clueName:e,openType:"single",onReloadView:function(){this.reload()}.bind(this)}),this.explorer.load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.CRM.Clue.Document=new Class({});