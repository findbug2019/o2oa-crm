MWF.xApplication.CRM=MWF.xApplication.CRM||{},MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xDesktop.requireApp("CRM","Template",null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xApplication.CRM.Publicseas=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.setOptions(s),this.app=e,this.lp=e.lp.publicseas,this.path="/x_component_CRM/$Publicseas/",this.loadCss(),this.actions=i,this.node=$(t)},loadCss:function(){this.cssPath="/x_component_CRM/$Publicseas/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){this.formContentArr&&this.formContentArr.empty(),this.formContentArr=[],this.formMarkArr&&this.formMarkArr.empty(),this.formMarkArr=[],this.rightContentDiv=this.app.rightContentDiv,this.createHeadContent(),this.createPublicseasContent(),this.resizeWindow(),this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},reload:function(){this.createPublicseasContent(),this.resizeWindow()},createHeadContent:function(){this.headContentDiv&&this.headContentDiv.destroy(),this.headContentDiv=new Element("div.headContentDiv",{styles:this.css.headContentDiv}).inject(this.rightContentDiv),this.headTitleDiv=new Element("div.headTitleDiv",{styles:this.css.headTitleDiv,text:this.lp.head.headTitle}).inject(this.headContentDiv),this.headSearchDiv=new Element("div.headSearchDiv",{styles:this.css.headSearchDiv}).inject(this.headContentDiv),this.headSearchTextDiv=new Element("div.headSearchTextDiv",{styles:this.css.headSearchTextDiv}).inject(this.headSearchDiv),this.headSearchImg=new Element("img.headSearchImg",{styles:this.css.headSearchImg,src:this.path+"default/icons/search.png"}).inject(this.headSearchTextDiv),this.headSearchInput=new Element("input.headSearchInput",{styles:this.css.headSearchInput,placeholder:this.lp.head.searchText}).inject(this.headSearchTextDiv),this.headSearchInput.addEvents({keyup:function(){""!=this.headSearchInput.get("value")&&this.headSearchRemoveImg.setStyles({display:"inline-block"})}.bind(this)}),this.headSearchRemoveImg=new Element("img.headSearchRemoveImg",{styles:this.css.headSearchRemoveImg,src:this.path+"default/icons/remove.png"}).inject(this.headSearchTextDiv),this.headSearchRemoveImg.addEvents({click:function(){this.headSearchInput.set("value","")}.bind(this)}),this.headSearchBottonDiv=new Element("div.headSearchBottonDiv",{styles:this.css.headSearchBottonDiv,text:this.lp.head.search}).inject(this.headSearchDiv),this.headBottonDiv=new Element("div.headBottonDiv",{styles:this.css.headBottonDiv}).inject(this.headContentDiv)},createToolBarContent:function(){},createPublicseasContent:function(){this.contentListDiv&&this.contentListDiv.destroy(),this.contentListDiv=new Element("div.contentListDiv",{styles:this.css.contentListDiv}).inject(this.rightContentDiv),this.contentListInDiv&&this.contentListInDiv.destroy(),this.contentListInDiv=new Element("div.contentListInDiv",{styles:this.css.contentListInDiv}).inject(this.contentListDiv);var t=this.rightContentDiv.getSize();this.contentListDiv&&this.contentListDiv.setStyles({height:t.y-this.headContentDiv.getHeight()-8+"px"}),this.contentListInDiv&&this.contentListInDiv.setStyles({height:this.contentListDiv.getHeight()+"px",width:"100%"}),this.PublicseasView&&delete this.PublicseasView;var e=this.path+"publicseasView.json";this.publicseasView=new MWF.xApplication.CRM.Publicseas.View(this.contentListInDiv,this.openDiv,this.app,this,{templateUrl:e,filterData:{}},{lp:this.app.lp.publicseasView,isAdmin:this.options.isAdmin}),this.publicseasView.load()},resizeWindow:function(){var t=this.rightContentDiv.getSize(),e=this.headTitleDiv.getSize(),i=this.headBottonDiv.getSize();if(this.headSearchDiv){var s=this.headSearchDiv.getSize().x;this.headSearchDiv.setStyles({"margin-left":(t.x-e.x-i.x)/2-s/2+"px"})}this.contentListDiv&&this.contentListDiv.setStyles({height:t.y-this.headContentDiv.getHeight()-8+"px"}),this.contentListInDiv&&this.contentListInDiv.setStyles({height:this.contentListDiv.getHeight()+"px"})}}),MWF.xApplication.CRM.Publicseas.View=new Class({Extends:MWF.xApplication.CRM.Template.ComplexView,_createDocument:function(t){return new MWF.xApplication.CRM.Clue.Document(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(e,t,i,s,n){this.category=this.options.category;t||(t=15),i||(i=1);this.items.length&&this.items[this.items.length-1].data.id;var h=this.options.filterData;h={key:s?s.trim():"",orderFieldName:"updateTime",orderType:"desc"},n||(n="全部客户"),this.actions.getPublicseasByPage(i,t,h,function(t){e&&e(t)}.bind(this))},_create:function(){},_openDocument:function(t,e){MWF.xDesktop.requireApp("CRM","PublicseasOpen",function(){this.explorer=new MWF.xApplication.CRM.PublicseasOpen(this,this.actions,{},{openId:t,openName:e,openType:"single",onReloadView:function(){this.reload()}.bind(this)}),this.explorer.load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.CRM.Publicseas.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(i,t){this.view.template.items.each(function(t,e){t.head.width&&i.getElements("td")[e].set("width",t.head.width),e==i.getElements("td").length-1&&i.getElements("td")[e].set("width",this.view.lastTdWidth)}.bind(this))},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ForumDocument"+this.data.id;this.app.desktop.apps[t]?this.app.desktop.apps[t].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.data.sectionId,id:this.data.id,appId:t,isEdited:!0,isNew:!1,index:this.index})}});