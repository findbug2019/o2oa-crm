MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xApplication.CRM.ChanceOpen=new Class({Extends:MWF.xApplication.CRM.Template.PopupForm,Implements:[Options,Events],options:{style:"default",width:"800",height:"100%",top:0,left:0,hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0},initialize:function(e,t,i,a){this.setOptions(a),this.explorer=e,this.app=e.app,this.lp=a.lp,this.path="/x_component_CRM/$ChanceEdit/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=i||{},this.actions=t,this.imgArr=[],this.fileArr=[],this.configData=[]},load:function(){(that=this).loadResource(function(){this.createForm(),this.loadEvent()}.bind(this))},loadResource:function(e){e()},createForm:function(){var e=this.options.openName,t=this.getNotifyMax(),i=this.options.openStyle?this.options.openStyle:this.xxx;jQuery(".headMoreImg").notifyMe("right","default",e,'<div class = "headBottonDiv"><div class="headMoveBottonDiv">转移</div><div class="headEditBottonDiv">编辑</div><div class="headMoreBottonDiv"><span>更多</span><img class="headMoreImg" src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div>','<ul class="el-dropdown-menu"><li class="el-dropdown-menu__item">删除</li><div class="popper__arrow"></div></ul>',"",t,500,i),this.createContentHtml(t)},getNotifyMax:function(){var e="notify",s=0;return this.options.openType&&"single"==this.options.openType||(jQuery(".notify").each(function(e,t){var i=jQuery(t).attr("id"),a=0;0<i.indexOf("_")?(a=parseInt(i.split("_")[1]),s<a&&(s=a)):0==s&&(s=1)}),0<s&&(e=e+"_"+s)),e},createContentHtml:function(e){(that=this).sectionArea=jQuery("body")[0].getElement("#"+e),this.actions.getChanceInfo(this.options.openId,function(e){this.data=e.data,console.log("this is data :",this.data);var t=e.data,i=""==t.owneruser||void 0===t.owneruser?"--":t.owneruser.split("@")[0],a="<div class = 'briefdiv'><div class='div-inline'><div class='div-title'>客户名称</div><div class='div-value'>"+t.customer.customername+"</div></div><div class='div-inline'><div class='div-title'>商机金额（元）</div><div class='div-value'>"+t.money+"</div></div><div class='div-inline'><div class='div-title'>商机状态</div><div class='div-value'>"+t.opportunityStatus.opportunitystatusname+"</div></div><div class='div-inline'><div class='div-title'>负责人</div><div class='div-value'>"+i+"</div></div><div class='div-inline'><div class='div-title'>更新时间\n</div><div class='div-value'>"+t.updateTime+"</div></div></div>";this.sectionArea.getElement(".notify-content").set("html",a+"<div class='tabPanel'><div class='hit'>跟进记录</div><div style='width:30px'></div><div>基本信息</div><div style='width:30px'></div><div>联系人</div><div style='width:30px'></div><div>相关团队</div><div style='width:30px'></div><div>附件</div><div style='width:30px'></div><div>操作记录</div></div><div class='panes'><div class='pane' id='tab-follow' style='display:block;'><p>First tab content</p></div><div></div><div class='pane' id='tab-basicinfo'><p>Secend tab content</p></div><div></div><div class='pane' id='tab-contacts'><p>contacts tab content</p></div><div></div><div class='pane' id='tab-team'><p>team tab content</p></div><div></div><div class='pane' id='tab-att'><p>Third tab content</p></div><div></div><div class='pane' id='tab-options'><p>Four tab content</p></div></div>");var s=this.sectionArea.getSize();this.sectionArea.getElement(".panes").setStyles({height:s.y-250+"px"});this.sectionArea.getElement("#tab-follow").set("html",'<div ><div class="mix-container"><div class="i-cont"><div class="el-textarea el-input--suffix"><textarea autocomplete="off" placeholder="请输入内容" class="el-textarea__inner" style="resize: none; min-height: 57px; height: 57px;"></textarea></div></div><div class="vux-flexbox bar-cont vux-flex-row"><div class="vux-flexbox bar-item vux-flex-row"><input type="file" accept="image/*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/img.png" class="bar-img"><div class="bar-title">图片</div></div><div class="splitdiv"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="vux-flexbox bar-item vux-flex-row"  style="padding-left:0px;"><input type="file" id="bar-file" accept="*.*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/file.png" class="bar-img"><div class="bar-title">附件</div></div></div></div><div  class="vux-flexbox se-section vux-flex-row"><div class="se-name">记录类型</div><div class="el-dropdown" style="margin-right: 20px;"><div class="vux-flexbox se-select vux-flex-row el-dropdown-selfdefine " ><div class="se-select-name">微信</div> <div class="el-icon-arrow-down el-icon--right"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div> </div><div class="se-name">下次联系时间</div><div class="el-date-editor se-datepicker el-input el-input--prefix el-input--suffix el-date-editor--datetime"><input type="text"  autocomplete="off" name="" placeholder="选择日期" class="el-input__inner" id="stime" readonly="readonly"><span class="el-input__prefix"><i class="el-input__icon el-icon-time"></i></span><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon"></i></span></span></div><button type="button" class="el-button se-send el-button--primary"><span>发布</span></button></div><ul class="el-dropdown-type" style="display: none;" tid = "recordType"><li class="el-dropdown-menu__item">微信</li><li class="el-dropdown-menu__item">邮箱</li><li class="el-dropdown-menu__item">电话</li><li class="el-dropdown-menu__item">地址</li><div class="popper__arrow"></div></ul><div class="log-cont"><div class="log-inner1"><div class="log-inner2"><div class="log-items"><div class="load"><button  type="button" class="el-button el-button--text"><span>没有更多了</span></button></div></div><div class="empty-mask" style="display: none;"><div class="empty-content"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div><div class="el-loading-mask" style="display: none;"><div class="el-loading-spinner"><svg viewBox="25 25 50 50" class="circular"><circle cx="50" cy="50" r="20" fill="none" class="path"></circle></svg></div></div></div></div>'),that.loadTimeContainer("stime"),that.loadRecord()}.bind(this))},createTypeHtml:function(){var e=jQuery(this.sectionArea).find(".hit").text();"基本信息"==e&&this.getChanceInfo(),"联系人"==e&&this.loadContacts(),"相关团队"==e&&this.loadTeam(),"附件"==e&&this.loadAttachment(),"操作记录"==e&&this.loadOptions()},loadTimeContainer:function(e){jQuery("#"+e).ymdateplugin({showTimePanel:!0})},getChanceInfo:function(){(_self=this).actions.getChanceInfo(this.options.openId,function(e){_self.data=e.data;var t=_self.getItemTemplate(_self.lp.chanceEdit),a='<div class="section-conent">';for(i in t)a=a+'<div class="conent-inline"><div class="conent-title">'+t[i].text+'</div><div class="conent-value">'+(void 0===t[i].value?"":t[i].value)+"</div></div>";a+="</div>",jQuery(_self.sectionArea).find("#tab-basicinfo").html('<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+a)}.bind(this))},loadAttachment:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item"><span>上传附件</span></div> <input  type="file" id="afile" accept="*/*" multiple="multiple" class="rc-head-file"></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 866px;height:40px;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 40%;"><div class="cell">附件名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_28     is-leaf" style="width: 10%;"><div class="cell">附件大小</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">上传人</div></th><th colspan="1" rowspan="1" class="el-table_3_column_30     is-leaf" style="width: 20%;"><div class="cell">上传时间</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 10%;"><div class="cell">操作</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 866px;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 866px;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-att").html(e),jQuery(that.sectionArea).find("#afile").change(function(e){var t=jQuery(that.sectionArea).find("#afile")[0].files;jQuery(t).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",that.options.openId,"chance",i,t,function(e){"success"==e.type&&that.getAttachment()}.bind(that))})}),that.getAttachment()},getAttachment:function(){(that=this).actions.getAttachment(this.options.openId,function(e){if("success"==e.type){var t=e.data,a="";for(i in t)if(i<t.length){var s=t[i],n=s.length/1024,l=s.lastUpdatePerson;l=l.split("@")[0],a=a+'<tr><td style="width: 40%;" class="aname" aid="'+s.id+'" wcrm="'+s.wcrm+'">'+s.name+'</td><td style="width: 10%;">'+that.toDecimal(n)+'kb</td><td style="width: 20%;">'+l+'</td><td style="width: 20%;">'+s.updateTime+'</td><td class="attOption">删除</td></tr>'}""!=a&&(jQuery(that.sectionArea).find(".el-table__body").children().html(a),jQuery(that.sectionArea).find(".el-table__empty-block").hide(),jQuery(that.sectionArea).find(".attOption").click(function(){self=this,Showbo.Msg.confirm("提示","确定删除该附件吗?",function(){var e=jQuery(self).parent().children(":first").attr("aid");e&&""!=e&&that.actions.delAttachment(e,function(e){"success"==e.type&&jQuery(that.sectionArea).find(".hit").click()}.bind(self))},function(){})}),jQuery(that.sectionArea).find(".aname").click(function(){var e=that.actions.action.address+"/jaxrs/attachment/download/"+jQuery(this).attr("aid")+"/work/"+jQuery(this).attr("wcrm");window.open(e)}))}}.bind(that))},loadContacts:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"><span>新建联系人</span></div><div class="rc-head-item" style="width: 75px;"><span>解除关联</span></div><div class="rc-head-item" style="width: 75px;"><span>关联</span></div></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;height:40px;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27"><div class="cell"><input class="inp-cbx" id="allContacts" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="allContacts"><span><svg width="12px" height="10px"><use xlink:href="#checkContact"></use></svg></span><span></span></label></div></th><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 30%;"><div class="cell">姓名</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 30%;"><div class="cell">手机</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 30%;"><div class="cell">职务</div></th></tr></thead></table></div><svg class="inline-svg"><symbol id="checkContact" viewbox="0 0 12 10"><polyline points="1.5 6 4.5 9 10.5 1" ></polyline></symbol></svg><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body_contact" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block_contact" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-contacts").html(e),this.actions.getContactsByChanceId(this.options.openId,function(e){if("success"==e.type){var t=e.data,a="";for(i in t)if(i<t.length){var s=t[i],n="allContacts"+i;a=a+'<tr><td style="width: 10%;">'+('<div class="cell"><input class="inp-cbx" id="'+n+'" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="'+n+'"><span><svg width="12px" height="10px"><use xlink:href="#checkContact"></use></svg></span><span></span></label></div>')+'</td><td style="width: 30%;" class="aname" aid="'+s.id+'">'+s.contactsname+'</td><td style="width: 30%;">'+s.cellphone+'</td><td style="width: 30%;">'+s.post+"</td></tr>"}""!=a&&(jQuery(that.sectionArea).find(".el-table__body_contact").children().html(a),jQuery(that.sectionArea).find(".el-table__empty-block_contact").hide())}}.bind(that)),jQuery(that.sectionArea).find("[for='allContacts']").click(function(){var e=jQuery(that.sectionArea).find(".cbxx").not("[for='allContacts']");jQuery(this).prev().is(":checked")?e.each(function(e,t){jQuery(t).prev().prop("checked",!1)}):e.each(function(e,t){jQuery(t).prev().prop("checked",!0)})}),jQuery(that.sectionArea).find("#tab-contacts").find(".rc-head-item").click(function(){"新建联系人"==jQuery(this).children().text()&&that.contactsCreate(),"关联"==jQuery(this).children().text()&&that.relateChanceAndContact(),"解除关联"==jQuery(this).children().text()&&that.terminatedRelation()}),jQuery(that.sectionArea).find("#tab-contacts").find(".aname").click(function(){})},loadTeam:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"><span>移除</span></div><div class="rc-head-item" style="width: 75px;"><span>编辑</span></div><div class="rc-head-item" style="width: 95px;"><span>添加团队成员</span></div></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;height:40px;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27"><div class="cell"><input class="inp-cbx" id="all" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="all"><span><svg width="12px" height="10px"><use xlink:href="#check"></use></svg></span><span></span></label></div></th><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 30%;"><div class="cell">姓名</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">职位</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">团队角色</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 20%;"><div class="cell">权限</div></th></tr></thead></table></div><svg class="inline-svg"><symbol id="check" viewbox="0 0 12 10"><polyline points="1.5 6 4.5 9 10.5 1" ></polyline></symbol></svg><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-team").html(e),this.actions.getTeamMemberListByChanceId(this.options.openId,function(e){if("success"==e.type){var t=e.data,a="";for(i in t)if(i<t.length){var s=t[i],n=0<s.units.length?s.units[0].split("@")[0]:"",l="all"+i,o='<div class="cell"><input class="inp-cbx" id="'+l+'" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="'+l+'"><span><svg width="12px" height="10px"><use xlink:href="#check"></use></svg></span><span></span></label></div>';s.teamRole&&"负责人"==s.teamRole&&(o='<div class="cell"><input class="inp-cbx" id="'+l+'" type="checkbox" style="display: none;"/><label class="cbx" for="xx"><span style="background: #e6e6e6;"><svg width="12px" height="0px"><use xlink:href="#check"></use></svg></span><span></span></label></div>'),s.teamRole&&""!=s.teamRole&&(a=a+'<tr><td style="width: 10%;">'+o+'</td><td style="width: 30%;" class="aname" aid="'+s.person.distinguishedName+'">'+s.person.name+'</td><td style="width: 20%;">'+n+'</td><td style="width: 20%;">'+s.teamRole+'</td><td style="width: 20%;">'+s.dispaly_permission+"</td></tr>")}""!=a&&(jQuery(that.sectionArea).find(".el-table__body").children().html(a),jQuery(that.sectionArea).find(".el-table__empty-block").hide())}}.bind(that)),jQuery("[for='all']").click(function(){var e=jQuery(that.sectionArea).find(".cbxx").not("[for='all']");jQuery(this).prev().is(":checked")?e.each(function(e,t){jQuery(t).prev().prop("checked",!1)}):e.each(function(e,t){jQuery(t).prev().prop("checked",!0)})}),jQuery(that.sectionArea).find(".rc-head-item").click(function(){if("添加团队成员"==jQuery(this).children().text()&&that.addTeam(),"编辑"==jQuery(this).children().text()){var a=[];jQuery(".el-table__body").find("input:checked").each(function(e,t){var i=jQuery(t).parent().parent().next();a.push(jQuery(i).attr("aid"))}),that.editTeam(a)}"移除"==jQuery(this).children().text()&&that.deleteTeam()})},loadOptions:function(){that=this;jQuery(that.sectionArea).find("#tab-options").html('<div class="rc-cont"><div class="empty-mask" style="display:none;height:370px;"><div class="empty-content" style="margin-top:0px;"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div>'),this.actions.getOptionsRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".rc-cont").find(".vux-flexbox").remove();var a="";for(i in t)if(i<t.length){var s=t[i],n="/x_component_CRM/$Template/portrait.png";s.hasOwnProperty("ICONBase64")&&""!=s.ICONBase64&&(n="data:image/png;base64,"+s.ICONBase64);var l=s.updateTime;a=a+'<div class="vux-flexbox ha-cont vux-flex-row" style="justify-content: flex-start; align-items: stretch;"><div class="ha-week">'+s.DateCN+'</div><div class="ha-circle"></div> <div class="ha-time">'+l.substring(11,16)+'</div><div class="div-photo ha-img xs-photo-parent--relative" style="background-image: url(&quot;'+n+'&quot;);" lazy="error"><div class="photo-wrap"></div></div><div class="ha-name">'+s.person.name+'</div><div class="ha-content">'+s.content+'</div><div class="ha-line"></div></div>'}""!=a&&jQuery(that.sectionArea).find(".rc-cont").append(a),t.length<1&&jQuery(that.sectionArea).find(".empty-mask").show()}}.bind(this))},transfer:function(){_self=this;Showbo.Msg.confirm("商机转移",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:130px;">变更负责人为：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 50px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:130px;">将原负责人：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" tabindex="0" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">移出</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">转为团队成员</span></label></div></div></div>',function(){var a="",e=!0,i=[];if(jQuery(".ct").find(".is-checked").each(function(e,t){var i=jQuery(t).children(".el-radio__label").text();"移出"==i&&(a="1"),"转为团队成员"==i&&(a="2")}),jQuery(".ct").find(".el-checkbox__original").each(function(e,t){jQuery(t).is(":checked")&&i.push(jQuery(t).val())}),""==jQuery("#selectId").text()&&(e=!1,Showbo.Msg.alert("请选择负责人!")),""==a&&(e=!1,Showbo.Msg.alert("请选择将负责人移出或转为团队成员!")),e){var t;t={distinguishName:jQuery("#selectId").text(),transferType:a,readOrWrite:"",relationTypeList:i},_self.actions.chanceTransfer(_self.options.openId,t,function(e){"success"==e.type&&Showbo.Msg.alert("操作成功!"),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery("#appContent")[0],"selectName","selectId",0)}),jQuery(".ct").find(".el-radio").click(function(){jQuery(this).siblings().attr("class","el-radio"),jQuery(this).siblings().find("input:radio").attr("checked",!1),jQuery(this).attr("class","el-radio is-checked"),jQuery(this).find("input:radio").attr("checked",!0);var e=jQuery(this).find(".el-radio__label").text();"转为团队成员"==e&&jQuery(this).parent().parent().next().show(),"移出"==e&&jQuery(this).parent().parent().next().hide()})},chanceEdit:function(){(_self=this).actions.getChanceInfo(this.options.openId,function(e){MWF.xDesktop.requireApp("CRM","ChanceEdit",function(){console.log("this.lp",this.lp),new MWF.xApplication.CRM.ChanceEdit(null,e.data,null,{app:this.app,container:this.app.content,lp:this.lp,actions:this.actions,css:{}}).edit()}.bind(this))}.bind(this))},contactsCreate:function(){_self=this;var e;jQuery("#appContent").next().attr("style",""),jQuery("#appContent").next().attr("class","mask");var d=_self.getContactTemplate(_self.app.lp.contact.contactEdit),t='<div class="section-conent">';for(i in d){var a=d[i].type,s='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" stype="'+a+'">';"textarea"==a&&(s='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" stype="'+a+'"  style="resize: none; min-height: 30.6px;"></textarea>'),"select"==a&&(s='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" stype="'+a+'" ></div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"readonly"==a&&(s='<input type="text" class="inline-input" disabled="disabled" style="background-color:#e2ebf9;" name="'+i+'" id="'+i+'" value="'+_self.data.customer.customername+'" cid="'+_self.data.customerid+'" stype="'+a+'">'),t=t+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+d[i].text+'</div><div class="conent-value">'+s+"</div></div>"}e='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(t+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>',jQuery(".headMoreImg").notifyMe("left","default",_self.app.lp.contact.contactEdit.title,"","",e,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),a=jQuery(i).attr("stype");if("datetime"==a&&_self.loadTimeContainer(jQuery(i).attr("id")),"select"==a){var s=_self.app.lp.contact;for(j in s)if(j==jQuery(i).attr("id")){var n=d[j].value.split(",");if(0<n.length){for(var l='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',o=0;o<n.length;o++)l=l+'<li class="el-dropdown-menu__item">'+n[o]+"</li>";jQuery(".notify-content").append(l+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}}),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var e;e={contactsname:jQuery('div[lable="contactsname"]').next().children().eq(0).val(),customerid:jQuery("#customername").attr("cid"),telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),email:jQuery('div[lable="email"]').next().children().eq(0).val(),decision:jQuery('div[lable="decision"]').next().children().eq(0).text(),sex:jQuery('div[lable="sex"]').next().children().eq(0).text(),post:jQuery('div[lable="post"]').next().children().eq(0).val(),detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val()},_self.actions.saveContacts(e,function(e){"success"==e.type&&(Showbo.Msg.alert("保存成功!"),_self.loadContacts()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))})},relateChanceAndContact:function(){this.selectContact=new MWF.xApplication.CRM.ChanceEdit.SelectContact(null,{customerid:this.data.customerId},null,{app:this,container:this.formTableArea,lp:this.lp,actions:this.actions,css:{}}),this.selectContact.create()},terminatedRelation:function(){},editTeam:function(t){_self=this;Showbo.Msg.confirm("编辑权限",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 50px 20px;line-height:30px;font-size:16px;"><div class="handle-item-name" style="margin-top: 8px;width:60px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" tabindex="0" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" checked aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div>',function(){var e;e={distinguishName:t},1==jQuery(".ct").find("input:radio:checked").val()?_self.actions.setTeamReaderChance(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self)):_self.actions.setTeamWriterChance(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))},function(){}),jQuery(".el-radio").click(function(){jQuery(this).find("input");jQuery(this).siblings().find("input[type=radio]").removeAttr("checked")})},addTeam:function(){_self=this;Showbo.Msg.confirm("添加团队成员",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">选择团队成员：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 80px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" aria-checked="true" tabindex="0" class="el-radio is-checked"><span class="el-radio__input is-checked"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div></div></div></div>',function(){var a="",e=!0,i=[];if(jQuery(".ct").find(".is-checked").each(function(e,t){var i=jQuery(t).children(".el-radio__label").text();"只读"==i&&(a="read"),"读写"==i&&(a="write")}),jQuery(".ct").find(".el-checkbox__original").each(function(e,t){jQuery(t).is(":checked")&&i.push(jQuery(t).val())}),""==jQuery("#selectId").text()&&(e=!1,Showbo.Msg.alert("选择团队成员!")),""==a&&(e=!1,Showbo.Msg.alert("请权限!")),e){var t;t={personList:jQuery("#selectId").text().split(","),relationTypeList:i},_self.actions.addRelevantPersonChance(_self.options.openId,a,t,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery("#appContent")[0],"selectName","selectId",0)}),jQuery(".ct").find(".el-radio").click(function(){jQuery(this).siblings().attr("class","el-radio"),jQuery(this).siblings().find("input:radio").attr("checked",!1),jQuery(this).attr("class","el-radio is-checked"),jQuery(this).find("input:radio").attr("checked",!0);jQuery(this).find(".el-radio__label").text()})},deleteTeam:function(){_self=this,Showbo.Msg.confirm("提示","此操作将移除这些团队成员是否继续?",function(){var a=[];if(jQuery(".el-table__body").find("input:checked").each(function(e,t){var i=jQuery(t).parent().parent().next();a.push(jQuery(i).attr("aid"))}),a.length<1)Showbo.Msg.alert("请选择要删除的相关团队成员!");else{var e;e={distinguishName:a},_self.actions.removeTeamMemberChance(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam())}.bind(self))}setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)},function(){})},loadEvent:function(){that=this,jQuery(that.sectionArea).find(".tabPanel div").click(function(){jQuery(this).addClass("hit").siblings().removeClass("hit"),jQuery(that.sectionArea).find(".panes>div:eq("+jQuery(this).index()+")").show().siblings().hide(),that.createTypeHtml()}),jQuery(that.sectionArea).find(".headMoreBottonDiv").click(function(){jQuery(that.sectionArea).find(".el-dropdown-menu").toggle(100)}),jQuery(that.sectionArea).find(".el-dropdown-menu__item").click(function(){jQuery(this).text(),"recordType"==jQuery(this).parent().attr("tid")&&(jQuery(".se-select-name").text(jQuery(this).text()),jQuery(this).parent().toggle(100))}),jQuery(that.sectionArea).find(".headMoveBottonDiv").click(function(){that.transfer()}),jQuery(that.sectionArea).find(".headEditBottonDiv").click(function(){that.chanceEdit()}),jQuery(that.sectionArea).find("#bar-file").change(function(e){var t=e.target.files,i=e.target.id;if(jQuery(that.sectionArea).find(".fileList").empty(),t&&0<t.length){for(var a='<div class="fileList">',s=0;s<t.length;s++){var n=t[s],l=n.size/1024;a=a+'<div class="fileItem"><div class="fname">'+n.name+'</div><div class="fsize">'+that.toDecimal(l)+'kb</div><div class="ftime">'+that.getFormateTime(new Date)+"</div></div>","bar-img"==i&&that.imgArr.push(n),"bar-file"==i&&that.fileArr.push(n)}a+="</div>",jQuery(that.sectionArea).find(".mix-container").append(a)}}),jQuery(that.sectionArea).find(".se-send").click(function(){that.sendRecord()}),jQuery(that.sectionArea).find(".el-dropdown-selfdefine").click(function(){jQuery(that.sectionArea).find("[tid='recordType']").toggle(100)})},sendRecord:function(){that=this;var e;e={types:"customer",typesid:that.options.openId,content:jQuery(that.sectionArea).find(".el-textarea__inner").val(),category:jQuery(that.sectionArea).find(".se-select-name").text(),nexttime:jQuery(that.sectionArea).find(".el-input__inner").text(),businessids:"",contactsids:"",createuser:""},that.actions.createRecord(e,function(a){if("success"==a.type){Showbo.Msg.alert("跟进记录发布成功!");var e=jQuery(that.sectionArea).find("#bar-file")[0];jQuery(that.fileArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",a.data.id,"record",i,t,function(e){}.bind(that))});var t=jQuery(that.sectionArea).find("#bar-img")[0];jQuery(that.imgArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("img",a.data.id,"record",i,t,function(e){}.bind(that))}),e.value="",t.value="",that.fileArr=[],that.imgArr=[],0<jQuery(".fileList").length&&jQuery(".fileList").remove(),jQuery(".el-textarea__inner").val(""),that.loadRecord()}}.bind(that),function(e,t,i){}.bind(that))},loadRecord:function(){(that=this).actions.getRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".fl-c").remove();var a="";for(i in t)if(i<t.length){var s=t[i],n="/x_component_CRM/$Template/portrait.png";s.hasOwnProperty("ICONBase64")&&""!=s.ICONBase64&&(n="data:image/png;base64,"+s.ICONBase64),a=a+'<div class="fl-c"><div class="vux-flexbox fl-h vux-flex-row"><div class="div-photo fl-h-img"  style="background-image: url(&quot;'+n+'&quot;);" lazy="loaded"></div> <div class="fl-h-b"><div class="fl-h-name">'+s.person.name+'</div><div class="fl-h-time">'+s.updateTime+'</div></div></div><div class="fl-b"><div class="fl-b-content">'+s.content+'</div><div class="follow"><span class="follow-info">'+s.category+'</span></div></div><div  class="full-container" style="display: none;"></div></div>'}""!=a&&jQuery(that.sectionArea).find(".load").before(a),t.length<1?(jQuery(that.sectionArea).find(".load").hide(),jQuery(that.sectionArea).find(".empty-mask").show()):jQuery(that.sectionArea).find(".empty-mask").hide()}}.bind(this))},open:function(e){this.fireEvent("queryOpen"),this._open(),this.fireEvent("postOpen")},create:function(){this.fireEvent("queryCreate"),this.isNew=!0,this._open(),this.fireEvent("postCreate")},edit:function(){this.fireEvent("queryEdit"),this.isEdited=!0,this._open(),this.fireEvent("postEdit")},_open:function(){if(this.options.hasMask&&(this.formMaskNode=new Element("div.formMaskNode",{styles:this.css.formMaskNode,events:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},click:function(e){e.stopPropagation()}}}).inject(this.container||this.app.content)),this.formAreaNode=new Element("div.formAreaNode",{styles:this.css.formAreaNode}),this.createFormNode(),this.formAreaNode.inject(this.formMaskNode||this.container||this.app.content,"after"),this.formAreaNode.fade("in"),this.setFormNodeSize(),this.setFormNodeSizeFun=this.setFormNodeSize.bind(this),this.app&&this.app.addEvent("resize",this.setFormNodeSizeFun),this.options.draggable&&this.formTopNode){var e=(this.container||this.app.content).getSize(),t=this.formAreaNode.getSize();this.formAreaNode.makeDraggable({handle:this.formTopNode,limit:{x:[0,e.x-t.x],y:[0,e.y-t.y]}})}},createFormNode:function(){this.formNode=new Element("div.formNode",{styles:this.css.formNode}).inject(this.formAreaNode),this.options.hasTop&&this.createTopNode(),this.options.hasIcon&&(this.formIconNode=new Element("div.formIconNode",{styles:this.isNew?this.css.formNewNode:this.css.formIconNode}).inject(this.formNode)),this.createContent(),this.options.hasBottom&&this.createBottomNode(),this._setCustom(),this.options.hasScroll&&MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.formTableContainer,{indent:!1,style:"default",where:"before",distance:30,friction:4,axis:{x:!1,y:!0},onScroll:function(e){}})}.bind(this))},createContent:function(){this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode),this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode),this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea,text:"loading..."}).inject(this.formTableContainer),this._createTableContent()},createBottomNode:function(){this.formBottomNode=new Element("div.formBottomNode",{styles:this.css.formBottomNode}).inject(this.formNode),this._createBottomContent()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title+(this.data.title?"-"+this.data.title:"")}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode),this._createTopContent())},_createTopContent:function(){},_createTableContent:function(){this.loadFormData()},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.lp.actionCancel}).inject(this.formBottomNode),(this.options.isNew||this.options.isEdited)&&(this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))),this.cancelActionNode.addEvent("click",function(e){this.cancel(e)}.bind(this))},loadFormData:function(){this.loadForm()},ok:function(e){this.fireEvent("queryOk");var t=this.form.getResult(!0,",",!0,!1,!0);t&&this._ok(t,function(e){"error"==e.type?this.app&&this.app.notice(e.message,"error"):(this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.explorer&&this.explorer.view&&this.explorer.view.reload(),this.app&&this.app.notice(this.isNew?this.lp.createSuccess:this.lp.updateSuccess,"success"),this.fireEvent("postOk"))}.bind(this))},loadForm:function(){(_self=this).form=new MForm(this.formTableArea,this.data,{style:"default",isEdited:this.isEdited||this.isNew,itemTemplate:this.getItemTemplate(this.lp)},this.app,this.css);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>",t=this.form.itemTemplate;for(i in t)e=e+"<tr>   <td styles='formTableTitle'><span lable='"+i+"'>"+t[i].text+"</td>   <td styles='formTableValue' item='"+i+"'></td></tr>";e+="</table>",this.formTableArea.set("html",e),this.form.load(),this.isNew||this.actions.getCustomerInfo(this.options.openId,function(e){var t=e.data,i=this.formTableArea.getElements("span");for(j in i)if(j<i.length&&null!=i[j].get("name")){var a=i[j].get("name");for(var s in t)s==a&&i[j].set("text",t[s])}}.bind(this)),this.formTableArea.getElements("textarea").setStyles({height:"100px",overflow:"auto",color:"#666666"}),this.formTableArea.getElements("input").setStyles({color:"#666666"})},getItemTemplate:function(e){return _self=this,console.log(e),{name:{text:e.name,type:"text",notEmpty:!0,value:this.data&&this.data.opportunityname?this.data.opportunityname:""},customer:{type:"text",text:e.customer,value:this.data&&this.data.customer&&this.data.customer.customername?this.data.customer.customername:""},typeid:{type:"select",text:e.typeid,value:this.data&&this.data.opportunityType&&this.data.opportunityType.opportunitytypename?this.data.opportunityType.opportunitytypename:""},statusid:{type:"select",text:e.statusid,value:this.data&&this.data.opportunityStatus&&this.data.opportunityStatus.opportunitystatusname?this.data.opportunityStatus.opportunitystatusname:""},money:{type:"text",text:e.money,value:this.data&&this.data.money?this.data.money:""},dealdate:{text:e.dealdate,name:"dealdate",attr:{id:"dealdate"},type:"datetime",value:this.data&&this.data.dealdate?this.data.dealdate:""},remark:{text:e.remark,name:"remark",type:"textarea",value:this.data&&this.data.remark?this.data.remark:""}}},getContactTemplate:function(e){return _self=this,{contactsname:{text:e.contactsname,type:"text",notEmpty:!0},customername:{text:e.customername,type:"readonly",notEmpty:!0},telephone:{type:"text",text:e.telephone},cellphone:{text:e.cellphone,type:"text"},email:{type:"text",text:e.email},decision:{type:"select",text:e.decision,value:this.app.lp.contact.decision.value},post:{text:e.post,type:"text"},sex:{type:"select",text:e.sex,value:this.app.lp.contact.sex.value},detailaddress:{text:e.detailaddress,type:"text"},nexttime:{text:e.nexttime,attr:{id:"nexttime"},type:"datetime"},remark:{text:e.remark,type:"textarea"}}},selectPerson:function(e,t,s,i){var a={type:"",types:["person"],values:this.configData,count:i,zIndex:5e4,onComplete:function(e){MWF.require("MWF.widget.O2Identity",function(){var i=[],a=[];this.configData=[],this.process=null,e.each(function(e){if("i"==e.data.distinguishedName.split("@").getLast().toLowerCase()){new MWF.widget.O2Identity(e.data,it.form.getItem("invitePersonList").container,{style:"room"});i.push(e.data.distinguishedName)}else{i.push(e.data.name),a.push(e.data.distinguishedName);var t={name:e.data.name,distinguishedName:e.data.distinguishedName,employee:e.data.employee};this.configData.push(t)}}.bind(this)),0==e.length?document.getElementById(t).innerHTML="+点击选择":(document.getElementById(t).innerHTML=i.join(","),""!=s&&(document.getElementById(s).innerHTML=a.join(",")))}.bind(this))}.bind(this)};new MWF.O2Selector(e,a)},getFormateTime:function(e){_self=this;var t=new Date(e);return t.getFullYear()+"-"+_self.checkTime(t.getMonth()+1)+"-"+_self.checkTime(t.getDate())+" "+_self.checkTime(t.getHours())+":"+_self.checkTime(t.getMinutes())+":"+_self.checkTime(t.getSeconds())},checkTime:function(e){return e<10&&(e="0"+e),e},toDecimal:function(e){if(""==e)return"";var t=parseFloat(e);return isNaN(t)?e:t=Math.round(100*e)/100},createCustomBottom:function(){this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))},_ok:function(data,callback){var saveDataStr="";for(i in this.data)saveDataStr=saveDataStr+"'"+i+"':'"+this.data[i]+"',";saveDataStr="'{"+saveDataStr.replace(/'/g,'"')+"}'";var saveData=eval("("+saveDataStr.substring(1,saveDataStr.length-1)+")");this.app.createShade(),this.actions.saveClue(saveData,function(e){this.app.destroyShade(),this.app.notice(this.lp.saveSuccess,"success"),this.close(),this.fireEvent("reloadView",e)}.bind(this),function(e,t,i){this.app.showErrorMessage(e,t,i),this.app.destroyShade()}.bind(this))}}),MWF.xApplication.CRM.ChanceEdit.SelectContact=new Class({Extends:MWF.xApplication.CRM.Template.SelectForm,_getCurrentPageData:function(t,e,i,a){this.category=this.options.category;e||(e=10),i||(i=1);this.items.length&&this.items[this.items.length-1].data.id;var s=this.options.filterData||{};this.data.customerid&&(s={customerId:this.data.customerid}),this.actions.getContactsListPageByCustomerId(i,e,s,function(e){t&&t(e)}.bind(this))}});