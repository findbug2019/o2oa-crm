MWF.xDesktop.requireApp("CRM","Explorer",null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xApplication.CRM.PicTool=new Class({Extends:MWF.xApplication.CRM.Explorer,Implements:[Options,Events],initialize:function(t){this.app=t},initPhotoHtml:function(t){jQuery(t).append('<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>')},initPhotoSwipeFromDOM:function(t){for(var e=function(t){(t=t||window.event).preventDefault?t.preventDefault():t.returnValue=!1;var e=function t(e,i){return e&&(i(e)?e:t(e.parentNode,i))}(t.target||t.srcElement,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(e){for(var i,n=e.parentNode,s=e.parentNode.childNodes,p=s.length,l=0,r=0;r<p;r++)if(1===s[r].nodeType){if(s[r]===e){i=l;break}l++}return 0<=i&&o(i,n),!1}},o=function(t,e,i,n){var s,p,l=document.querySelectorAll(".pswp")[0];if(p=function(t){for(var e,i,n,s,p=t.childNodes,l=p.length,r=[],o=0;o<l;o++)1===(e=p[o]).nodeType&&(n=(i=e.children[0].children[0]).getAttribute("data-size").split("x"),s={src:i.getAttribute("href"),w:parseInt(n[0],10),h:parseInt(n[1],10)},1<e.children.length&&(s.title=e.children[1].innerHTML),0<i.children.length&&(s.msrc=i.children[0].getAttribute("src")),s.el=e,r.push(s));return r}(e),s={barsSize:{top:100,bottom:100},bgOpacity:.5,fullscreenEl:!1,shareButtons:[{id:"wechat",label:"分享微信",url:"#"},{id:"weibo",label:"新浪微博",url:"#"},{id:"download",label:"保存图片",url:"{{raw_image_url}}",download:!0}],galleryUID:e.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(t){var e=p[t].el.getElementsByTagName("img")[0],i=window.pageYOffset||document.documentElement.scrollTop,n=e.getBoundingClientRect();return{x:n.left,y:n.top+i,w:n.width}}},n)if(s.galleryPIDs){for(var r=0;r<p.length;r++)if(p[r].pid==t){s.index=r;break}}else s.index=parseInt(t,10)-1;else s.index=parseInt(t,10);isNaN(s.index)||(i&&(s.showAnimationDuration=0),new PhotoSwipe(l,PhotoSwipeUI_Default,p,s).init())},i=document.querySelectorAll(t),n=0,s=i.length;n<s;n++)i[n].setAttribute("data-pswp-uid",n+1),i[n].onclick=e;var p=function(){var t=window.location.hash.substring(1),e={};if(t.length<5)return e;for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n]){var s=i[n].split("=");s.length<2||(e[s[0]]=s[1])}return e.gid&&(e.gid=parseInt(e.gid,10)),e}();p.pid&&p.gid&&o(p.pid,i[p.gid-1],!0,!0)}});