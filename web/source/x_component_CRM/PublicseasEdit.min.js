MWF.xApplication.CRM.AddressExplorer=null,MWF.xApplication.CRM.PublicseasEdit=new Class({Extends:MWF.xApplication.CRM.Template.PopupForm,Implements:[Options,Events],options:{style:"default",width:"800",height:"100%",top:0,left:0,hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0},initialize:function(e,t,i,l){this.setOptions(l),this.explorer=e,this.app=e.app,this.lp=this.app.lp.publicseas.publicseasEdit,this.path="/x_component_CRM/$PublicseasEdit/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=i||{},this.actions=t},load:function(){this.loadResource(function(){this.appArea=jQuery("body").children(":first"),this.createForm()}.bind(this))},loadResource:function(e){e&&e()},createForm:function(){_self=this,jQuery(_self.appArea).next().attr("style",""),jQuery(_self.appArea).next().attr("class","mask");var o=_self.getItemTemplate(_self.lp),e='<div class="section-conent">';for(i in o){var t=o[i].type,l='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" stype="'+t+'">';"textarea"==t&&(l='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" stype="'+t+'"  style="resize: none; min-height: 30.6px;"></textarea>'),"select"!=t&&"hide"!=t||(l='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" stype="'+t+'" ></div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"map"==t&&(l='<div class="setMap" id="setMap" stype="'+t+'"></div>'),e=e+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+o[i].text+'</div><div class="conent-value">'+l+"</div></div>"}var s='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(e+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>';jQuery(".headMoreImg").notifyMe("left","default",_self.options.title,"","",s,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),l=jQuery(i).attr("stype");if("datetime"==l&&_self.loadTimeContainer(jQuery(i).attr("id")),"select"==l||"hide"==l){var s=_self.app.lp.publicseas;for(j in s)if(j==jQuery(i).attr("id")){var a=o[j].value.split(",");if(0<a.length){for(var n='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',r=0;r<a.length;r++)n=n+'<li class="el-dropdown-menu__item">'+a[r]+"</li>";jQuery(".notify-content").append(n+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}"map"==l&&_self.loadMap()}),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var e;e={customername:jQuery('div[lable="customername"]').next().children().eq(0).val(),level:jQuery('div[lable="level"]').next().children().eq(0).text(),industry:jQuery('div[lable="industry"]').next().children().eq(0).text(),source:jQuery('div[lable="source"]').next().children().eq(0).text(),dealstatus:jQuery('div[lable="dealstatus"]').next().children().eq(0).text(),telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),website:jQuery('div[lable="website"]').next().children().eq(0).val(),location:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("location"),detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),lng:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("lng"),lat:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("lat"),province:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("province"),city:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("city"),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val()},_self.actions.saveCustomer(e,function(e){"success"==e.type&&Showbo.Msg.alert("保存成功!"),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))})},loadTimeContainer:function(e){jQuery("#"+e).ymdateplugin({showTimePanel:!0})},loadMap:function(){(_self=this).mapDiv=jQuery("#setMap")[0],jQuery(".section-conent").css("height","700px"),this.mapDiv&&this.mapDiv.empty(),this.addressModule&&delete this.addressModule,MWF.xDesktop.requireApp("CRM","AddressExplorer",function(){this.addressModule=new MWF.xApplication.CRM.AddressExplorer(this.mapDiv,this,this.actions,{}),this.addressModule.load()}.bind(this))},getItemTemplate:function(e){return _self=this,{Publicseasname:{text:e.publicseasname,type:"text",notEmpty:!0,value:this.publicseasData&&this.publicseasData.customername?this.publicseasData.customername:""},level:{type:"select",text:e.level,value:this.app.lp.customer.level.value},industry:{type:"select",text:e.industry,value:this.app.lp.customer.industry.value},source:{type:"select",text:e.source,value:this.app.lp.customer.source.value},telephone:{type:"text",text:e.telephone,value:this.app.lp.clue.level.value},website:{text:e.website,type:"text"},nexttime:{text:e.nexttime,attr:{id:"nexttime"},type:"datetime"},cellphone:{text:e.cellphone,type:"text"},detailaddress:{text:e.detailaddress,type:"text"},remark:{text:e.remark,type:"textarea"},location:{text:e.location,type:"map"}}}});