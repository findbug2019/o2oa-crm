var BMapLib=window.BMapLib=BMapLib||{};void 0===BMapLib._toolInUse&&(BMapLib._toolInUse=!1),function(){var p=p||{guid:"$BAIDU$"};window[p.guid]={},p.extend=function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);return e},p.lang=p.lang||{},p.lang.guid=function(){return"TANGRAM__"+(window[p.guid]._counter++).toString(36)},window[p.guid]._counter=window[p.guid]._counter||1,window[p.guid]._instances=window[p.guid]._instances||{},p.lang.Class=function(e){this.guid=e||p.lang.guid(),window[p.guid]._instances[this.guid]=this},p.lang.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},p.lang.isFunction=function(e){return"[object Function]"==Object.prototype.toString.call(e)},p.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},p.lang.Class.prototype.dispose=function(){for(var e in delete window[p.guid]._instances[this.guid],this)p.lang.isFunction(this[e])||delete this[e];this.disposed=!0},p.lang.Event=function(e,n){this.type=e,this.returnValue=!0,this.target=n||null,this.currentTarget=null},p.lang.Class.prototype.addEventListener=function(e,n,i){if(p.lang.isFunction(n)){!this.__listeners&&(this.__listeners={});var t,a=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;t=n.hashCode=i}0!=e.indexOf("on")&&(e="on"+e),"object"!=typeof a[e]&&(a[e]={}),t=t||p.lang.guid(),n.hashCode=t,a[e][t]=n}},p.lang.Class.prototype.removeEventListener=function(e,n){if(p.lang.isFunction(n))n=n.hashCode;else if(!p.lang.isString(n))return;!this.__listeners&&(this.__listeners={}),0!=e.indexOf("on")&&(e="on"+e);var i=this.__listeners;i[e]&&i[e][n]&&delete i[e][n]},p.lang.Class.prototype.dispatchEvent=function(e,n){for(var i in p.lang.isString(e)&&(e=new p.lang.Event(e)),!this.__listeners&&(this.__listeners={}),n=n||{})e[i]=n[i];var t=this.__listeners,a=e.type;if(e.target=e.target||this,e.currentTarget=this,0!=a.indexOf("on")&&(a="on"+a),p.lang.isFunction(this[a])&&this[a].apply(this,arguments),"object"==typeof t[a])for(i in t[a])t[a][i].apply(this,arguments);return e.returnValue},p.lang.inherits=function(e,n,i){var t,a,o=e.prototype,s=new Function;for(t in s.prototype=n.prototype,a=e.prototype=new s,o)a[t]=o[t];(e.prototype.constructor=e).superClass=n.prototype,"string"==typeof i&&(a._className=i)};var i=BMapLib.MarkerTool=function(e,n){p.lang.Class.call(this),this._map=e,this._opts={icon:i.SYS_ICONS[8],followText:"点击地图添加定位标记",autoClose:!0},p.extend(this._opts,n),this._isOpen=!1,this._opts.followText=this._checkStr(this._opts.followText),this._followMarker=null,this._followLabel=null};p.lang.inherits(i,p.lang.Class,"MarkerTool"),i.prototype.open=function(){return!!this._map&&(1==this._isOpen||!BMapLib._toolInUse&&(BMapLib._toolInUse=!0,this._isOpen=!0,this._binded||(this._bind(),this._binded=!0),this._followMarker||(this._followMarker=new BMap.Marker(this._map.getCenter(),{offset:new BMap.Size(-10,-10)}),this._map.addOverlay(this._followMarker),this._followMarker.setZIndex(1e3),this._followMarker.hide()),this._followLabel||(this._followLabel=new BMap.Label(this._opts.followText,{offset:new BMap.Size(20,0)})),this._preCursor=this._map.getDefaultCursor(),this._map.setDefaultCursor("url("+i.CUR_IMG+"), default"),!0))},i.prototype.close=function(){this._isOpen&&(this._map.removeEventListener("mousemove",this._mouseMoveHandler),this._map.removeEventListener("click",this._clickHandler),this._followMarker.hide(),this._map.setDefaultCursor(this._preCursor),BMapLib._toolInUse=!1,this._isOpen=!1,this._binded=!1)},i.prototype.setIcon=function(e){e&&e instanceof BMap.Icon&&(this._opts.icon=e)},i.prototype.getIcon=function(){return this._opts.icon},i.prototype._checkStr=function(e){return e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},i.prototype._bind=function(){var s=this;s._isOpen&&(s._mouseMoveHandler=function(e){var n=e.point;s._followMarker.setIcon(s._opts.icon),s._followMarker.setPosition(n),s._followMarker.setLabel(s._followLabel),s._followMarker.show()},s._map.addEventListener("mousemove",s._mouseMoveHandler),s._clickHandler=function(e){var n=e.pixel,i=new BMap.Pixel(n.x-10,n.y-10),t=s._map.pixelToPoint(i),a=new BMap.Marker(t,{icon:s._opts.icon,enableDragging:!0});s._map.addOverlay(a);var o=new p.lang.Event("onmarkend");o.marker=a,s.dispatchEvent(o),s._opts.autoClose&&s.close()},s._map.addEventListener("click",s._clickHandler))},i.CUR_IMG="/x_component_Attendance/$AddressExplorer/default/icon/transparent.cur",i.ICON_IMG="/x_component_Attendance/$AddressExplorer/default/icon/us_mk_icon.png",i.SYS_ICONS=[new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(0,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-23,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-46,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-69,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-92,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-115,0)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(0,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-23,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-46,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-69,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-92,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-115,-21)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(0,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-23,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-46,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-69,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-92,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-115,-46)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(0,-67)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-25,-67)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(24,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-50,-67)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-75,-67)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-100,-67)}),new BMap.Icon(i.ICON_IMG,new BMap.Size(19,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-125,-67)})]}();