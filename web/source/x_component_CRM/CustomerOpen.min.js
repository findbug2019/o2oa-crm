MWF.xApplication.CRM.AddressExplorer=null,MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xApplication.CRM.CustomerOpen=new Class({Extends:MWF.xApplication.CRM.Template.PopupForm,Implements:[Options,Events],options:{style:"default",width:"800",height:"100%",top:0,left:0,hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0},initialize:function(e,t,i,s){this.setOptions(s),this.explorer=e,this.app=e.app,this.lp=this.app.lp.customer.customerEdit,this.path="/x_component_CRM/$ClueEdit/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=i||{},this.actions=t,this.configData=[],this.imgArr=[],this.fileArr=[],this.isCurrentItem=!1,this.sectionId="",this.province=null},load:function(){(that=this).loadResource(function(){this.appArea=jQuery("body").children(":first"),this.createContentHtml(),this.loadEvent()}.bind(this))},loadResource:function(e){e&&e()},createForm:function(){that=this;var e=jQuery("#customer").find("img");0<jQuery(e).attr("src").indexOf(jQuery(e).attr("dffill"))&&(this.isCurrentItem=!0);var t=this.options.openName,i='<div class = "headBottonDiv"><div class="headMoveBottonDiv">转移</div><div class="headEditBottonDiv">编辑</div><div class="headMoreBottonDiv"><span>更多</span><img class="headMoreImg" src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div>';this.options.readOnly&&"yes"==this.options.readOnly&&(i=""),that.sectionId=that.getNotifyMax();var s=this.options.openStyle?this.options.openStyle:this.xxx;jQuery(".headMoreImg").notifyMe("right","default",t,i,'<ul class="el-dropdown-menu"><li class="el-dropdown-menu__item">放入公海</li><li class="el-dropdown-menu__item">更改成交状态</li><li class="el-dropdown-menu__item">锁定</li><li class="el-dropdown-menu__item">解锁</li><li class="el-dropdown-menu__item">删除</li><div class="popper__arrow"></div></ul>',"",that.sectionId,500,s)},getNotifyMax:function(){var e="notify",a=0;return this.options.openType&&"single"==this.options.openType||(jQuery(".notify").each(function(e,t){var i=jQuery(t).attr("id"),s=0;0<i.indexOf("_")?(s=parseInt(i.split("_")[1]),a<s&&(a=s)):0==a&&(a=1)}),0<a&&(e=e+"_"+a)),e},createContentHtml:function(){(that=this).actions.getCustomerInfo(this.options.openId,function(e){var t=e.data;t.isWriter||(this.options.readOnly="yes"),that.createForm();var i=that.sectionId;that.sectionArea=jQuery("body")[0].getElement("#"+i);var s=""==t.owneruser||void 0===t.owneruser?"--":t.owneruser.split("@")[0],a="1"==t.islock?"已锁定":"未锁定",n="<div class = 'briefdiv'><div class='div-inline'><div class='div-title'>客户级别</div><div class='div-value'>"+t.level+"</div></div><div class='div-inline'><div class='div-title'>成交状态</div><div class='div-value'>"+t.dealstatus+"</div></div><div class='div-inline'><div class='div-title'>是否锁定</div><div class='div-value'>"+a+"</div></div><div class='div-inline'><div class='div-title'>负责人</div><div class='div-value'>"+s+"</div></div><div class='div-inline'><div class='div-title'>更新时间</div><div class='div-value'>"+t.updateTime+"</div></div></div>";that.sectionArea.getElement(".notify-content").set("html",n+"<div class='tabPanel'><div class='hit'>跟进记录</div><div style='width:30px'></div><div>基本信息</div><div style='width:30px'></div><div>联系人</div><div style='width:30px'></div><div>相关团队</div><div style='width:30px'></div><div style='display:none'>商机</div><div style='width:30px;display:none'></div><div>附件</div><div style='width:30px'></div><div>操作记录</div></div><div class='panes'><div class='pane' id='tab-follow' style='display:block;'><p>First tab content</p></div><div></div><div class='pane' id='tab-basicinfo'><p>Secend tab content</p></div><div></div><div class='pane' id='tab-contacts'><p>contacts tab content</p></div><div></div><div class='pane' id='tab-team'><p>team tab content</p></div><div></div><div class='pane' id='tab-business'><p>business tab content</p></div><div></div><div class='pane' id='tab-att'><p>Third tab content</p></div><div></div><div class='pane' id='tab-options'><p>Four tab content</p></div></div>");var l=that.sectionArea.getSize();that.sectionArea.getElement(".panes").setStyles({height:l.y-250+"px"});var o='<div ><div class="mix-container"><div class="i-cont"><div class="el-textarea el-input--suffix"><textarea autocomplete="off" placeholder="请输入内容" class="el-textarea__inner" style="resize: none; min-height: 57px; height: 57px;"></textarea></div></div><div class="vux-flexbox bar-cont vux-flex-row"><div class="vux-flexbox bar-item vux-flex-row"><input type="file" id="bar-img" accept="image/*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/img.png" class="bar-img"><div class="bar-title">图片</div></div><div class="splitdiv"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="vux-flexbox bar-item vux-flex-row"  style="padding-left:0px;"><input type="file" id="bar-file" accept="*.*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/file.png" class="bar-img"><div class="bar-title">附件</div></div></div></div>',r='<div  class="vux-flexbox se-section vux-flex-row"><div class="se-name">记录类型</div><div class="el-dropdown" style="margin-right: 20px;"><div class="vux-flexbox se-select vux-flex-row el-dropdown-selfdefine " ><div class="se-select-name">微信</div> <div class="el-icon-arrow-down el-icon--right"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div> </div><div class="se-name">下次联系时间</div><div class="el-date-editor se-datepicker el-input el-input--prefix el-input--suffix el-date-editor--datetime"><input type="text"  autocomplete="off" name="" placeholder="选择日期" class="el-input__inner" id="stime" readonly="readonly"><span class="el-input__prefix"><i class="el-input__icon el-icon-time"></i></span><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon"></i></span></span></div><button type="button" class="el-button se-send el-button--primary"><span>发布</span></button></div><ul class="el-dropdown-type" style="display: none;" tid = "recordType"><li class="el-dropdown-menu__item">微信</li><li class="el-dropdown-menu__item">邮箱</li><li class="el-dropdown-menu__item">电话</li><li class="el-dropdown-menu__item">地址</li><div class="popper__arrow"></div></ul>';this.options.readOnly&&"yes"==this.options.readOnly&&(r=o=""),that.sectionArea.getElement("#tab-follow").set("html",o+r+'<div class="log-cont"><div class="log-inner1"><div class="log-inner2"><div class="log-items"><div class="load"><button  type="button" class="el-button el-button--text"><span>没有更多了</span></button></div></div><div class="empty-mask" style="display: none;"><div class="empty-content"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div><div class="el-loading-mask" style="display: none;"><div class="el-loading-spinner"><svg viewBox="25 25 50 50" class="circular"><circle cx="50" cy="50" r="20" fill="none" class="path"></circle></svg></div></div></div></div>'),that.loadTimeContainer("stime"),that.loadRecord()}.bind(this))},createTypeHtml:function(){var e=jQuery(this.sectionArea).find(".hit").text();"基本信息"==e&&this.getCustomerInfo(),"联系人"==e&&this.loadContacts(),"相关团队"==e&&this.loadTeam(),"商机"==e&&this.loadBusiness(),"附件"==e&&this.loadAttachment(),"操作记录"==e&&this.loadOptions()},loadTimeContainer:function(e){jQuery("#"+e).ymdateplugin({showTimePanel:!0})},getCustomerInfo:function(){(_self=this).actions.getCustomerInfo(this.options.openId,function(e){var t=e.data,s=_self.lp,a='<div class="section-conent">';for(i in s)a=a+'<div class="conent-inline"><div class="conent-title">'+s[i].text+'</div><div class="conent-value">'+(void 0===t[i]?"":t[i])+"</div></div>";a+="</div>",jQuery(_self.sectionArea).find("#tab-basicinfo").html('<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+a)}.bind(this))},loadAttachment:function(){var e='<div class="rc-cont">',t='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item"><span>上传附件</span></div> <input  type="file" id="afile" accept="*/*" multiple="multiple" class="rc-head-file"></div>';(that=this).options.readOnly&&"yes"==this.options.readOnly&&(t=""),e=e+t+'<div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 40%;height:40px;"><div class="cell">附件名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_28     is-leaf" style="width: 10%;"><div class="cell">附件大小</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">上传人</div></th><th colspan="1" rowspan="1" class="el-table_3_column_30     is-leaf" style="width: 20%;"><div class="cell">上传时间</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 10%;"><div class="cell">操作</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-att").html(e),jQuery(that.sectionArea).find("#afile").change(function(e){var t=jQuery(that.sectionArea).find("#afile")[0].files;jQuery(t).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",that.options.openId,"customer",i,t,function(e){"success"==e.type&&that.getAttachment()}.bind(that))})}),that.getAttachment()},getAttachment:function(){(that=this).actions.getAttachment(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var a=t[i],n=a.length/1024,l=a.lastUpdatePerson;l=l.split("@")[0],s=s+'<tr><td style="width: 40%;height:40px;" class="aname" aid="'+a.id+'" wcrm="'+a.wcrm+'">'+a.name+'</td><td style="width: 10%;">'+that.toDecimal(n)+'kb</td><td style="width: 20%;">'+l+'</td><td style="width: 20%;">'+a.updateTime+'</td><td class="attOption">删除</td></tr>'}""!=s&&(jQuery(that.sectionArea).find(".el-table__body").children().html(s),jQuery(that.sectionArea).find(".el-table__empty-block").hide(),jQuery(that.sectionArea).find(".attOption").click(function(){self=this,Showbo.Msg.confirm("提示","确定删除该附件吗?",function(){var e=jQuery(self).parent().children(":first").attr("aid");e&&""!=e&&that.actions.delAttachment(e,function(e){"success"==e.type&&jQuery(that.sectionArea).find(".hit").click()}.bind(self))},function(){})}),jQuery(that.sectionArea).find(".aname").click(function(){var e=that.actions.action.address+"/jaxrs/attachment/download/"+jQuery(this).attr("aid")+"/work/"+jQuery(this).attr("wcrm");window.open(e)}))}}.bind(that))},loadContacts:function(){var e='<div class="rc-cont">',t='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"><span>新建联系人</span></div></div>';(that=this).options.readOnly&&"yes"==this.options.readOnly&&(t=""),e=e+t+'<div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 33%;height:40px;"><div class="cell">姓名</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 34%;"><div class="cell">手机</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 33%;"><div class="cell">职务</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-contacts").html(e),this.actions.getContacts(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var a=t[i];s=s+'<tr><td style="width: 34%;height:40px;" class="aname" aid="'+a.id+'">'+a.contactsname+'</td><td style="width: 33%;">'+a.cellphone+'</td><td style="width: 33%;">'+a.post+"</td></tr>"}""!=s&&(jQuery(that.sectionArea).find(".el-table__body").children().html(s),jQuery(that.sectionArea).find(".el-table__empty-block").hide())}}.bind(that)),jQuery(that.sectionArea).find("#tab-contacts").find(".rc-head-item").click(function(){that.contactsCreate()}),jQuery(that.sectionArea).find("#tab-contacts").find(".aname").click(function(){})},loadTeam:function(){var e='<div class="rc-cont">',t='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"><span>移除</span></div><div class="rc-head-item" style="width: 75px;"><span>编辑</span></div><div class="rc-head-item" style="width: 95px;"><span>添加团队成员</span></div></div>';(that=this).options.readOnly&&"yes"==this.options.readOnly&&(t=""),e=e+t+'<div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27"><div class="cell"><input class="inp-cbx" id="all" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="all"><span><svg width="12px" height="10px"><use xlink:href="#check"></use></svg></span><span></span></label></div></th><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 30%;height:40px;"><div class="cell">姓名</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">职位</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">团队角色</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 20%;"><div class="cell">权限</div></th></tr></thead></table></div><svg class="inline-svg"><symbol id="check" viewbox="0 0 12 10"><polyline points="1.5 6 4.5 9 10.5 1" ></polyline></symbol></svg><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-team").html(e),this.actions.getTeamMemberListById(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var a=t[i],n=0<a.units.length?a.units[0].split("@")[0]:"",l="all"+i,o='<div class="cell"><input class="inp-cbx" id="'+l+'" type="checkbox" style="display: none;"/><label class="cbx cbxx" for="'+l+'"><span><svg width="12px" height="10px"><use xlink:href="#check"></use></svg></span><span></span></label></div>';a.teamRole&&"负责人"==a.teamRole&&(o='<div class="cell"><input class="inp-cbx" id="'+l+'" type="checkbox" style="display: none;"/><label class="cbx" for="xx"><span style="background: #e6e6e6;"><svg width="12px" height="0px"><use xlink:href="#check"></use></svg></span><span></span></label></div>'),a.teamRole&&""!=a.teamRole&&(s=s+'<tr><td style="width: 10%;height:40px;">'+o+'</td><td style="width: 30%;" class="aname" aid="'+a.person.distinguishedName+'">'+a.person.name+'</td><td style="width: 20%;">'+n+'</td><td style="width: 20%;">'+a.teamRole+'</td><td style="width: 20%;">'+a.dispaly_permission+"</td></tr>")}""!=s&&(jQuery(that.sectionArea).find(".el-table__body").children().html(s),jQuery(that.sectionArea).find(".el-table__empty-block").hide())}}.bind(that)),jQuery("[for='all']").click(function(){var e=jQuery(that.sectionArea).find(".cbxx").not("[for='all']");jQuery(this).prev().is(":checked")?e.each(function(e,t){jQuery(t).prev().prop("checked",!1)}):e.each(function(e,t){jQuery(t).prev().prop("checked",!0)})}),jQuery(that.sectionArea).find(".rc-head-item").click(function(){if("添加团队成员"==jQuery(this).children().text()&&that.addTeam(),"编辑"==jQuery(this).children().text()){var s=[];jQuery(".el-table__body").find("input:checked").each(function(e,t){var i=jQuery(t).parent().parent().next();s.push(jQuery(i).attr("aid"))}),that.editTeam(s)}"移除"==jQuery(this).children().text()&&that.deleteTeam()})},loadBusiness:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"></div></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 30%;height:40px;"><div class="cell">商机名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">商品金额</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 30%;"><div class="cell">客户名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">商机状态组</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 20%;"><div class="cell">状态</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-business").html(e),this.actions.getOpportunityListByCustomerId(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var a=t[i];s=s+'<tr><td style="width: 30%;height:40px;" class="aname" aid="'+a.id+'">'+a.opportunityname+'</td><td style="width: 20%;">'+a.money+'</td><td style="width: 30%;">'+a.customer.customername+'</td><td style="width: 20%;">'+a.opportunityType.opportunitytypename+'</td><td style="width: 20%;">'+a.opportunityStatus.opportunitystatusname+"</td></tr>"}""!=s&&(jQuery(that.sectionArea).find(".el-table__body").children().html(s),jQuery(that.sectionArea).find(".el-table__empty-block").hide())}}.bind(that)),jQuery(that.sectionArea).find("#tab-business").find(".rc-head-item").click(function(){that.businessCreate()}),jQuery(that.sectionArea).find("#tab-business").find(".aname").click(function(){})},loadOptions:function(){that=this;jQuery(that.sectionArea).find("#tab-options").html('<div class="rc-cont"><div class="empty-mask" style="display:none;height:370px;"><div class="empty-content" style="margin-top:0px;"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div>'),this.actions.getOptionsRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".rc-cont").find(".vux-flexbox").remove();var s="";for(i in t)if(i<t.length){var a=t[i],n="/x_component_CRM/$Template/portrait.png";a.hasOwnProperty("ICONBase64")&&""!=a.ICONBase64&&(n="data:image/png;base64,"+a.ICONBase64);var l=a.updateTime;s=s+'<div class="vux-flexbox ha-cont vux-flex-row" style="justify-content: flex-start; align-items: stretch;"><div class="ha-week">'+a.DateCN+'</div><div class="ha-circle"></div> <div class="ha-time">'+l.substring(11,16)+'</div><div class="div-photo ha-img xs-photo-parent--relative" style="background-image: url(&quot;'+n+'&quot;);" lazy="error"><div class="photo-wrap"></div></div><div class="ha-name">'+a.person.name+'</div><div class="ha-content">'+a.content+'</div><div class="ha-line"></div></div>'}""!=s&&jQuery(that.sectionArea).find(".rc-cont").append(s),t.length<1&&jQuery(that.sectionArea).find(".empty-mask").show()}}.bind(this))},transformCustomerDealstatus:function(){_self=this;var e='<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 80px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:90px;">成交状态：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" style="display: inline-block;">已成交</div><div  style="display: inline-block;float:right;" class="el-icon-arrow-down el-icon--right"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div></div>';e+='<ul class="el-dropdown-confirm"><li class="el-dropdown-menu__item">已成交</li><li class="el-dropdown-menu__item">未成交</li><div class="popper__arrow"></div></ul>',Showbo.Msg.confirm("客户成交状态",e,function(){_self.confirmCustomerDealstatus()},function(){}),jQuery(".handle-item-content").click(function(){jQuery(".ct").find(".el-dropdown-confirm").toggle(100)}),jQuery(".el-dropdown-menu__item").click(function(){"el-dropdown-confirm"==jQuery(this).parent().attr("class")&&(jQuery(".ct").find(".se-select-name").text(jQuery(this).text()),jQuery(this).parent().toggle(100))})},lockCustomer:function(){_self=this;Showbo.Msg.confirm("提示","确定要锁定此客户吗？锁定后将不会掉入公海。",function(){_self.confirmLockCustomer()},function(){}),jQuery(".handle-item-content").click(function(){jQuery(".ct").find(".el-dropdown-confirm").toggle(100)})},unLockCustomer:function(){_self=this;Showbo.Msg.confirm("提示","确定要解锁此客户吗？",function(){_self.confirmUnLockCustomer()},function(){}),jQuery(".handle-item-content").click(function(){jQuery(".ct").find(".el-dropdown-confirm").toggle(100)})},putToCustomerPool:function(){_self=this;Showbo.Msg.confirm("提示","确定转移到公海吗？",function(){_self.actions.putToCustomerPool(_self.options.openId,function(e){"success"==e.type&&(_self.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!"))}.bind(this))},function(){}),jQuery(".handle-item-content").click(function(){jQuery(".ct").find(".el-dropdown-confirm").toggle(100)})},confirmCustomerDealstatus:function(){_self=this,"已成交"==jQuery(".ct").find(".se-select-name").text()&&this.actions.customerDealStatus_completed(this.options.openId,function(e){"success"==e.type&&(_self.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!"))}.bind(this)),"未成交"==jQuery(".ct").find(".se-select-name").text()&&this.actions.customerDealStatus_processing(this.options.openId,function(e){"success"==e.type&&(_self.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!"))}.bind(this))},confirmLockCustomer:function(){this.actions.lockCustomer(this.options.openId,function(e){"success"==e.type&&(this.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!"))}.bind(this))},confirmUnLockCustomer:function(){this.actions.unLockCustomer(this.options.openId,function(e){"success"==e.type&&(this.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!"))}.bind(this))},deleteCustomer:function(){_self=this,Showbo.Msg.confirm("提示","确定要删除此客户吗?",function(){_self.confirmDelCustomer()},function(){})},confirmDelCustomer:function(){this.actions.deleteCustomer(this.options.openId,function(e){"success"==e.type&&(this.isCurrentItem?Showbo.Msg.alert("删除成功!",jQuery("#customer").click()):Showbo.Msg.alert("删除成功!"))}.bind(this))},transfer:function(){_self=this;Showbo.Msg.confirm("客户转移",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:130px;">变更负责人为：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:130px;">将原负责人：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" tabindex="0" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">移出</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">转为团队成员</span></label></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 0px 20px;line-height:30px;display: none"><div class="handle-item-name" style="margin-top: 8px;width:130px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" aria-checked="true" tabindex="0" class="el-radio is-checked"><span class="el-radio__input is-checked"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 80px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:130px;">同时变更负责人至：</div><div role="group" aria-label="checkbox-group" class="el-checkbox-group"><label role="checkbox" class="el-checkbox"><span aria-checked="mixed" class="el-checkbox__input"><span class="el-checkbox__inner"></span><input type="checkbox" aria-hidden="true" class="el-checkbox__original" value="contacts"></span><span class="el-checkbox__label">联系人</span></label></div></div></div>',function(){var s="",a="",e=!0,i=[];if(jQuery(".ct").find(".is-checked").each(function(e,t){var i=jQuery(t).children(".el-radio__label").text();"移出"==i&&(s="1"),"转为团队成员"==i&&(s="2"),"只读"==i&&(a="readonly"),"读写"==i&&(a="readandwrite")}),jQuery(".ct").find(".el-checkbox__original").each(function(e,t){jQuery(t).is(":checked")&&i.push(jQuery(t).val())}),""==jQuery("#selectId").text()&&(e=!1,Showbo.Msg.alert("请选择负责人!")),""==s&&(e=!1,Showbo.Msg.alert("请选择将负责人移出或转为团队成员!")),e){var t;t={distinguishName:jQuery("#selectId").text(),transferType:s,readOrWrite:a,relationTypeList:i},_self.actions.customerTransfer(_self.options.openId,t,function(e){"success"==e.type&&(_self.isCurrentItem?Showbo.Msg.alert("操作成功!",jQuery("#customer").click()):Showbo.Msg.alert("操作成功!")),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery(_self.appArea)[0],"selectName","selectId",1)}),jQuery(".ct").find(".el-radio").click(function(){jQuery(this).siblings().attr("class","el-radio"),jQuery(this).siblings().find("input:radio").attr("checked",!1),jQuery(this).attr("class","el-radio is-checked"),jQuery(this).find("input:radio").attr("checked",!0);var e=jQuery(this).find(".el-radio__label").text();"转为团队成员"==e&&jQuery(this).parent().parent().next().show(),"移出"==e&&jQuery(this).parent().parent().next().hide()})},customerEdit:function(){_self=this,_self.province=null,this.actions.getCustomerInfo(this.options.openId,function(e){jQuery(_self.appArea).next().attr("style",""),jQuery(_self.appArea).next().attr("class","mask");var a=e.data,r=_self.lp,t='<div class="section-conent">';for(i in r){var s=r[i].type,n=r[i].notEmpty?r[i].notEmpty:"false",l='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" notEmpty="'+n+'" stype="'+s+'" value="'+(void 0===a[i]?"":a[i])+'">';if("datetime"==s&&(l='<input type="text" class="inline-input" readonly="readonly" name="'+i+'" id="'+i+'" notEmpty="'+n+'" stype="'+s+'" value="'+(void 0===a[i]?"":a[i])+'">'),"textarea"==s&&(l='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" notEmpty="'+n+'" stype="'+s+'"  style="resize: none; min-height: 30.6px;">'+a[i]+"</textarea>"),"select"==s&&(l='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" notEmpty="'+n+'" stype="'+s+'" >'+(void 0===a[i]?"":a[i])+'</div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"detailaddress"==i){var o=void 0===a.location?"":a.location,d=void 0===a.lng?"":a.lng,c=void 0===a.lat?"":a.lat;l='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" notEmpty="'+n+'" stype="'+s+'" lat="'+c+'" lng="'+d+'" location="'+o+'" value="'+(void 0===a[i]?"":a[i])+'">'}"hide"!=s&&(t=t+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+r[i].text+'</div><div class="conent-value">'+l+"</div></div>"),"所在地区"==r[i].text&&(_self.province=void 0===a[i]?"":a[i])}var p='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(t+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>';jQuery(".headMoreImg").notifyMe("left","default","编辑客户","","",p,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),s=jQuery(i).attr("stype");if("datetime"==s&&_self.loadTimeContainer(jQuery(i).attr("id")),"select"==s){var a=_self.app.lp.customer;for(j in a)if(j==jQuery(i).attr("id")){var n=r[j].value.split(",");if(0<n.length){for(var l='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',o=0;o<n.length;o++)l=l+'<li class="el-dropdown-menu__item">'+n[o]+"</li>";jQuery(".notify-content").append(l+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}}),_self.getAddress(),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var s=!0;if(jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){s=!1;var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()}),s){var e,t="";"0"!=jQuery("[name='province']").val()&&(t=jQuery("[name='province']").val()+"#"+jQuery("[name='city']").val()+"#"+jQuery("[name='district']").val()),e={customername:jQuery('div[lable="customername"]').next().children().eq(0).val(),level:jQuery('div[lable="level"]').next().children().eq(0).text(),industry:jQuery('div[lable="industry"]').next().children().eq(0).text(),source:jQuery('div[lable="source"]').next().children().eq(0).text(),telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),website:jQuery('div[lable="website"]').next().children().eq(0).val(),location:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("location"),lng:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("lng"),lat:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("lat"),province:t,city:jQuery('div[lable="detailaddress"]').next().children().eq(0).attr("city"),detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val(),pinyin:void 0===a.pinyin?"":a.pinyin,pinyinInitial:void 0===a.pinyinInitial?"":a.pinyinInitial,islock:void 0===a.islock?"":a.islock,dealstatus:void 0===a.dealstatus?"":a.dealstatus,readerUserIds:void 0===a.readerUserIds?"":a.readerUserIds,writerUserIds:void 0===a.writerUserIds?"":a.writerUserIds,createuser:void 0===a.createuser?"":a.createuser,owneruser:void 0===a.owneruser?"":a.owneruser},_self.actions.updateCustomer(_self.options.openId,e,function(e){"success"==e.type&&(_self.isCurrentItem?Showbo.Msg.alert("保存成功!",jQuery("#customer").click()):Showbo.Msg.alert("保存成功!")),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}}),jQuery(".notify").click(function(e){jQuery(e.target).closest(".inline-input[notempty='true']").length<1&&jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()})})}.bind(this))},getAddress:function(){var e=this,t=[];o2.Actions.get("x_general_assemble_control").listProvince(function(e){e.data.each(function(e){t.push(e.name)}.bind(this))}.bind(this),null,!1);for(var i="",s=0;s<t.length;s++)i=i+'<option value="'+t[s]+'">'+t[s]+"</option>";var a='<select name="province" class="select-address"><option value="0">所在省</option>'+i+'</select><select name="city" class="select-address city-address"> <option value="0">所在市</option></select> <select class="select-address" name="district"><option value="0">所在区</option></select>';if(jQuery("#province").parent().append(a),jQuery("#province").remove(),null!=e.province){var n=e.province.split("#");1<n.length&&(jQuery("[name='province']").append(new Option(n[0],n[0])),jQuery("[name='province']").val(n[0]),"0"!=n[1]&&(jQuery("[name='city']").append(new Option(n[1],n[1])),jQuery("[name='city']").val(n[1])),"0"!=n[2]&&(jQuery("[name='district']").append(new Option(n[2],n[2])),jQuery("[name='district']").val(n[2])))}jQuery("[name='province']").change(function(){"0"!=jQuery("[name='province']").val()&&e.getCity(this.value)}),jQuery("[name='city']").change(function(){"0"!=jQuery("[name='province']").val()&&"0"!=jQuery("[name='city']").val()&&e.getDistrict(jQuery("[name='province']").val(),this.value)})},getCity:function(e){jQuery("[name='city']").find("option[value!='0']").remove(),jQuery("[name='district']").find("option[value!='0']").remove();var t=jQuery("[name='city']");"所在省"!=e&&o2.Actions.get("x_general_assemble_control").listCity(e,function(e){e.data.each(function(e){jQuery(t).append(new Option(e.name,e.name))})}.bind(this),null,!1)},getDistrict:function(e,t){jQuery("[name='district']").find("option[value!='0']").remove();var i=jQuery("[name='district']");o2.Actions.get("x_general_assemble_control").listDistrict(e,t,function(e){e.data.each(function(e){jQuery(i).append(new Option(e.name,e.name))})},null,!1)},contactsCreate:function(){_self=this;var e;_self.province=null,jQuery(_self.appArea).next().attr("style",""),jQuery(_self.appArea).next().attr("class","mask");var r=_self.app.lp.contact.contactEdit,t='<div class="section-conent">';for(i in r){var s=r[i].type,a=r[i].notEmpty?r[i].notEmpty:"false",n='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" notEmpty="'+a+'" stype="'+s+'">';"textarea"==s&&(n='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" stype="'+s+'"  style="resize: none; min-height: 30.6px;"></textarea>'),"select"==s&&(n='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" notEmpty="'+a+'" stype="'+s+'" ></div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"openSelect"==s&&(n='<input type="text" class="inline-input" disabled="disabled" style="background-color:#e2ebf9;" name="'+i+'" id="'+i+'" value="'+jQuery("#notify").find("h3").text()+'" cid="'+_self.options.openId+'" stype="'+s+'">'),"datetime"==s&&(n='<input type="text" class="inline-input" readonly="readonly" name="'+i+'" id="'+i+'" notEmpty="'+a+'" stype="'+s+'">'),t=t+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+r[i].text+'</div><div class="conent-value">'+n+"</div></div>"}e='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(t+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>',jQuery(".headMoreImg").notifyMe("left","default","新建联系人","","",e,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),s=jQuery(i).attr("stype");if("datetime"==s&&_self.loadTimeContainer(jQuery(i).attr("id")),"select"==s){var a=_self.app.lp.contact;for(j in a)if(j==jQuery(i).attr("id")){var n=r[j].value.split(",");if(0<n.length){for(var l='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',o=0;o<n.length;o++)l=l+'<li class="el-dropdown-menu__item">'+n[o]+"</li>";jQuery(".notify-content").append(l+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}}),_self.getAddress(),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var s=!0;if(jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){s=!1;var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()}),s){var e,t="";"0"!=jQuery("[name='province']").val()&&(t=jQuery("[name='province']").val()+"#"+jQuery("[name='city']").val()+"#"+jQuery("[name='district']").val()),e={contactsname:jQuery('div[lable="contactsname"]').next().children().eq(0).val(),customerid:jQuery("#customername").attr("cid"),telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),email:jQuery('div[lable="email"]').next().children().eq(0).val(),decision:jQuery('div[lable="decision"]').next().children().eq(0).text(),sex:jQuery('div[lable="sex"]').next().children().eq(0).text(),post:jQuery('div[lable="post"]').next().children().eq(0).val(),province:t,detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val()},_self.actions.saveContacts(e,function(e){"success"==e.type&&(Showbo.Msg.alert("保存成功!"),_self.loadContacts()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}}),jQuery(".notify").click(function(e){jQuery(e.target).closest(".inline-input[notempty='true']").length<1&&jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()})})},businessCreate:function(){that=this,MWF.xDesktop.requireApp("CRM","ChanceEdit",function(){new MWF.xApplication.CRM.ChanceEdit(null,{},null,{app:this.app,container:this.app.content,lp:this.app.lp.chance,actions:this.actions,css:{},customer:{id:that.options.openCustomerId},callback:function(){}}).create()}.bind(this)),that.app.content.getElement("#customer").setProperty("value",that.options.openCustomerName)},editTeam:function(t){_self=this;Showbo.Msg.confirm("编辑权限",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 50px 20px;line-height:30px;font-size:16px;"><div class="handle-item-name" style="margin-top: 8px;width:60px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" tabindex="0" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" checked aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div>',function(){var e;e={distinguishName:t},1==jQuery(".ct").find("input:radio:checked").val()?_self.actions.setTeamReader(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self)):_self.actions.setTeamWriter(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))},function(){}),jQuery(".el-radio").click(function(){jQuery(this).find("input");jQuery(this).siblings().find("input[type=radio]").removeAttr("checked")})},addTeam:function(){_self=this;Showbo.Msg.confirm("添加团队成员",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">选择团队成员：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" aria-checked="true" tabindex="0" class="el-radio is-checked"><span class="el-radio__input is-checked"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 80px 20px;line-height:30px;"></div></div></div>',function(){var s="",e=!0,i=[];if(jQuery(".ct").find(".is-checked").each(function(e,t){var i=jQuery(t).children(".el-radio__label").text();"只读"==i&&(s="read"),"读写"==i&&(s="write")}),jQuery(".ct").find(".el-checkbox__original").each(function(e,t){jQuery(t).is(":checked")&&i.push(jQuery(t).val())}),""==jQuery("#selectId").text()&&(e=!1,Showbo.Msg.alert("选择团队成员!")),""==s&&(e=!1,Showbo.Msg.alert("请权限!")),e){var t;t={personList:jQuery("#selectId").text().split(","),relationTypeList:i},_self.actions.addRelevantPerson(_self.options.openId,s,t,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery(_self.appArea)[0],"selectName","selectId",0)}),jQuery(".ct").find(".el-radio").click(function(){jQuery(this).siblings().attr("class","el-radio"),jQuery(this).siblings().find("input:radio").attr("checked",!1),jQuery(this).attr("class","el-radio is-checked"),jQuery(this).find("input:radio").attr("checked",!0);jQuery(this).find(".el-radio__label").text()})},deleteTeam:function(){_self=this,Showbo.Msg.confirm("提示","此操作将移除这些团队成员是否继续?",function(){var s=[];if(jQuery(".el-table__body").find("input:checked").each(function(e,t){var i=jQuery(t).parent().parent().next();s.push(jQuery(i).attr("aid"))}),s.length<1)Showbo.Msg.alert("请选择要删除的相关团队成员!");else{var e;e={distinguishName:s},_self.actions.removeTeamMember(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam())}.bind(self))}setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)},function(){})},loadEvent:function(){that=this,jQuery(that.sectionArea).find(".tabPanel div").click(function(){jQuery(this).addClass("hit").siblings().removeClass("hit"),jQuery(that.sectionArea).find(".panes>div:eq("+jQuery(this).index()+")").show().siblings().hide(),that.createTypeHtml()}),jQuery(that.sectionArea).find(".headMoreBottonDiv").click(function(){jQuery(that.sectionArea).find(".el-dropdown-menu").toggle(100)}),jQuery(that.sectionArea).find(".el-dropdown-menu__item").click(function(){"放入公海"==jQuery(this).text()&&that.putToCustomerPool(),"更改成交状态"==jQuery(this).text()&&that.transformCustomerDealstatus(),"锁定"==jQuery(this).text()&&that.lockCustomer(),"解锁"==jQuery(this).text()&&that.unLockCustomer(),"删除"==jQuery(this).text()&&that.deleteCustomer(),"recordType"==jQuery(this).parent().attr("tid")&&(jQuery(that.sectionArea).find(".se-select-name").text(jQuery(this).text()),jQuery(this).parent().toggle(100))}),jQuery(that.sectionArea).find(".headMoveBottonDiv").click(function(){that.transfer()}),jQuery(that.sectionArea).find(".headEditBottonDiv").click(function(){that.customerEdit()}),jQuery(that.sectionArea).find(".bar-input").change(function(e){var t=e.target.id,i=e.target.files;if(i&&0<i.length){for(var s='<div class="fileList">',a=0;a<i.length;a++){var n=i[a],l=n.size/1024;s=s+'<div class="fileItem"><div class="fname">'+n.name+'</div><div class="fsize">'+that.toDecimal(l)+'kb</div><div class="ftime">'+that.getFormateTime(new Date)+"</div></div>","bar-img"==t&&that.imgArr.push(n),"bar-file"==t&&that.fileArr.push(n)}s+="</div>",jQuery(that.sectionArea).find(".mix-container").append(s)}}),jQuery(that.sectionArea).find(".se-send").click(function(){that.sendRecord()}),jQuery(that.sectionArea).find(".el-dropdown-selfdefine").click(function(){jQuery(that.sectionArea).find("[tid='recordType']").toggle(100)})},sendRecord:function(){that=this;var e;e={types:"customer",typesid:that.options.openId,content:jQuery(that.sectionArea).find(".el-textarea__inner").val(),category:jQuery(that.sectionArea).find(".se-select-name").text(),nexttime:jQuery(that.sectionArea).find(".hasDatepicker").val(),businessids:"",contactsids:"",createuser:""},that.actions.createRecord(e,function(s){if("success"==s.type){Showbo.Msg.alert("跟进记录发布成功!");var e=jQuery(that.sectionArea).find("#bar-file")[0];jQuery(that.fileArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",s.data.id,"record",i,t,function(e){}.bind(that))});var t=jQuery(that.sectionArea).find("#bar-img")[0];jQuery(that.imgArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("img",s.data.id,"record",i,t,function(e){}.bind(that))}),e.value="",t.value="",that.fileArr=[],that.imgArr=[],0<jQuery(".fileList").length&&jQuery(".fileList").remove(),jQuery(".el-textarea__inner").val(""),that.loadRecord()}}.bind(that),function(e,t,i){}.bind(that),!1)},loadRecord:function(){(that=this).actions.getRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".fl-c").remove();var s="";for(i in t)if(i<t.length){var a=t[i],n="/x_component_CRM/$Template/portrait.png";a.hasOwnProperty("ICONBase64")&&""!=a.ICONBase64&&(n="data:image/png;base64,"+a.ICONBase64);var l="";if(0<a.attachmentListPreview.length){l+='<div class="my-gallery">';var o=a.attachmentListPreview;for(j in o)if(j<o.length){var r=o[j],d=this.actions.action.address+"/jaxrs/attachment/download/"+r.id+"/work/"+r.wcrm;l=l+'<figure><div class="fl-b-img-item"><a href="'+d+'" data-size="500x400"><img style="height:100%;" src="'+d+'"></a></div><figcaption style="display:none;">'+r.name+"</figcaption></figure>"}l+="</div>"}if(0<a.attachmentList.length){l+='<div class="fl-b-files">';var c=a.attachmentList;for(j in c)if(j<c.length){var p=c[j];l=l+'<div class="vux-flexbox cell vux-flex-row"><img  src="/x_component_CRM/$Record/default/icons/att.png" class="cell-head"> <div class="cell-body">'+p.name+'<span  style="color: rgb(204, 204, 204);">（'+that.toDecimal(p.length)+'KB）</span></div><button  type="button" class="el-button el-button--primary aname" aid="'+p.id+'" wcrm="'+p.wcrm+'"><img  src="/x_component_CRM/$Record/default/icons/down.png" style="margin-bottom:-3px;"><span>下载</span></button></div>'}l+="</div>"}s=s+'<div class="fl-c"><div class="vux-flexbox fl-h vux-flex-row"><img class="div-photo fl-h-img"  style="background-image: url(&quot;'+n+'&quot;);" lazy="loaded"></img> <div class="fl-h-b"><div class="fl-h-name">'+a.person.name+'</div><div class="fl-h-time">'+a.updateTime+'</div></div></div><div class="fl-b"><div class="fl-b-content">'+a.content+"</div>"+l+'<div class="follow"><span class="follow-info">'+a.category+'</span></div></div><div  class="full-container" style="display: none;"></div></div>'}""!=s&&jQuery(that.sectionArea).find(".load").before(s),t.length<1?(jQuery(that.sectionArea).find(".load").hide(),jQuery(that.sectionArea).find(".empty-mask").show()):jQuery(that.sectionArea).find(".empty-mask").hide(),jQuery(".aname").click(function(){var e=that.actions.action.address+"/jaxrs/attachment/download/"+jQuery(this).attr("aid")+"/work/"+jQuery(this).attr("wcrm");window.open(e)}),jQuery("figure").each(function(e,t){var i=jQuery(t).find("a").attr("href"),s=new Image;s.src=i,s.complete?jQuery(t).find("a").attr("data-size",s.width+"x"+s.height):s.onload=function(){jQuery(t).find("a").attr("data-size",s.width+"x"+s.height)}}),MWF.xDesktop.requireApp("CRM","PicTool",function(){that.PicToolModule=new MWF.xApplication.CRM.PicTool(that),0<jQuery(".my-gallery").length&&that.PicToolModule.initPhotoHtml(".notify"),that.PicToolModule.initPhotoSwipeFromDOM(".my-gallery")}.bind(that)),jQuery(".my-gallery>figure>div").each(function(){jQuery(this).height(jQuery(this).width())})}}.bind(this))},open:function(e){this.fireEvent("queryOpen"),this._open(),this.fireEvent("postOpen")},create:function(){this.fireEvent("queryCreate"),this.isNew=!0,this._open(),this.fireEvent("postCreate")},edit:function(){this.fireEvent("queryEdit"),this.isEdited=!0,this._open(),this.fireEvent("postEdit")},_open:function(){if(this.options.hasMask&&(this.formMaskNode=new Element("div.formMaskNode",{styles:this.css.formMaskNode,events:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},click:function(e){e.stopPropagation()}}}).inject(this.container||this.app.content)),this.formAreaNode=new Element("div.formAreaNode",{styles:this.css.formAreaNode}),this.createFormNode(),this.formAreaNode.inject(this.formMaskNode||this.container||this.app.content,"after"),this.formAreaNode.fade("in"),this.setFormNodeSize(),this.setFormNodeSizeFun=this.setFormNodeSize.bind(this),this.app&&this.app.addEvent("resize",this.setFormNodeSizeFun),this.options.draggable&&this.formTopNode){var e=(this.container||this.app.content).getSize(),t=this.formAreaNode.getSize();this.formAreaNode.makeDraggable({handle:this.formTopNode,limit:{x:[0,e.x-t.x],y:[0,e.y-t.y]}})}},createFormNode:function(){this.formNode=new Element("div.formNode",{styles:this.css.formNode}).inject(this.formAreaNode),this.options.hasTop&&this.createTopNode(),this.options.hasIcon&&(this.formIconNode=new Element("div.formIconNode",{styles:this.isNew?this.css.formNewNode:this.css.formIconNode}).inject(this.formNode)),this.createContent(),this.options.hasBottom&&this.createBottomNode(),this._setCustom(),this.options.hasScroll&&MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.formTableContainer,{indent:!1,style:"default",where:"before",distance:30,friction:4,axis:{x:!1,y:!0},onScroll:function(e){}})}.bind(this))},createContent:function(){this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode),this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode),this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea,text:"loading..."}).inject(this.formTableContainer),this._createTableContent()},createBottomNode:function(){this.formBottomNode=new Element("div.formBottomNode",{styles:this.css.formBottomNode}).inject(this.formNode),this._createBottomContent()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title+(this.data.title?"-"+this.data.title:"")}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode),this._createTopContent())},_createTopContent:function(){},_createTableContent:function(){this.loadFormData()},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.lp.actionCancel}).inject(this.formBottomNode),(this.options.isNew||this.options.isEdited)&&(this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))),this.cancelActionNode.addEvent("click",function(e){this.cancel(e)}.bind(this))},loadFormData:function(){this.loadForm()},ok:function(e){this.fireEvent("queryOk");var t=this.form.getResult(!0,",",!0,!1,!0);t&&this._ok(t,function(e){"error"==e.type?this.app&&this.app.notice(e.message,"error"):(this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.explorer&&this.explorer.view&&this.explorer.view.reload(),this.app&&this.app.notice(this.isNew?this.lp.createSuccess:this.lp.updateSuccess,"success"),this.fireEvent("postOk"))}.bind(this))},loadForm:function(){(_self=this).form=new MForm(this.formTableArea,this.data,{style:"default",isEdited:this.isEdited||this.isNew,itemTemplate:this.lp},this.app,this.css);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>",t=this.form.itemTemplate;for(i in t)e=e+"<tr>   <td styles='formTableTitle'><span lable='"+i+"'>"+t[i].text+"</td>   <td styles='formTableValue' item='"+i+"'></td></tr>";e+="</table>",this.formTableArea.set("html",e),this.form.load(),this.isNew||this.actions.getCustomerInfo(this.options.openId,function(e){var t=e.data,i=this.formTableArea.getElements("span");for(j in i)if(j<i.length&&null!=i[j].get("name")){var s=i[j].get("name");for(var a in t)a==s&&i[j].set("text",t[a])}}.bind(this)),this.formTableArea.getElements("textarea").setStyles({height:"100px",overflow:"auto",color:"#666666"}),this.formTableArea.getElements("input").setStyles({color:"#666666"})},loadMap:function(){_self=this,_self.mapDiv=jQuery("#setMap")[0],jQuery(".section-conent").css("height",screen.height-400+"px"),_self.mapDiv&&_self.mapDiv.empty(),_self.addressModule&&delete _self.addressModule,MWF.xDesktop.requireApp("CRM","AddressExplorer",function(){_self.addressModule=new MWF.xApplication.CRM.AddressExplorer(_self.mapDiv,_self,_self.actions,{}),_self.addressModule.load()}.bind(_self))},getItemTemplate:function(e){return _self=this,{customername:{text:e.customername,type:"text",notEmpty:!0,value:this.customerData&&this.customerData.customername?this.customerData.customername:""},level:{type:"select",text:e.level,notEmpty:!0,value:this.app.lp.customer.level.value},industry:{type:"select",notEmpty:!0,text:e.industry,value:this.app.lp.customer.industry.value},source:{type:"select",text:e.source,notEmpty:!0,value:this.app.lp.customer.source.value},telephone:{type:"text",notEmpty:!0,text:e.telephone,value:this.app.lp.clue.level.value},website:{text:e.website,type:"text"},nexttime:{text:e.nexttime,notEmpty:!0,attr:{id:"nexttime"},type:"datetime"},cellphone:{text:e.cellphone,type:"text"},detailaddress:{text:e.detailaddress,type:"text"},remark:{text:e.remark,type:"textarea"},location:{text:e.location,type:"map"}}},getContactTemplate:function(e){return _self=this,{contactsname:{text:e.contactsname,type:"text",notEmpty:!0},customername:{text:e.customername,type:"openSelect",notEmpty:!0},telephone:{type:"text",text:e.telephone},cellphone:{text:e.cellphone,type:"text"},email:{type:"text",text:e.email},decision:{type:"select",text:e.decision,value:this.app.lp.contact.decision.value},post:{text:e.post,type:"text"},sex:{type:"select",text:e.sex,value:this.app.lp.contact.sex.value},detailaddress:{text:e.detailaddress,type:"text"},nexttime:{text:e.nexttime,attr:{id:"nexttime"},type:"datetime"},remark:{text:e.remark,type:"textarea"}}},selectPerson:function(e,t,a,i){var s={type:"",types:["person"],values:this.configData,count:i,zIndex:5e4,onComplete:function(e){MWF.require("MWF.widget.O2Identity",function(){var i=[],s=[];this.configData=[],this.process=null,e.each(function(e){if("i"==e.data.distinguishedName.split("@").getLast().toLowerCase()){new MWF.widget.O2Identity(e.data,it.form.getItem("invitePersonList").container,{style:"room"});i.push(e.data.distinguishedName)}else{i.push(e.data.name),s.push(e.data.distinguishedName);var t={name:e.data.name,distinguishedName:e.data.distinguishedName,employee:e.data.employee};this.configData.push(t)}}.bind(this)),0==e.length?document.getElementById(t).innerHTML="+点击选择":(document.getElementById(t).innerHTML=i.join(","),""!=a&&(document.getElementById(a).innerHTML=s.join(",")))}.bind(this))}.bind(this)};new MWF.O2Selector(e,s)},getFormateTime:function(e,t){var i=function(e){return(e+="").replace(/^(\d)$/,"0$1")},s={yyyy:e.getFullYear(),yy:e.getFullYear().toString().substring(2),M:e.getMonth()+1,MM:i(e.getMonth()+1),d:e.getDate(),dd:i(e.getDate()),hh:i(e.getHours()),mm:i(e.getMinutes()),ss:i(e.getSeconds())};return t||(t="yyyy-MM-dd hh:mm:ss"),t.replace(/([a-z])(\1)*/gi,function(e){return s[e]})},checkTime:function(e){return e<10&&(e="0"+e),e},toDecimal:function(e){if(""==e)return"";var t=parseFloat(e);return isNaN(t)?e:t=Math.round(100*e)/100},createCustomBottom:function(){this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))},_ok:function(data,callback){var saveDataStr="";for(i in this.data)saveDataStr=saveDataStr+"'"+i+"':'"+this.data[i]+"',";saveDataStr="'{"+saveDataStr.replace(/'/g,'"')+"}'";var saveData=eval("("+saveDataStr.substring(1,saveDataStr.length-1)+")");this.app.createShade(),this.actions.saveClue(saveData,function(e){this.app.destroyShade(),this.app.notice(this.lp.saveSuccess,"success"),this.close(),this.fireEvent("reloadView",e)}.bind(this),function(e,t,i){this.app.showErrorMessage(e,t,i),this.app.destroyShade()}.bind(this))}});