MWF.xApplication.CRM=MWF.xApplication.CRM||{},MWF.xDesktop.requireApp("CRM","Template",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xApplication.CRM.CustomerRead=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",width:500,height:800,top:0,left:0,hasTop:!1,hasTopIcon:!1,hasTopContent:!1,hasIcon:!0,hasScroll:!0,hasBottom:!0,hasMask:!0,marked:!0,title:"",draggable:!1,maxAction:"false",closeAction:!0,relativeToApp:!0,sizeRelateTo:"app"},initialize:function(t,e,s,i,n){this.setOptions(n),this.app=e,this.explorer=s,this.lp=e.lp.customer.customerRead,this.path="/x_component_CRM/$CustomerRead/",this.loadCss(),this.actions=i,this.node=$(t)},loadCss:function(){this.cssPath="/x_component_CRM/$CustomerRead/"+this.options.style+"/css.wcss",this._loadCss()},load:function(t){this.data=t;var e=this.explorer.formContentArr.length?this.node:this.app.content;this.options.hasMask&&(this.formMaskNode=new Element("div.formMark",{styles:this.css.formMaskNode,id:"formmark"+this.explorer.formContentArr.length,events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()},click:function(){this.destroyForm()}.bind(this)}}).inject(e)),this.createForm(),this.createTop(),this.createContent(),this.resizeWindow(),this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},reload:function(t){this.createContent(t)},reloadOpener:function(){this.fireEvent("reloadView")},destroyForm:function(){this.explorer.formMarkArr[this.explorer.formMarkArr.length-1].destroy();var t=this.explorer.formContentArr[this.explorer.formContentArr.length-1].formContent;new Fx.Tween(t).start("width",t.getWidth(),0).chain(function(){t.destroy()}),this.explorer.formContentArr.splice(this.explorer.formContentArr.length-1,1),this.explorer.formMarkArr.splice(this.explorer.formMarkArr.length-1,1)},createForm:function(){this.formContent?this.formContent.tween("width",this.options.width):(this.formContent=new Element("div.formContent",{styles:this.css.formContent}).inject(this.node),this.formContent.tween("width",this.options.width),this.formContent.setStyles({"border-left":"1px solid #ffffff"}));var t=this.explorer.formContentArr.length?parseInt(this.node.getStyle("z-index"))+1:1;this.formContent.setStyles({"z-index":t})},createTop:function(){this.topDiv=new Element("div.topDiv",{styles:this.css.topDiv}).inject(this.formContent),this.topCloseDiv=new Element("div.topCloseDiv",{styles:this.css.topCloseDiv}).inject(this.topDiv),this.topCloseDiv.addEvents({mouseenter:function(){this.setStyles({opacity:"1",filter:"alpha(opacity=100)"})},mouseleave:function(){this.topCloseDiv.setStyles(this.css.topCloseDiv)}.bind(this),click:function(){this.destroyForm()}.bind(this)})},createContent:function(e){this.contentDiv&&this.contentDiv.destroy(),this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.formContent),this.contentDiv.setStyles({height:this.formContent.getHeight()-this.topDiv.getHeight()+"px",width:"1000px"}),this.slideContentDiv=new Element("div.slideContentDiv",{styles:this.css.slideContentDiv}).inject(this.contentDiv),this.slideContentDiv.setStyles({height:this.contentDiv.getHeight()+"px",width:this.contentDiv.getWidth()-40+"px"}),this.setScrollBar(this.slideContentDiv),this.slideContentDiv.set("text","loading..."),this.actions.getCustomerInfo(this.data.id,function(t){this.slideContentDiv.set("text",""),this.customerData=t.data,this.createHeadContent(),this.createNaviContent(e)}.bind(this))},createHeadContent:function(){this.headContentDiv=new Element("div.headContentDiv",{styles:this.css.headContentDiv}).inject(this.slideContentDiv),this.customerNameDiv=new Element("div.customerNameDiv",{styles:this.css.customerNameDiv}).inject(this.headContentDiv),this.customerNameSpan=new Element("span.customerNameSpan",{styles:this.css.customerNameSpan,text:this.customerData.customername}).inject(this.customerNameDiv),this.customerMapA=new Element("a.customerMapA",{styles:this.css.customerMapA,text:this.lp.mapLocation}).inject(this.customerNameDiv),this.customerMapA.addEvents({click:function(){MWF.xDesktop.requireApp("CRM","BaiduMap",function(){this.map=new MWF.xApplication.CRM.BaiduMap(this.app.content,this.app,this.explorer,this.actions),this.map.loadMax({longitude:this.data.addresslongitude,latitude:this.data.addresslatitude})}.bind(this))}.bind(this)}),this.customerStatusDiv=new Element("div.customerStatusDiv",{styles:this.css.customerStatusDiv}).inject(this.headContentDiv),this.customerStatusInfoDiv=new Element("div.customerStatusInfoDiv",{styles:this.css.customerStatusInfoDiv}).inject(this.customerStatusDiv),this.customerStatusNumSpan=new Element("span.customerStatusNumSpan",{styles:this.css.customerStatusNumSpan,text:this.lp.TCustomerNO+": "+this.customerData.customersequence}).inject(this.customerStatusInfoDiv),this.customerStatusPersonSpan=new Element("span.customerStatusPersonSpan",{styles:this.css.customerStatusPersonSpan,text:this.lp.responsePerson+": "+this.customerData.customerownername}).inject(this.customerStatusInfoDiv),this.customerStatusInfo2Div=new Element("div.customerStatusInfo2Div",{styles:this.css.customerStatusInfoDiv}).inject(this.customerStatusDiv),this.customerStatusLevelSpan=new Element("span.customerStatusLevelSpan",{styles:this.css.customerStatusLevelSpan,text:this.lp.TCustomerLevel+": "+this.customerData.level}).inject(this.customerStatusInfo2Div),this.customerStatusStatusSpan=new Element("span.customerStatusStatusSpan",{styles:this.css.customerStatusStatusSpan,text:this.lp.TCustomerStatus+": 成交"}).inject(this.customerStatusInfo2Div),this.customerOperationDiv=new Element("div.customerOperationDiv",{styles:this.css.customerOperationDiv}).inject(this.headContentDiv)},createNaviContent:function(t){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.slideContentDiv),this.summaryNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.summary}).inject(this.naviDiv),this.summaryNavi.addEvents({click:function(){this.openTab(this.summaryNavi)}.bind(this)}),this.summaryNavi.click(),this.customerInfoNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.customerInfo}).inject(this.naviDiv),this.customerInfoNavi.addEvents({click:function(){this.openTab(this.customerInfoNavi)}.bind(this)}),this.addressNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.address}).inject(this.naviDiv),this.addressNavi.addEvents({click:function(){this.openTab(this.addressNavi)}.bind(this)}),this.contactNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.contact}).inject(this.naviDiv),this.contactNavi.addEvents({click:function(){this.openTab(this.contactNavi)}.bind(this)}),this.chanceNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.chance}).inject(this.naviDiv),this.chanceNavi.addEvents({click:function(){this.openTab(this.chanceNavi)}.bind(this)}),this.clueNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.clue}).inject(this.naviDiv),this.clueNavi.addEvents({click:function(){this.openTab(this.clueNavi)}.bind(this)}),this.bargainNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.bargain}).inject(this.naviDiv),this.bargainNavi.addEvents({click:function(){this.openTab(this.bargainNavi)}.bind(this)}),this.visitorNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.visitor}).inject(this.naviDiv),this.visitorNavi.addEvents({click:function(){this.openTab(this.visitorNavi)}.bind(this)}),this.attachmentNavi=new Element("span.naviSpan",{styles:this.css.naviSpan,text:this.lp.navi.attachment}).inject(this.naviDiv),this.attachmentNavi.addEvents({click:function(){this.openTab(this.attachmentNavi)}.bind(this)}),"customerInfo"==t&&this.customerInfoNavi.click()},openTab:function(t){this.naviDiv.getElements("span").setStyles({"border-bottom":"0px"}),t.setStyles({"border-bottom":"3px solid #ff8e31"}),t.get("text")==this.lp.navi.customerInfo&&this.createCustomerInfo()},createCustomerInfo:function(){this.contentInfoDiv&&this.contentInfoDiv.destroy(),this.contentInfoDiv=new Element("div.contentInfoDiv",{styles:this.css.contentInfoDiv}).inject(this.slideContentDiv),this.customerInfoDiv=new Element("div.customerInfoDiv",{styles:this.css.customerInfoDiv}).inject(this.contentInfoDiv),this.customerInfoDiv.setStyles({"min-height":this.contentDiv.getHeight()-this.headContentDiv.getHeight()-this.naviDiv.getHeight()-30+"px"}),this.contentToolbarDiv=new Element("div.contentToolbarDiv",{styles:this.css.contentToolbarDiv}).inject(this.customerInfoDiv),this.contentToolbarSpan=new Element("span.contentToolbarSpan",{styles:this.css.contentToolbarSpan,text:this.lp.customerInfo}).inject(this.contentToolbarDiv),this.contentToolbarBottonEditDiv=new Element("div.contentToolbarBottonDiv",{styles:this.css.contentToolbarBottonDiv,text:this.lp.editCustomer}).inject(this.contentToolbarDiv),this.contentToolbarBottonEditDiv.addEvents({click:function(){MWF.xDesktop.requireApp("CRM","CustomerEdit",function(){this.explorerForm=new MWF.xApplication.CRM.CustomerEdit(this,this.actions,{id:this.customerData.id},{isEdited:!0,isNew:!0,onReloadView:function(){this.reload("customerInfo"),this.reloadOpener()}.bind(this)}),this.explorerForm.load()}.bind(this))}.bind(this)}),this.customerDetailsDiv=new Element("div.customerDetailsDiv",{styles:this.css.customerDetailsDiv}).inject(this.customerInfoDiv);var t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv);new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerName}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.customername&&""!=this.customerData.customername?this.customerData.customername:"--"}).inject(t);t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerNO}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.customerno&&""!=this.customerData.customerno?this.customerData.customerno:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerType}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.customertype&&""!=this.customerData.customertype?this.customerData.customertype:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerLevel}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.level&&""!=this.customerData.level?this.customerData.level:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TSource}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.source&&""!=this.customerData.source?this.customerData.source:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TIndustryFirst}).inject(t);var e=this.customerData.industryfirst&&""!=this.customerData.industryfirst?this.customerData.industryfirst:"--",s=this.customerData.industrysecond&&""!=this.customerData.industrysecond?this.customerData.industrysecond:"--";new Element("span.detailsValue",{styles:this.css.detailsValue,text:e+"-"+s}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TDistrict}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.area&&""!=this.customerData.area?this.customerData.area:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TStreet}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.houseno&&""!=this.customerData.houseno?this.customerData.houseno:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TLocation}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.houseno&&""!=this.customerData.houseno?this.customerData.houseno:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TTelphone}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.telno&&""!=this.customerData.telno?this.customerData.telno:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TFax}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.customerfax&&""!=this.customerData.customerfax?this.customerData.customerfax:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TRemark}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.remark&&""!=this.customerData.remark?this.customerData.remark:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TWebSite}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.url&&""!=this.customerData.url?this.customerData.url:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TEmail}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.email&&""!=this.customerData.email?this.customerData.email:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerStatus}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.state&&""!=this.customerData.state?this.customerData.state:"--"}).inject(t),t=new Element("div.detailsDiv",{styles:this.css.detailsDiv}).inject(this.customerDetailsDiv),new Element("span.detailsTitle",{styles:this.css.detailsTitle,text:this.lp.TCustomerGrade}).inject(t),new Element("span.detailsValue",{styles:this.css.detailsValue,text:this.customerData.customerrank&&""!=this.customerData.customerrank?this.customerData.customerrank:"--"}).inject(t)},resizeWindow:function(){var t=this.formContent.getSize();this.contentDiv&&this.contentDiv.setStyles({height:t.y-this.topDiv.getHeight()+"px"}),this.slideContentDiv&&this.slideContentDiv.setStyles({height:this.formContent.getHeight()-this.topDiv.getHeight()+"px",width:this.formContent.getWidth()-40+"px"}),this.customerInfoDiv&&this.customerInfoDiv.setStyles({"min-height":this.contentDiv.getHeight()-this.headContentDiv.getHeight()-this.naviDiv.getHeight()-30+"px"})},setScrollBar:function(i,n,t,e,s){return t||(t="default"),e||(e={V:{x:0,y:0},H:{x:0,y:0}}),MWF.require("MWF.widget.ScrollBar",function(){this.scrollbar=new MWF.widget.ScrollBar(i,{style:t||"default",offset:e,indent:!1,distance:50,onScroll:function(t){var e=i.getScrollSize(),s=i.getSize();e.y-s.y<t+20&&n&&n.loadElementList&&(n.isItemsLoaded||n.loadElementList())}.bind(this)}),s&&s()}.bind(this)),!1}});