$(function(){$("#add_btn").click(function(){methods.addHandle()}),$("#show_tbody").on("click",".edit",function(){trIndex=$(".edit","#show_tbody").index($(this)),addEnter=!1,$(this).parents("tr").addClass("has_case"),methods.editHandle(trIndex)}),$("#search_btn").click(function(){methods.seachName()}),$("#back_btn").click(function(){$("#Ktext").val(" "),methods.resectList()}),$(".del").click(function(){$(this).parents("tr").remove()}),$("#renyuan").on("hide.bs.modal",function(){addEnter=!0,$("#show_tbody tr").removeClass("has_case"),$("#xztb input").val(" "),$("#xztb select").find("option:first").prop("selected",!0)})});var trIndex,addEnter=!0,noRepeat=!0,jobArr=[],phoneArr=[],tdStr="",hasNullMes=!1,tarInp=$("#xztb input"),tarSel=$("#xztb select"),methods={addHandle:function(t){hasNullMes=!1,methods.checkMustMes(),hasNullMes||(addEnter?(methods.checkRepeat(),noRepeat&&(methods.setStr(),$("#show_tbody").append("<tr>"+tdStr+"</tr>"),$("#renyuan").modal("hide"))):(methods.setStr(),$("#show_tbody tr").eq(trIndex).empty().append(tdStr),$("#renyuan").modal("hide")))},editHandle:function(t){for(var e=$("#show_tbody tr").eq(t),o=[],r=0;r<e.find("td").length-1;r++){var a=e.children("td").eq(r).html();o.push(a)}$("#renyuan").modal("show");for(var n=0;n<tarInp.length;n++)tarInp.eq(n).val(o[n]);for(var s=0;s<tarSel.length;s++){var d=s+tarInp.length;tarSel.eq(s).val(o[d])}},setStr:function(){tdStr="";for(var t=0;t<tarInp.length;t++)tdStr+="<td>"+tarInp.eq(t).val()+"</td>";for(var e=0;e<tarSel.length;e++)tdStr+="<td>"+tarSel.eq(e).val()+"</td>";tdStr+='<td><a href="#" class="edit">编辑</a> <a href="#" class="del">删除</a></td>'},seachName:function(){var t=$("#show_tbody tr"),e=$("#Ktext").val().trim(),o=[];if(""!==e){for(var r=0;r<t.length;r++){var a=$("td:first",t.eq(r)).html().trim();o.push(a)}t.hide();for(var n=0;n<o.length;n++)-1<o[n].indexOf(e)&&t.eq(n).show()}else bootbox.alert({title:"来自火星的提示",message:"搜索内容不能为空",closeButton:!1})},resectList:function(){$("#show_tbody tr").show()},checkMustMes:function(){return""===$(".userName").val().trim()?(bootbox.alert({title:"来自火星的提示",message:"姓名为必选项，请填写",closeButton:!1}),void(hasNullMes=!0)):""===$(".jobNum").val().trim()?(bootbox.alert({title:"来自火星的提示",message:"工号为必选项，请填写",closeButton:!1}),void(hasNullMes=!0)):""===$(".phoneNum").val().trim()?(bootbox.alert({title:"来自火星的提示",message:"手机号为必选项，请填写",closeButton:!1}),void(hasNullMes=!0)):void 0},checkRepeat:function(){jobArr=[],phoneArr=[];for(var t=0;t<$('#show_tbody tr:not(".has_case")').length;t++){var e='#show_tbody tr:not(".has_case"):eq('+t+")",o=$("td:eq(1)",e).html().trim(),r=$("td:eq(2)",e).html().trim();jobArr.push(o),phoneArr.push(r)}var a=$(".jobNum").val().trim(),n=$(".phoneNum").val().trim();return-1<jobArr.indexOf(a)?(noRepeat=!1,void bootbox.alert({title:"来自火星的提示",message:"工号重复了，请重新输入",closeButton:!1})):-1<phoneArr.indexOf(n)?(noRepeat=!1,void bootbox.alert({title:"来自火星的提示",message:"手机号码重复了，请重新输入",closeButton:!1})):void(noRepeat=!0)}};