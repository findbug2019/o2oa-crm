layui.define(["jquery"],function(t,g){"use strict";var v=layui.$,e=window,y=document,_={tables:{},datas:{},cols:{},jqobjs:{}},a=0,b={},x=v(e),l=null;x.resize(function(){null!=l&&clearTimeout(l),l=setTimeout(function(){for(var t in l=null,_.tables){var e=_.tables[t],i=_.datas[e.tableIndex];i&&0!==i.length&&m.utils.modifyStyle.call(e)}},20)});var m=function(t,e){this.elem=t,this.tableIndex=a;var i=v.extend({},m.option);return"boolean"==typeof e.page&&e.page&&(e.page={}),e.page&&!i.page&&(i.page={}),this.options=v.extend(!0,{},m.option2,i,e),this.options.page&&!this.options.page.limits&&(this.options.page.limits=[10,20,30,40,50,60,70,80,90]),m.utils.init.call(this),this};m.option={expandRow:!1,nowrap:!0,minHeight:80,singleSelect:!1,localSort:!0,cellMinWidth:60,loading:!0,even:!0,serialField:"id"},m.option2={version:"1.4"},v.rayTableOptions=m.option;var h=/^(20|21|22|23|(|[01])\d):(|[0-5])\d(|:(|[0-5])\d)$/,c=/^[1-9]\d{3}\/((|0)[1-9]|1[0-2])\/((|0)[1-9]|[1-2][0-9]|3[0-1])(|\s(20|21|22|23|(|[01])\d):(|[0-5])\d(|:(|[0-5])\d))$/;Array.prototype.contains=function(t){for(var e in this)if(this[e]===t)return!0;return!1},Array.prototype.raysort=function(r,t){return r&&(this.sort(function(t,e){var i=t[r],a=e[r];if(i&&!a)return 1;if(!i&&a)return-1;var l=typeof i;if(l!==typeof a)return a<i?1:-1;if("number"===l)return i-a;if(!isNaN(i)&&!isNaN(a))return parseFloat(i)-parseFloat(a);var n=i.replace(/-/g,"/"),s=a.replace(/-/g,"/"),o=c.test(n)||h.test(n),d=c.test(s)||h.test(s);return o&&d?new Date(n)-new Date(s):a<i?1:-1}),t&&this.reverse()),this};var i=0;function w(){return i++}m.utils={initDefault:function(){var t=v("<div/>").appendTo(v("body"));t.width(100).height(100).css("overflow","scroll");var e=t[0];b.width=e.offsetHeight-e.clientHeight,b.height=e.offsetWidth-e.clientWidth,t.remove()},init:function(){var h=this,t=v(this.elem),b=h.options;b.data&&b.data instanceof Array?_.datas[h.tableIndex]=b.data:_.datas[h.tableIndex]=[];var i=!1,c=_.cols[h.tableIndex]=[];b.colsCount=0,b.autoColNums=0,b.minWidth=0,b.autoCols={};var f,u=b.cellcss={},p={},e=((f=[]).push('<table class="laytable-head"><thead>'),v(b.cols).each(function(t,e){f.push("<tr>"),!i&&b.expandRow&&(i=!0,f.push('<th rowspan="'+b.cols.length+'"><span class="laytable-expand"></span></th>'),b.minWidth+=37),v(e).each(function(t,e){var i,a,l="laytable-cell-"+h.tableIndex+"-"+(e.field?e.field:w()),n=u[l]={},s="laytable-cell-head-"+h.tableIndex+"-"+(e.field?e.field:w()),o=p[s]={};if(e.field){var d="laytable-cell-data-"+h.tableIndex+"-"+(e.field?e.field:w());i=p[d]={}}if(e.field&&c.push(e),!e.hidden&&e.field){if(e.width)/^\d+$/.test(e.width)?(n.width=e.width+"px",n["min-width"]=Math.min(b.cellMinWidth,e.width)+"px",b.minWidth+=e.width):(/^\d+%$/.test(e.width)||"*"===e.width)&&(b.widthType=!0,n.width=e.width,n["min-width"]=b.cellMinWidth+"px",b.minWidth+=b.cellMinWidth);else{var r=e.minWidth||b.cellMinWidth;n["min-width"]=r+"px",b.minWidth+=r,b.autoCols[e.field]={},b.autoCols[e.field].minWidth=r,b.autoColNums++}b.colsCount++}e.align&&(n["text-align"]=e.align),e.style&&function(){for(var t in e.style)o[t]=e.style[t]}(),e.field&&e.dataStyle&&function(){for(var t in e.dataStyle)i[t]=e.dataStyle[t]}(),f.push('<th class="'+l),f.push(e.field&&e.resize?" laytable-cell-resize":""),f.push(e.style?" "+s:""),f.push(e.hidden?" hidden":""),f.push(e.sort?" laytable-sort-th":""),f.push(b.nowrap?" nowrap":""),f.push('"'),f.push(e.colspan?" colspan="+e.colspan:""),f.push(e.fixed?" fixed="+e.fixed:""),f.push(e.rowspan?" rowspan="+e.rowspan:""),f.push(e.field?' data-field="'+e.field+'"':""),f.push(e.islink?" islink":""),f.push(">"),a="chk"===e.field?'<input type="checkbox" class="rayui-chk" chk="all" '+(b.singleSelect?"disabled":"")+"/>":e.title===g?"":e.title,a+=e.sort?'<span class="laytable-sort-span"><i class="laytable-sort laytable-desc"></i><i class="laytable-sort laytable-asc" ></i></span>':"",f.push(b.nowrap?'<div class="'+l+" "+s+'">'+a+"</div>":a),f.push("</th>")}),f.push("</tr>")}),f.push("</thead></table>"),f.join("")),a='<table class="laytable-body"'+(b.even?" ray-even":"")+"><tbody></tbody></table>",l=['<div class="laytable-box" style="',"min-height:"+b.minHeight+"px",b.width?";width:"+b.width+"px":"",'"',b.skin?' skin="'+b.skin+'"':"",">",'<div class="laytable-head-boxmain">','<div class="laytable-head-box">',e,"</div>","</div>",'<div class="laytable-body-boxmain">','<div class="laytable-body-box" scroll-left=1>',a,"</div>","</div>",'<div class="laytable-fixed laytable-fixed-l"></div>','<div class="laytable-fixed laytable-fixed-r"></div>',b.page?'<div class="laytable-page-boxmain" style="text-align:'+b.page.align+'"></div>':"",'<div class="laytable-style">',"</div>","<style>",function(){var t,e=[];for(var i in p){for(var a in t=!0,p[i])t&&(e.push("."+i+"{"),t=!1),e.push(a+":"+p[i][a]+";");t||e.push("}")}return e.join("")}(),"</style>","</div>"].join("");t.after(l),m.utils.jqSelector.call(h),b.url?(m.utils.initHeight.call(h),m.utils.ajaxData.call(h)):m.utils.onRecvData.call(h)},jqSelector:function(){var t=_.jqobjs[this.tableIndex]={};t.tb_box=v(this.elem).next("div.laytable-box"),t.tb_fixed=t.tb_box.find(">div.laytable-fixed"),t.tb_fixed_l=t.tb_box.find(">div.laytable-fixed-l"),t.tb_fixed_r=t.tb_box.find(">div.laytable-fixed-r"),t.tb_head_boxmain=t.tb_box.find("div.laytable-head-boxmain"),t.tb_head_box=t.tb_head_boxmain.find("div.laytable-head-box"),t.tb_head_fixed_l=t.tb_head_boxmain.find("div.laytable-fixed-l"),t.tb_head_fixed_r=t.tb_head_boxmain.find("div.laytable-fixed-r"),t.tb_head=t.tb_head_box.find(">table"),t.tb_body_boxmain=t.tb_box.find("div.laytable-body-boxmain"),t.tb_body_box=t.tb_body_boxmain.find("div.laytable-body-box"),t.tb_body_fixed_l=t.tb_body_boxmain.find("div.laytable-fixed-l"),t.tb_body_fixed_r=t.tb_body_boxmain.find("div.laytable-fixed-r"),t.tb_body=t.tb_body_box.find(">table"),t.tb_page_box=t.tb_box.find("div.laytable-page-boxmain"),t.tb_head_body=t.tb_box.find("div.laytable-head-boxmain>div.laytable-head-box>table,div.laytable-body-boxmain>div.laytable-body-box>table"),t.div_style=t.tb_box.find("div.laytable-style")},onRecvData:function(){var t=this,e=t.options;if(e.initComplete==g){e.initComplete=!0;var i=_.jqobjs[t.tableIndex];e.minWidth+=e.colsCount,i.tb_head_body.css("min-width",e.minWidth+"px"),m.utils.renderData.call(t),m.utils.initStyle.call(t),m.utils.initPage.call(t),m.utils.initFixedHead.call(t),m.utils.changePaging.call(t),m.utils.modifyStyle.call(t),m.utils.addEvents.call(t)}else m.utils.renderData.call(t),m.utils.changePaging.call(t),m.utils.modifyStyle.call(t)},ajaxData:function(){var a=this,l=a.options;m.utils.showError.call(a,0),m.utils.loading.call(a,1);var t={};l.where&&v.extend(t,l.where),l.page&&v.extend(t,{page:l.page.curr,limit:l.page.limit}),l.initSort&&v.extend(t,l.initSort),v.ajax({type:l.method||"get",url:l.url,data:t,dataType:"json",beforeSend:function(t){"function"==typeof l.onAjaxBeforeSend&&!1===l.onAjaxBeforeSend.call(this,t)&&t.abort()},success:function(t){m.utils.clearData.call(a),"function"==typeof l.onAjaxSuccess&&(t=l.onAjaxSuccess.call(this,t)||t);var e=t.ret;0!==e&&m.utils.showError.call(a,t.msg||"返回的数据状态异常"),_.datas[a.tableIndex]=t.data||[],l.page.count=t.count||0,0===e&&m.utils.onRecvData.call(a),"function"==typeof l.onComplete&&l.onComplete(t)},error:function(t,e,i){m.utils.showError.call(a,"请求数据接口异常"),"function"==typeof l.onAjaxError&&l.onAjaxError.call(this,t,e,i)},complete:function(){m.utils.loading.call(a,0)}})},loading:function(t){var e=this.options;if(e.loading){var i=_.jqobjs[this.tableIndex],a=i.tb_box,l=i.tb_box.find("div.laytable-loading");0!==t?1===t&&e.loading&&e.url&&v('<div class="laytable-loading"/>').css({width:a.width()+"px",height:a.height()+"px"}).appendTo(a):l.remove()}},showError:function(t){var e=_.jqobjs[this.tableIndex],i=e.tb_body_box.find("div.laytable-msg");0!==t?(0===i.length&&(i=v('<div class="laytable-msg"/>').appendTo(e.tb_body_box)),i.html(t)):i.remove()},initStyle:function(){var t=this.options,e=_.jqobjs[this.tableIndex];if(t.cellcss){var i,a,l=t.cellcss,n=[];for(a in n.push("<style>"),l){for(var s in i=!0,l[a])i&&(n.push("."+a+"{"),i=!1),n.push(s+":"+l[a][s]+";");i||n.push("}")}for(var o in n.push("</style>"),e.div_style.html(n.join("")),i=!0,t.autoCols){i=!1,a=".laytable-cell-"+this.tableIndex+"-"+o;var d=m.utils.getCssStyle.call(this,a);t.autoCols[o].style=d}i&&(t.autoCols=g),t.cellcss=g}},modifyStyle:function(){m.utils.fullHeight.call(this),m.utils.fullWidth.call(this),m.utils.adjustPercentWidth.call(this),m.utils.modifyFixedHeight.call(this)},initFixedHead:function(){var a,l,t=_.jqobjs[this.tableIndex],e=t.tb_head,i=t.tb_box.offset().top,n=[],s=[],o=-1e3,d=-1e3;(e.find("tr").each(function(){a=l=!1;var i=v(this);v(this).find("th").each(function(){var t,e=v(this).attr("fixed");"left"===e?(-1e3===o&&(o=v(this).offset().top),a||(a=!0,n.push('<tr style="height:'+i.height()+'px">')),t=v(this).clone(),n.push(t[0].outerHTML)):"right"===e&&(-1e3===d&&(d=v(this).offset().top),l||(l=!0,s.push('<tr style="height:'+i.height()+'px">')),t=v(this).clone(),s.push(t[0].outerHTML))}),a&&n.push("</tr>"),l&&s.push("</tr>")}),0!==n.length)&&v('<div class="laytable-head-box" />').html('<table class="laytable-head"><thead>'+n.join("")+"</thead></table>").prependTo(t.tb_fixed_l.css("top",o-i-1+"px"));if(0!==s.length){var r=v('<div class="laytable-head-box" />');r.html('<table class="laytable-head"><thead>'+s.join("")+"</thead></table>").prependTo(t.tb_fixed_r.css("top",d-i-1+"px")),t.tb_fixed_r.css("right",b.width+"px"),t.tb_box.find(".laytable-fixed-amend").height(r.height()-1).css("top",d-i-2+"px").css("right",b.width-49+"px")}},renderData:function(){var f=this,t=_.jqobjs[f.tableIndex],i=t.tb_body.find(">tbody"),u=f.options,e=m.utils.getData.call(f);if(m.utils.clearData.call(f),u.initSort&&t.tb_box.find(".laytable-head th[data-field="+u.initSort.sortField+"]").attr("sort-type",u.initSort.sortType),0!==e.length){if(u.colspanDefs&&u.colspanDefs instanceof Array){var a,l={},n=e[0],s=e.length;if(1<s)for(v.each(u.colspanDefs,function(t,e){n.hasOwnProperty(e)&&(n[e+"rowspan"]=1,l[e]=n)}),a=1;a<s;a++){var o=e[a];for(var d in l)o[d]===l[d][d]?(l[d][d+"rowspan"]++,o[d+"rowspan"]=-1):(l[d]=o)[d+"rowspan"]=1}l=null}var r=t.tb_fixed_l.find("div.laytable-body-noscroll table>tbody"),h=t.tb_fixed_r.find("div.laytable-body-noscroll table>tbody"),p=_.cols[f.tableIndex],y=[],x=[];v(e).each(function(d,r){var h=[],b=[],c=[];"function"==typeof u.onBeforeAddRow&&u.onBeforeAddRow(d,r),h.push("<tr data-index="+d+">"),u.expandRow&&h.push('<td><a class="laytable-expand"></a></td>'),v.each(p,function(t,e){var i,a=[],l=e.field,n="laytable-cell-"+f.tableIndex+"-"+l,s=r[l+"rowspan"];a.push('<td data-field="'+l+'"'),s!==g&&1<s&&a.push(" rowspan="+s),a.push(' class="'+n),u.nowrap||a.push(" laytable-cell-data-"+f.tableIndex+"-"+l),a.push(e.hidden?" hidden":""),a.push(u.nowrap?" nowrap":""),s!==g&&-1===s&&a.push(" hiddenImp"),a.push('"'),a.push(e.islink?" islink":""),a.push(">"),"function"==typeof e.formatter?i=e.formatter(r[l],r,d):"chk"===l?i='<input type="checkbox" class="rayui-chk" chk="row"/>':(i=r[l],"html"===e.dataType&&i!==g&&""!==i&&(i=i.replace(/[<>&"]/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]}))),i!==g&&""!==i||(i="&nbsp;"),a.push(u.nowrap?'<div class="'+n+" laytable-cell-data-"+f.tableIndex+"-"+l+'">'+i+"</div>":i),a.push("</td>");var o=a.join("");h.push(o),"left"===e.fixed&&b.push(o),"right"===e.fixed&&c.push(o)}),h.push("</tr>");var t=h.join(""),e=v(""+t);e.appendTo(i),0<b.length&&(y.push("<tr data-index="+d+' style="height:'+e.height()+'px">'+b.join("")+"</tr>"),b=[]),0<c.length&&(x.push("<tr data-index="+d+' style="height:'+e.height()+'px">'+c.join("")+"</tr>"),c=[]),"function"==typeof u.onAddRow&&u.onAddRow(d,e,r)}),e=null,0<y.length&&(0===r.length?v('<div class="laytable-body-noscroll" />').html(v('<div class="laytable-body-box" />').html('<table class="laytable-body"'+(u.even?" ray-even":"")+">"+y.join("")+"</table>")).appendTo(t.tb_fixed_l):r.html(y.join(""))),0<x.length&&(0===h.length?(v('<div class="laytable-body-noscroll" />').html(v('<div class="laytable-body-box" />').html('<table class="laytable-body"'+(u.even?" ray-even":"")+">"+x.join("")+"</table>")).appendTo(t.tb_fixed_r),v('<div class="laytable-fixed-amend"/>').appendTo(t.tb_box)):h.html(x.join("")))}else m.utils.showError.call(f,"无数据")},initHeight:function(){var t,e=v(this.elem),i=this.options,a=_.jqobjs[this.tableIndex],l=a.tb_head_box,n=a.tb_page_box,s=a.tb_body_box;if(!i.heightSetting&&(i.heightSetting=i.height),/^full-\d+$/.test(i.heightSetting))t=i.heightSetting.split("-")[1],i.height=x.height()-t;else if(/^sel-[#|.][\w]+-\d+$/.test(i.heightSetting)){t=e.offset().top;var o=i.heightSetting.split("-");v(""+o[1]).each(function(){t+=v(this).outerHeight()}),3===o.length&&(t+=parseInt(o[2])),i.height=x.height()-t}i.height<i.minHeight&&(i.height=i.minHeight);var d=i.height-l.outerHeight()-n.outerHeight()-2;s.outerHeight(d)},fullHeight:function(){var t=this.options,e=_.jqobjs[this.tableIndex],i=e.tb_head_box,a=e.tb_body_box;/^\d+$/.test(t.heightSetting)||m.utils.initHeight.call(this);var l=a[0];l.scrollHeight>l.clientHeight?(i.css("margin-right",b.width+"px"),e.tb_fixed_r.find("tr>td:last,th:last").removeClass("last"),e.tb_fixed_r.css("right",b.width+"px")):(i.css("margin-right","0"),e.tb_fixed_r.find("tr").each(function(){v(this).find("td:last,th:last").addClass("last")}),e.tb_fixed_r.css("right","0"));var n=e.tb_box.find(".laytable-body").find("tr:last");a.find(".laytable-body").outerHeight()>=a.outerHeight()?n.addClass("last"):n.removeClass("last")},fullWidth:function(){var t=this.options,e=_.jqobjs[this.tableIndex],i=e.tb_body.find("tr:first"),a=e.tb_body_box,l=a[0];if(t.autoCols&&!t.resized){var n,s;for(n in t.autoCols)t.autoCols[n].style.style.width="",t.autoCols[n].minWidth;if(l.clientWidth>t.minWidth&&e.tb_head_body.css("width","100%"),t.nowrap){var o,d=0;if(l.clientWidth>t.minWidth){var r=l.clientWidth-t.minWidth;d=Math.floor(r/t.autoColNums)}for(n in t.autoCols)(o=t.autoCols[n]).style.style.width=o.minWidth+d+"px"}else for(n in t.autoCols)s=i.find("td[data-field="+n+"]").outerWidth(),t.autoCols[n].style.style.width=s-1+"px";e.tb_head_box.scrollLeft(a.scrollLeft())}var h=Math.min(l.clientHeight,e.tb_body.height());e.tb_box.find("div.laytable-fixed .laytable-body-noscroll").each(function(){var t=v(this).find(">.laytable-body-box"),e=t.find(".laytable-body").width();t.outerHeight(h).outerWidth(e+b.width),v(this).outerWidth(e)}),a.find(".laytable-body").outerWidth()<l.clientWidth?(e.tb_body.find("tr>td.last").removeClass("last"),e.tb_head.find("tr>th.last").removeClass("last")):(e.tb_body.find("tr").each(function(){v(this).find("td:last").addClass("last")}),e.tb_head.find("tr").each(function(){v(this).find("th:last").addClass("last")}))},adjustPercentWidth:function(){var o=this,d=o.options,t=_.jqobjs[o.tableIndex];if(d.widthType&&!d.resized){var r,e=_.cols[o.tableIndex],h=t.tb_head_box.width()-e.length,b=h;v.each(e,function(t,e){var i=e.field,a=".laytable-cell-"+o.tableIndex+"-"+i,l=m.utils.getCssStyle.call(o,a);if("*"===e.width)return r=l,!0;var n=e.width.replace("%",""),s=h/100*parseFloat(n);return s=Math.floor(s),l.style.width=s+"px",s<d.cellMinWidth&&(l.style["min-width"]=s+"px"),b-=s,s,!0}),r&&(r.style.width=b+"px",b<d.cellMinWidth&&(r.style["min-width"]=b+"px"))}},modifyFixedHeight:function(t){var e=_.jqobjs[this.tableIndex],i=e.tb_body_box[0],a=e.tb_fixed_r,l=this.options;if(!l.nowrap){var n=e.tb_body.find(">tbody"),s=e.tb_fixed.find(".laytable-body-box>table");0<s.length&&n.find("tr").each(function(t){s.find("tr:eq("+t+")").outerHeight(v(this).outerHeight())})}if(t||0<l.autoColNums){var o,d,r=e.tb_fixed_l.find(".laytable-head"),h=e.tb_fixed_r.find(".laytable-head"),b=e.tb_head,c=b.find("tr").length,f=r.find("tr").length;if(0<f)for(o=c-1,d=f-1;0<=d;)r.find("tr:eq("+d--+")").height(b.find("tr:eq("+o--+")").height());if(0<(f=h.find("tr").length)){o=c-1,d=f-1;for(var u,p=0;0<=d;)p+=u=b.find("tr:eq("+o--+")").height(),h.find("tr:eq("+d--+")").height(u);e.tb_box.find("div.laytable-fixed-amend").height(p-1)}}0<a.children().length&&(i.scrollWidth>i.clientWidth?(a.removeClass("blowout-right"),i.scrollHeight>i.clientHeight&&e.tb_box.find("div.laytable-fixed-amend").removeClass("hidden")):(a.addClass("blowout-right"),e.tb_box.find("div.laytable-fixed-amend").addClass("hidden")))},getPageData:function(){var t=this.options.page,e=_.datas[this.tableIndex],i=[],a=e.length,l=0,n=e.length;for(t&&(l=1===t.curr?0:(t.curr-1)*t.limit,n=t.curr*t.limit);l<n&&!(a<=l);)i.push(e[l++]);return i},initPage:function(){var t=_.jqobjs[this.tableIndex],e=this.options,i=e.page;if(i){var a=_.datas[this.tableIndex];if(0!==a.length&&(i.limits.contains(i.limit)||(i.limits.push(i.limit),i.limits.sort(function(t,e){return t-e})),e.url||-1!==i.count||(i.count=a.length),0!==i.count)){var l=t.tb_page_box,n=i.curr,s=["&nbsp;&nbsp;",'<span class="laytable-page-count">共 '+i.count+" 条</span>",'<ul class="laytable-page-pagination">',"</ul>","<span>到第&nbsp;</span>",'<input type="text" class="rayui-input laytable-page-input" min="1" value="'+n+'" />&nbsp;页',"&nbsp;&nbsp;",'<a class="rayui-btn laytable-page-btnok">确定</a>'].join("");l.html(s)}}},changePaging:function(){var t=this.options;if(t.page){var e=_.jqobjs[this.tableIndex],i=e.tb_page_box.find(".laytable-page-pagination"),n=t.page,s=Math.ceil(n.count/n.limit);n.pages=s,n.curr<=0?n.curr=1:n.curr>s&&(n.curr=s);var o=n.curr,a=n.count,l=['<li><a class="page-item page-prev'+(1===o||0===a?" rayui-disabled":"")+'" value="-1">&lt;</a></li>',function(){var t=s<n.groups?s:n.groups,e=Math.floor((t-1)/2),i=Math.max(t,s<o+e?s:o+e),a=i-t<1?1:i-t+1,l=[];for(1<a&&l.push('<li><a class="page-item" value="1">1</a></li>'),2<a&&l.push("<li>...</li>");a<=i;)l.push('<li><a class="page-item" value="'+a+'">'+a+++"</a></li>");return i<s-1&&l.push("<li>...</li>"),i<s&&l.push('<li><a class="page-item" value="'+s+'">'+s+"</a></li>"),l.join("")}(),'<li><a class="page-item page-last'+(o===s||0===a?" rayui-disabled":"")+'" value="+1">&gt;</a></li>'];i.html(l.join("")),i.find("li>a[value="+n.curr+"]").addClass("page-active"),e.tb_page_box.find(".laytable-page-count").html("共 "+n.count+" 条")}},clearData:function(){var t=_.jqobjs[this.tableIndex],e=t.tb_body.find(">tbody"),i=t.tb_fixed_l.find("div.laytable-body-noscroll table>tbody"),a=t.tb_fixed_r.find("div.laytable-body-noscroll table>tbody");e.html(""),i.html(""),a.html(""),t.tb_fixed_l.find(".laytable-body-box").css("height",""),t.tb_fixed_r.find(".laytable-body-box").css("height","")},deleteData:function(t){var e,i,a,l,n=this.options,s=n.serialField,o=s!==g,d=_.datas[this.tableIndex];if(n.url||!n.page)e=0,i=d.length-1,a=d.length;else{var r=n.page;e=1===r.curr?0:(r.curr-1)*r.limit,i=r.curr*r.limit,a=d.length}if(o&&d[0].hasOwnProperty(s))for(;e<i&&!(a<=e);){if(d[e][s]===t[s])return void d.splice(e,1);e++}else for(l=JSON.stringify(t);e<i&&!(a<=e);){if(JSON.stringify(d[e])===l)return void d.splice(e,1);e++}},reloadx:function(t){t!==g&&v.extend(!0,this.options,t);var e=t;this.options=t,this.elem=t.elem,this.tableIndex=0;var i=e.page;i&&(i.curr<=0&&(i.curr=1),i.curr>i.pages&&(i.curr=i.pages)),e.url?m.utils.ajaxData.call(this):m.utils.onRecvData.call(this)},reload:function(t){t!==g&&v.extend(!0,this.options,t);var e=this.options,i=e.page;i&&(i.curr<=0&&(i.curr=1),i.curr>i.pages&&(i.curr=i.pages)),e.url?m.utils.ajaxData.call(this):m.utils.onRecvData.call(this)},getCssStyle:function(i){var a,t=_.jqobjs[this.tableIndex].div_style.find("style")[0],e=t.sheet||t.styleSheet,l=e.cssRules||e.rules;return v(l).each(function(t,e){return i!==e.selectorText||(a=e,!1)}),a},getData:function(){var t=this.options,e=t.url?_.datas[this.tableIndex]:m.utils.getPageData.call(this);return 1<e.length&&t.initSort&&t.localSort&&e.raysort(t.initSort.sortField,"desc"===t.initSort.sortType),e},addEvents:function(){var n=this,s={},t=v(y),d=v("body"),r=_.jqobjs[n.tableIndex],o=r.tb_head_body,e=r.tb_box.find("div.laytable-body-box"),i=r.tb_page_box,h=n.options,b=!1,a=h.page;r.tb_box.find(".laytable-head").on("mousemove.laytable","th[class*=laytable-cell-resize]",function(t){if(!s.resizeStart){var e=v(this),i=e.offset().left,a=t.clientX-i;s.allowResize=e.outerWidth()-a<=10,d.css("cursor",s.allowResize?"col-resize":"")}}).on("mouseleave.laytable","th[class*=laytable-cell-resize]",function(){s.resizeStart||d.css("cursor","")}).on("mousedown.laytable","th[class*=laytable-cell-resize]",function(t){if(s.allowResize){t.preventDefault();var e=v(this);s.elem=this,s.width=e.width(),s.resizeStart=!0;var i=".laytable-cell-"+n.tableIndex+"-"+v(s.elem).data("field");s.cssRule=m.utils.getCssStyle.call(n,i);var a=parseFloat(e.css("min-width").replace("px",""));s.minWidth=0===a?h.cellMinWidth:a,s.offset=t.clientX;var l=o.eq(0);s.tb_width=l.outerWidth(),s.tb_minwidth=parseFloat(l.css("min-width").replace("px",""))}}),t.on("mousemove.laytable",function(t){if(s.resizeStart){if(t.preventDefault(),s.elem){h.resized=!0;var e=t.clientX-s.offset,i=s.width+e;if(i>s.minWidth){s.cssRule.style.width=i+"px";var a=s.tb_width+e;o.outerWidth(a),a<s.tb_minwidth&&o.css("min-width",a+"px"),m.utils.fullWidth.call(n),m.utils.modifyFixedHeight.call(n,!0)}}b=!0}}).on("mouseup.laytable",function(t){s.resizeStart&&(s={},d.css("cursor",""))});var l=r.tb_box.find("div.laytable-body-box>table");1<l.length&&l.on("mouseenter.laytable","tr",function(){l.find("tr:eq("+v(this).index()+")").addClass("laytable-tr-hover")}).on("mouseleave.laytable","tr",function(){l.find("tr:eq("+v(this).index()+")").removeClass("laytable-tr-hover")});var c=function(){"1"===v(this).attr("scroll-left")&&r.tb_head_box.scrollLeft(v(this).scrollLeft()),e.not(this).scrollTop(v(this).scrollTop()),0===v(this).scrollLeft()?v(".laytable-fixed-l").css("box-shadow",""):v(".laytable-fixed-l").css("box-shadow","0px -1px 8px rgba(0,0,0,0.08)")};e.on("scroll.laytable",c),e.hover(function(){e.not(this).off("scroll.laytable",c)},function(){e.off("scroll.laytable",c).on("scroll.laytable",c)});var f=r.tb_fixed_l.find(".laytable-head-box").length,u=0<f?r.tb_fixed_l:r.tb_box;u.on("click.laytableChk","input.rayui-chk",function(){var t,e=v(this).attr("chk"),i=this.checked;if("all"===e)return r.tb_box.find("input.rayui-chk").not(this).prop("checked",i),t={type:"all",index:-1,checked:i},void("function"==typeof h.onCheck&&h.onCheck.call(this,t));var a=v(this).closest("tr").index();if(h.singleSelect){var l=u.find("input.rayui-chk:checked").not(this);if(r.tb_box.find("input.rayui-chk:checked").not(this).prop("checked",!1),0<l.length&&"function"==typeof h.onCheck){var n=l.closest("tr").index();l.prop("checked",!1),t={type:"one",index:n,checked:!1},h.onCheck.call(l,t)}}if(0<f&&r.tb_box.find(".laytable-body").find("tr:eq("+a+") input.rayui-chk").prop("checked",i),!h.singleSelect){var s=r.tb_box.find(".laytable-head input.rayui-chk"),o=!!i&&u.find(".laytable-body input.rayui-chk").length===u.find(".laytable-body input.rayui-chk:checked").length;s.prop("checked",o)}t={type:"one",index:a,checked:i},"function"==typeof h.onCheck&&h.onCheck.call(this,t)}),i.on("change.laytable","select.laytable-page-limits",function(){var t=a.limit;a.limit=parseInt(v(this).val()),a.pages=Math.ceil(a.count/a.limit),h.onPageLimitChanged&&h.onPageLimitChanged(t,a.limit),m.utils.reload.call(n)});var p=r.tb_box.find("th.laytable-sort-th");r.tb_box.on("click.laytableSort","th.laytable-sort-th,span.laytable-sort-span>i",function(t){if(t.stopPropagation(),b)b=!1;else{var e,i,a;if("I"===this.tagName)e=(a=v(this).closest("th")).data("field"),i=-1<v(this).prop("class").indexOf("asc")?"asc":"desc";else{a=v(this);var l=v(this).attr("sort-type");e=v(this).data("field"),i=l===g?"asc":"asc"===l?"desc":"asc"}p.attr("sort-type",""),a.attr("sort-type",i),!h.initSort&&(h.initSort={}),h.initSort.sortField=e,h.initSort.sortType=i,"function"==typeof h.onSort&&h.onSort(h.initSort),m.utils.reload.call(n)}}),r.tb_box.on("click.laytableShow",'td.nowrap:not("[islink]")',function(){var t=v(this).find("div")[0]||this;if(t.scrollWidth>v(t).outerWidth()){var e=v(".laytable-tips");0===e.length&&(e=v('<div class="laytable-tips"><div class="laytable-tips-content"></div></div>').appendTo(d),v('<i class="laytable-tips-close"></i>').appendTo(e).click(function(){e.remove()})),e.find(".laytable-tips-content").html(v(t).html());var i,a=x.width(),l=v(this).offset(),n=l.top-1,s=e.outerWidth();if(500<s&&(s=500),l.left+s<a)i=l.left;else{var o=l.left+v(t).outerWidth();o<s&&(s=o),i=o-s}e.css({width:s+"px",top:n+"px",left:i+"px"})}})},on:function(t,o){if("string"==typeof t&&"function"==typeof o){var d=this,r=d.options,e=_.jqobjs[d.tableIndex],l=e.tb_body;switch(t){case"tool":e.tb_box.on("click.laytableTool",".laytable-body td[data-field^=opts] *[event]",function(){var t=v(this).attr("event"),e=v(this).closest("tr").data("index"),i=m.utils.getData.call(d)[e],a={index:e,data:i,tr:l.find("tr[data-index="+e+"]"),del:function(){m.utils.deleteData.call(d,i),r.page&&(r.page.count-=1),m.utils.onRecvData.call(d)},update:function(){m.utils.onRecvData.call(d)}};o.call(this,t,a)});break;case"expand":e.tb_box.on("click.laytableExpand","td>a.laytable-expand",function(){var t=v(this).closest("tr"),e=t.attr("expand");if(e===g){var i=t.data("index"),a=m.utils.getData.call(d)[i],l=v(["<tr>",'<td><span class="laytable-expand"></span></td>','<td colspan="'+r.colsCount+'">','<div class="laytable-expand-box">',"</div>","</td>","</tr>"].join(""));t.attr("expand","1").after(l);var n=l.find(".laytable-expand-box"),s=o.call(this,i,a,n);null!=s&&n.append(s)}else"1"===e?(t.next("tr").hide(),t.attr("expand","0")):(t.next("tr").show(),t.attr("expand","1"))});break;case"sort":r.onSort=o;break;case"check":r.onCheck=o}}}},m.prototype={on:function(t,e){m.utils.on.call(this,t,e)},reload:function(t){m.utils.reload.call(this,t)},getSelectedRows:function(){var e=[],t=_.jqobjs[this.tableIndex].tb_body,i=m.utils.getData.call(this);return t.find("input.rayui-chk").each(function(t){this.checked&&e.push({index:t,data:i[t]})}),e},getData:function(){return m.utils.getData.call(this)},getDataByIndex:function(t){return-1===t?[]:m.utils.getData.call(this)[t]}},t("table2",{options:m.option,render:function(t){b.width||m.utils.initDefault();var e=t.elem;if(0===v(e).length)return"DOM对象不存在";var i=new m(e,t);return _.tables[a++]=i},reload:function(t){this.options=t,this.elem=t.elem,m.utils.reload(t)}})});