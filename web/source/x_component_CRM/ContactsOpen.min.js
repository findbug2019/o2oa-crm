MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xApplication.CRM.ContactsOpen=new Class({Extends:MWF.xApplication.CRM.Template.PopupForm,Implements:[Options,Events],options:{style:"default",width:"800",height:"100%",top:0,left:0,hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0},initialize:function(e,t,i,s){this.setOptions(s),this.explorer=e,this.app=e.app,this.lp=this.app.lp.contact.contactEdit,this.path="/x_component_CRM/$ClueEdit/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=i||{},this.actions=t,this.imgArr=[],this.fileArr=[],this.configData=[],this.province=null},load:function(){(that=this).loadResource(function(){this.appArea=jQuery("body").children(":first"),this.createForm(),this.loadEvent()}.bind(this))},loadResource:function(e){e&&e()},createForm:function(){var e=(that=this).options.openName,t=that.getNotifyMax(),i=this.options.openStyle?this.options.openStyle:this.xxx;jQuery(".headMoreImg").notifyMe("right","default",e,'<div class = "headBottonDiv"><div class="headMoveBottonDiv">转移</div><div class="headEditBottonDiv">编辑</div><div class="headMoreBottonDiv"><span>更多</span><img class="headMoreImg" src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div>','<ul class="el-dropdown-menu"><li class="el-dropdown-menu__item">删除</li><div class="popper__arrow"></div></ul>',"",t,500,i),this.createContentHtml(t)},getNotifyMax:function(){var e="notify",n=0;return this.options.openType&&"single"==this.options.openType||(jQuery(".notify").each(function(e,t){var i=jQuery(t).attr("id"),s=0;0<i.indexOf("_")?(s=parseInt(i.split("_")[1]),n<s&&(n=s)):0==n&&(n=1)}),0<n&&(e=e+"_"+n)),e},createContentHtml:function(e){(that=this).sectionArea=jQuery("body")[0].getElement("#"+e),this.actions.getContactsInfo(this.options.openId,function(e){var t=e.data;that.options.openCustomerName=t.customer.customername,that.options.openCustomerId=t.customer.id;var i=""==t.owneruser||void 0===t.owneruser?"--":t.owneruser.split("@")[0],s="<div class = 'briefdiv'><div class='div-inline'><div class='div-title'>客户名称</div><div class='div-value'>"+t.customer.customername+"</div></div><div class='div-inline'><div class='div-title'>负责人</div><div class='div-value'>"+i+"</div></div><div class='div-inline'><div class='div-title'>手机</div><div class='div-value'>"+t.cellphone+"</div></div><div class='div-inline'><div class='div-title'>更新时间</div><div class='div-value'>"+t.updateTime+"</div></div></div>";this.sectionArea.getElement(".notify-content").set("html",s+"<div class='tabPanel'><div class='hit'>跟进记录</div><div style='width:30px'></div><div>基本信息</div><div style='width:30px'></div><div style='display:none'>商机</div><div style='width:30px;display:none'></div><div>附件</div><div style='width:30px'></div><div>操作记录</div></div><div class='panes'><div class='pane' id='tab-follow' style='display:block;'><p>First tab content</p></div><div></div><div class='pane' id='tab-basicinfo'><p>Secend tab content</p></div><div></div><div class='pane' id='tab-business'><p>business tab content</p></div><div></div><div class='pane' id='tab-att'><p>Third tab content</p></div><div></div><div class='pane' id='tab-options'><p>Four tab content</p></div></div>");var n=this.sectionArea.getSize();this.sectionArea.getElement(".panes").setStyles({height:n.y-250+"px"});that.sectionArea.getElement("#tab-follow").set("html",'<div ><div class="mix-container"><div class="i-cont"><div class="el-textarea el-input--suffix"><textarea autocomplete="off" placeholder="请输入内容" class="el-textarea__inner" style="resize: none; min-height: 57px; height: 57px;"></textarea></div></div><div class="vux-flexbox bar-cont vux-flex-row"><div class="vux-flexbox bar-item vux-flex-row"><input type="file" id="bar-img" accept="image/*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/img.png" class="bar-img"><div class="bar-title">图片</div></div><div class="splitdiv"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="vux-flexbox bar-item vux-flex-row" style="padding-left:0px;"><input type="file" id="bar-file" accept="*.*" multiple="multiple" class="bar-input"><img src="/x_component_CRM/$Template/file.png" class="bar-img"><div class="bar-title">附件</div></div></div></div><div  class="vux-flexbox se-section vux-flex-row"><div class="se-name">记录类型</div><div class="el-dropdown" style="margin-right: 20px;"><div class="vux-flexbox se-select vux-flex-row el-dropdown-selfdefine " ><div class="se-select-name">微信</div> <div class="el-icon-arrow-down el-icon--right"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div></div> </div><div class="se-name">下次联系时间</div><div class="el-date-editor se-datepicker el-input el-input--prefix el-input--suffix el-date-editor--datetime"><input type="text"  autocomplete="off" name="" placeholder="选择日期" class="el-input__inner" id="stime" readonly="readonly"><span class="el-input__prefix"><i class="el-input__icon el-icon-time"></i></span><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon"></i></span></span></div><button type="button" class="el-button se-send el-button--primary"><span>发布</span></button></div><ul class="el-dropdown-type" style="display: none;" tid = "recordType"><li class="el-dropdown-menu__item">微信</li><li class="el-dropdown-menu__item">邮箱</li><li class="el-dropdown-menu__item">电话</li><li class="el-dropdown-menu__item">地址</li><div class="popper__arrow"></div></ul><div class="log-cont"><div class="log-inner1"><div class="log-inner2"><div class="log-items"><div class="load"><button  type="button" class="el-button el-button--text"><span>没有更多了</span></button></div></div><div class="empty-mask" style="display: none;"><div class="empty-content"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div><div class="el-loading-mask" style="display: none;"><div class="el-loading-spinner"><svg viewBox="25 25 50 50" class="circular"><circle cx="50" cy="50" r="20" fill="none" class="path"></circle></svg></div></div></div></div>'),that.loadTimeContainer("stime"),that.loadRecord()}.bind(this))},createTypeHtml:function(){var e=jQuery(this.sectionArea).find(".hit").text();"基本信息"==e&&this.getContactsInfo(),"商机"==e&&this.loadBusiness(),"附件"==e&&this.loadAttachment(),"操作记录"==e&&this.loadOptions()},loadTimeContainer:function(e){jQuery("#"+e).ymdateplugin({showTimePanel:!0})},getContactsInfo:function(){(_self=this).actions.getContactsInfo(this.options.openId,function(e){var t=e.data,s=_self.lp,n='<div class="section-conent">';for(i in s){var a="";a="customername"==i?void 0===t.customer?"":t.customer.customername:void 0===t[i]?"":t[i],n=n+'<div class="conent-inline"><div class="conent-title">'+s[i].text+'</div><div class="conent-value">'+a+"</div></div>"}n+="</div>",jQuery(_self.sectionArea).find("#tab-basicinfo").html('<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+n)}.bind(this))},loadAttachment:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item"><span>上传附件</span></div> <input  type="file" id="afile" accept="*/*" multiple="multiple" class="rc-head-file"></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 40%;height:40px;"><div class="cell">附件名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_28     is-leaf" style="width: 10%;"><div class="cell">附件大小</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">上传人</div></th><th colspan="1" rowspan="1" class="el-table_3_column_30     is-leaf" style="width: 20%;"><div class="cell">上传时间</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 10%;"><div class="cell">操作</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-att").html(e),jQuery(that.sectionArea).find("#afile").change(function(e){var t=jQuery(that.sectionArea).find("#afile")[0].files;jQuery(t).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",that.options.openId,"contacts",i,t,function(e){"success"==e.type&&that.getAttachment()}.bind(that))})}),that.getAttachment()},getAttachment:function(){(that=this).actions.getAttachment(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var n=t[i],a=n.length/1024,o=n.lastUpdatePerson;o=o.split("@")[0],s=s+'<tr><td style="width: 40%;height:40px;" class="aname" aid="'+n.id+'" wcrm="'+n.wcrm+'">'+n.name+'</td><td style="width: 10%;">'+that.toDecimal(a)+'kb</td><td style="width: 20%;">'+o+'</td><td style="width: 20%;">'+n.updateTime+'</td><td class="attOption">删除</td></tr>'}""!=s&&(jQuery(that.sectionArea).find(".el-table__body").children().html(s),jQuery(that.sectionArea).find(".el-table__empty-block").hide(),jQuery(that.sectionArea).find(".attOption").click(function(){self=this,Showbo.Msg.confirm("提示","确定删除该附件吗?",function(){var e=jQuery(self).parent().children(":first").attr("aid");e&&""!=e&&that.actions.delAttachment(e,function(e){"success"==e.type&&jQuery(that.sectionArea).find(".hit").click()}.bind(self))},function(){})}),jQuery(that.sectionArea).find(".aname").click(function(){var e=that.actions.action.address+"/jaxrs/attachment/download/"+jQuery(this).attr("aid")+"/work/"+jQuery(this).attr("wcrm");window.open(e)}))}}.bind(that))},loadBusiness:function(){that=this;var e='<div class="rc-cont">';e+='<div class="vux-flexbox rc-head vux-flex-row" style="flex-direction: row-reverse;"><div class="rc-head-item" style="width: 75px;"></div></div><div  class="el-table el-table--fit el-table--striped el-table--enable-row-hover" header-align="center" style="width: 100%; border: 1px solid rgb(230, 230, 230); height: 500px;" align="center"><div class="el-table__header-wrapper"><table class="el-table__header" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><thead class="has-gutter"><tr class=""><th colspan="1" rowspan="1" class="el-table_3_column_27     is-leaf" style="width: 30%;height:40px;"><div class="cell">商机名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">商品金额</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 30%;"><div class="cell">客户名称</div></th><th colspan="1" rowspan="1" class="el-table_3_column_29     is-leaf" style="width: 20%;"><div class="cell">商机状态组</div></th><th colspan="1" rowspan="1" class="el-table_3_column_26     is-leaf" style="width: 20%;"><div class="cell">状态</div></th></tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none" style="height: 450px;"><table class="el-table__body" style="width: 100%;" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table><div class="el-table__empty-block" style="width: 100%;"><span class="el-table__empty-text">暂无数据</span></div></div></div></div>',jQuery(that.sectionArea).find("#tab-business").html(e),this.actions.listOpportunityByContactsId(this.options.openId,function(e){if("success"==e.type){var t=e.data,s="";for(i in t)if(i<t.length){var n=t[i];s=s+'<tr><td style="width: 30%;height:40px;" class="aname" aid="'+n.id+'">'+n.opportunityname+'</td><td style="width: 20%;">'+n.money+'</td><td style="width: 30%;">'+n.customername+'</td><td style="width: 20%;">'+n.opportunitytypename+'</td><td style="width: 20%;">'+n.opportunitystatusname+"</td></tr>"}""!=s&&(jQuery(".el-table__body").children().html(s),jQuery(".el-table__empty-block").hide())}}.bind(that)),jQuery(that.sectionArea).find("#tab-business").find(".rc-head-item").click(function(){that.businessCreate()}),jQuery(that.sectionArea).find("#tab-business").find(".aname").click(function(){})},loadOptions:function(){that=this;jQuery(that.sectionArea).find("#tab-options").html('<div class="rc-cont"><div class="empty-mask" style="display:none;height:370px;"><div class="empty-content" style="margin-top:0px;"><img src="/x_component_CRM/$Template/empty.png" class="empty-icon"> <p class="empty-text">没有找到数据</p></div></div></div>'),this.actions.getOptionsRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".rc-cont").find(".vux-flexbox").remove();var s="";for(i in t)if(i<t.length){var n=t[i],a="/x_component_CRM/$Template/portrait.png";n.hasOwnProperty("ICONBase64")&&""!=n.ICONBase64&&(a="data:image/png;base64,"+n.ICONBase64);var o=n.updateTime;s=s+'<div class="vux-flexbox ha-cont vux-flex-row" style="justify-content: flex-start; align-items: stretch;"><div class="ha-week">'+n.DateCN+'</div><div class="ha-circle"></div> <div class="ha-time">'+o.substring(11,16)+'</div><div class="div-photo ha-img xs-photo-parent--relative" style="background-image: url(&quot;'+a+'&quot;);" lazy="error"><div class="photo-wrap"></div></div><div class="ha-name">'+n.person.name+'</div><div class="ha-content">'+n.content+'</div><div class="ha-line"></div></div>'}""!=s&&jQuery(that.sectionArea).find(".rc-cont").append(s),t.length<1&&jQuery(that.sectionArea).find(".empty-mask").show()}}.bind(this))},transfer:function(){_self=this;Showbo.Msg.confirm("联系人转移",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 80px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">变更负责人为：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div>',function(){if(""==jQuery("#selectId").text())Showbo.Msg.alert("请选择负责人!");else{var e;e={distinguishName:jQuery("#selectId").text(),transferType:"1"},_self.actions.contactsTransfer(_self.options.openId,e,function(e){"success"==e.type&&Showbo.Msg.alert("操作成功!",jQuery("#contact").click()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery(_self.appArea)[0],"selectName","selectId",0)})},contactsEdit:function(){(_self=this).actions.getContactsInfo(this.options.openId,function(e){jQuery(_self.appArea).next().attr("style",""),jQuery(_self.appArea).next().attr("class","mask");var n=e.data,r=_self.lp,t='<div class="section-conent">';for(i in r)if(r[i].hasOwnProperty("type")){var s=r[i].type,a=r[i].notEmpty?r[i].notEmpty:"false",o='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" notEmpty="'+a+'" stype="'+s+'" value="'+(void 0===n[i]?"":n[i])+'">';if("datetime"==s&&(o='<input type="text" class="inline-input"  readonly="readonly" name="'+i+'" id="'+i+'" notEmpty="'+a+'" stype="'+s+'" value="'+(void 0===n[i]?"":n[i])+'">'),"textarea"==s&&(o='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" notEmpty="'+a+'" stype="'+s+'"  style="resize: none; min-height: 30.6px;">'+n[i]+"</textarea>"),"select"==s&&(o='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" notEmpty="'+a+'" stype="'+s+'" >'+(void 0===n[i]?"":n[i])+'</div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"customername"==i){var l=void 0===n.customer?"":n.customer.customername,c=void 0===n.customer?"":n.customer.id;o='<input type="text" class="inline-input"  readonly="true" style="background-color: #e2ebf9;cursor:pointer;" name="'+i+'" id="'+i+'" notEmpty="'+a+'" stype="'+s+'" cid = "'+c+'" value="'+l+'">'}"hide"!=s&&(t=t+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+r[i].text+'</div><div class="conent-value">'+o+"</div></div>"),"所在地区"==r[i].text&&(_self.province=void 0===n[i]?"":n[i])}var d='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(t+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>';jQuery(".headMoreImg").notifyMe("left","default","编辑联系人","","",d,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),s=jQuery(i).attr("stype");if("datetime"==s&&_self.loadTimeContainer(jQuery(i).attr("id")),"openSelect"==s&&jQuery(t).click(function(){_sself=_self.lp,_sself.cancel="关闭",_sself.ok="确定",_self.selectCustomer=new MWF.xApplication.CRM.ContactsOpen.selectForm(null,{},null,{app:_self,container:jQuery("#notifyEdit")[0],lp:_sself,actions:_self.actions,css:{}}),_self.selectCustomer.create()}),"select"==s){var n=_self.app.lp.contact;for(j in n)if(j==jQuery(i).attr("id")){var a=r[j].value.split(",");if(0<a.length){for(var o='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',l=0;l<a.length;l++)o=o+'<li class="el-dropdown-menu__item">'+a[l]+"</li>";jQuery(".notify-content").append(o+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}}),_self.getAddress(),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var s=!0;if(jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){s=!1;var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()}),s){var e,t="";"0"!=jQuery("[name='province']").val()&&(t=jQuery("[name='province']").val()+"#"+jQuery("[name='city']").val()+"#"+jQuery("[name='district']").val()),e={contactsname:jQuery('div[lable="contactsname"]').next().children().eq(0).val(),customerid:jQuery('div[lable="customername"]').next().children().eq(0).attr("cid"),pinyin:void 0===n.pinyin?"":n.pinyin,pinyinInitial:void 0===n.pinyinInitial?"":n.pinyinInitial,telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),email:jQuery('div[lable="email"]').next().children().eq(0).val(),decision:jQuery('div[lable="decision"]').next().children().eq(0).text(),post:jQuery('div[lable="post"]').next().children().eq(0).val(),sex:jQuery('div[lable="sex"]').next().children().eq(0).text(),detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val(),province:t,readerUserIds:void 0===n.readerUserIds?"":n.readerUserIds,writerUserIds:void 0===n.writerUserIds?"":n.writerUserIds,createuser:void 0===n.createuser?"":n.createuser,owneruser:void 0===n.owneruser?"":n.owneruser},_self.actions.updateContacts(_self.options.openId,e,function(e){"success"==e.type&&Showbo.Msg.alert("保存成功!",jQuery("#contact").click()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}}),jQuery(".notify").click(function(e){jQuery(e.target).closest(".inline-input[notempty='true']").length<1&&jQuery(".inline-input[notempty='true']").each(function(e,t){if(""==jQuery(t).val()&&""==jQuery(t).text()){var i=jQuery(t).parent().prev().text()+"不能为空";0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove(),jQuery(t).parent().append('<div class="empError" style="color:#f56c6c;padding: 0;line-height: 1;">'+i+"</div>")}else 0<jQuery(t).nextAll(".empError").length&&jQuery(t).nextAll(".empError").remove()})})}.bind(this))},getAddress:function(){var e=this,t=[];o2.Actions.get("x_general_assemble_control").listProvince(function(e){e.data.each(function(e){t.push(e.name)}.bind(this))}.bind(this),null,!1);for(var i="",s=0;s<t.length;s++)i=i+'<option value="'+t[s]+'">'+t[s]+"</option>";var n='<select name="province" class="select-address"><option value="0">所在省</option>'+i+'</select><select name="city" class="select-address city-address"> <option value="0">所在市</option></select> <select class="select-address" name="district"><option value="0">所在区</option></select>';if(jQuery("#province").parent().append(n),jQuery("#province").remove(),null!=e.province){var a=e.province.split("#");1<a.length&&(jQuery("[name='province']").append(new Option(a[0],a[0])),jQuery("[name='province']").val(a[0]),"0"!=a[1]&&(jQuery("[name='city']").append(new Option(a[1],a[1])),jQuery("[name='city']").val(a[1])),"0"!=a[2]&&(jQuery("[name='district']").append(new Option(a[2],a[2])),jQuery("[name='district']").val(a[2])))}jQuery("[name='province']").change(function(){"0"!=jQuery("[name='province']").val()&&e.getCity(this.value)}),jQuery("[name='city']").change(function(){"0"!=jQuery("[name='province']").val()&&"0"!=jQuery("[name='city']").val()&&e.getDistrict(jQuery("[name='province']").val(),this.value)})},getCity:function(e){jQuery("[name='city']").find("option[value!='0']").remove(),jQuery("[name='district']").find("option[value!='0']").remove();var t=jQuery("[name='city']");"所在省"!=e&&o2.Actions.get("x_general_assemble_control").listCity(e,function(e){e.data.each(function(e){jQuery(t).append(new Option(e.name,e.name))})}.bind(this),null,!1)},getDistrict:function(e,t){jQuery("[name='district']").find("option[value!='0']").remove();var i=jQuery("[name='district']");o2.Actions.get("x_general_assemble_control").listDistrict(e,t,function(e){e.data.each(function(e){jQuery(i).append(new Option(e.name,e.name))})},null,!1)},contactsCreate:function(){_self=this;var e;jQuery(_self.appArea).next().attr("style",""),jQuery(_self.appArea).next().attr("class","mask");var r=_self.app.lp.contact.contactEdit,t='<div class="section-conent">';for(i in r){var s=r[i].type,n='<input type="text" class="inline-input" name="'+i+'" id="'+i+'" stype="'+s+'">';"textarea"==s&&(n='<textarea rows="6" class="el-textarea__inner"  id="'+i+'" stype="'+s+'"  style="resize: none; min-height: 30.6px;"></textarea>'),"select"==s&&(n='<div class="inline-input" style="display: inline-block;cursor:pointer;"  id="'+i+'" stype="'+s+'" ></div><div class="el-icon-arrow-down el-icon--right" style="margin-left: -20px; display: inline-block;"><img src="/x_component_CRM/$Clue/default/icons/arrow.png"></div>'),"readonly"==s&&(n='<input type="text" class="inline-input" disabled="disabled" style="background-color:#e6e6e6;" name="'+i+'" id="'+i+'" value="'+jQuery("#notify").find("h3").text()+'" cid="'+_self.options.openId+'" stype="'+s+'">'),t=t+'<div class="conent-inline"><div class="conent-title" lable="'+i+'">'+r[i].text+'</div><div class="conent-value">'+n+"</div></div>"}e='<div class="section-header"><div class="section-mark" style="border-left-color: rgb(70, 205, 207);"></div> <div data-v-ec8f8850="" class="section-title">基本信息</div></div>'+(t+="</div>")+'<div class="section_button"><div><button class="el-button handle-button el-button-cancle"><span>取消</span></button><button class="el-button handle-button el-button-primary"><span>保存</span></button></div></div>',jQuery(".headMoreImg").notifyMe("left","default","新建联系人","","",e,"notifyEdit",50),jQuery(".conent-value").each(function(e,t){var i=jQuery(t).children().eq(0),s=jQuery(i).attr("stype");if("datetime"==s&&_self.loadTimeContainer(jQuery(i).attr("id")),"select"==s){var n=_self.app.lp.contact;for(j in n)if(j==jQuery(i).attr("id")){var a=r[j].value.split(",");if(0<a.length){for(var o='<ul class="el-dropdown-type" style="display: none;" tid="'+jQuery(i).attr("id")+'">',l=0;l<a.length;l++)o=o+'<li class="el-dropdown-menu__item">'+a[l]+"</li>";jQuery(".notify-content").append(o+'<div class="popper__arrow"></div></ul>'),jQuery(i).click(function(){jQuery("[tid='"+jQuery(i).attr("id")+"']").css({left:jQuery(i).offset().left-50,top:jQuery(i).offset().top+30,width:282}),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)}),jQuery("[tid='"+jQuery(i).attr("id")+"']").children().click(function(){jQuery(i).text(jQuery(this).text()),jQuery("[tid='"+jQuery(i).attr("id")+"']").toggle(100)})}}}}),jQuery(".el-button-cancle").click(function(){setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}),jQuery(".el-button-primary").click(function(){var e,t=jQuery("[name='province']").val()+"#"+jQuery("[name='city']").val()+"#"+jQuery("[name='district']").val();e={contactsname:jQuery('div[lable="contactsname"]').next().children().eq(0).val(),customerid:jQuery("#customername").attr("cid"),telephone:jQuery('div[lable="telephone"]').next().children().eq(0).val(),cellphone:jQuery('div[lable="cellphone"]').next().children().eq(0).val(),email:jQuery('div[lable="email"]').next().children().eq(0).val(),decision:jQuery('div[lable="decision"]').next().children().eq(0).text(),sex:jQuery('div[lable="sex"]').next().children().eq(0).text(),post:jQuery('div[lable="post"]').next().children().eq(0).val(),province:t,detailaddress:jQuery('div[lable="detailaddress"]').next().children().eq(0).val(),nexttime:jQuery('div[lable="nexttime"]').next().children().eq(0).val(),remark:jQuery('div[lable="remark"]').next().children().eq(0).val()},_self.actions.saveContacts(e,function(e){"success"==e.type&&(Showbo.Msg.alert("保存成功!",jQuery("#contact").click()),_self.loadContacts()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))})},editTeam:function(t){_self=this;Showbo.Msg.confirm("编辑权限",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 50px 20px;line-height:30px;font-size:16px;"><div class="handle-item-name" style="margin-top: 8px;width:60px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" tabindex="0" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" checked aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div>',function(){var e;e={distinguishName:t},1==jQuery(".ct").find("input:radio:checked").val()?_self.actions.setTeamReader(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self)):_self.actions.setTeamWriter(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))},function(){}),jQuery(".el-radio").click(function(){jQuery(this).find("input");jQuery(this).siblings().find("input[type=radio]").removeAttr("checked")})},addTeam:function(){_self=this;Showbo.Msg.confirm("添加团队成员",'<div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 30px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">选择团队成员：</div><div class="el-select handle-item-content" style="margin-top: 8px;"><div class="se-select-name" id="selectName" style="display: inline-block;">+点击选择</div><div id="selectId" style="display:none;"></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 0px 20px;line-height:30px;"><div class="handle-item-name" style="margin-top: 8px;width:100px;">权限：</div><div  role="radiogroup" class="el-radio-group"><label  role="radio" aria-checked="true" tabindex="0" class="el-radio is-checked"><span class="el-radio__input is-checked"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="1"></span><span class="el-radio__label">只读</span></label><label role="radio" tabindex="-1" class="el-radio"><span class="el-radio__input"><span class="el-radio__inner"></span><input type="radio" aria-hidden="true" tabindex="-1" class="el-radio__original" value="2"></span><span class="el-radio__label">读写</span></label></div></div></div><div  class="vux-flexbox handle-item vux-flex-row" style="align-items: stretch;padding: 10px 20px 80px 20px;line-height:30px;"></div></div></div>',function(){var s="",e=!0,i=[];if(jQuery(".ct").find(".is-checked").each(function(e,t){var i=jQuery(t).children(".el-radio__label").text();"只读"==i&&(s="read"),"读写"==i&&(s="write")}),jQuery(".ct").find(".el-checkbox__original").each(function(e,t){jQuery(t).is(":checked")&&i.push(jQuery(t).val())}),""==jQuery("#selectId").text()&&(e=!1,Showbo.Msg.alert("选择团队成员!")),""==s&&(e=!1,Showbo.Msg.alert("请权限!")),e){var t;t={personList:jQuery("#selectId").text().split(","),relationTypeList:i},_self.actions.addRelevantPerson(_self.options.openId,s,t,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam()),setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)}.bind(_self))}},function(){}),jQuery(".ct").find(".se-select-name").click(function(){_self.selectPerson(jQuery(_self.appArea)[0],"selectName","selectId",0)}),jQuery(".ct").find(".el-radio").click(function(){jQuery(this).siblings().attr("class","el-radio"),jQuery(this).siblings().find("input:radio").attr("checked",!1),jQuery(this).attr("class","el-radio is-checked"),jQuery(this).find("input:radio").attr("checked",!0);jQuery(this).find(".el-radio__label").text()})},deleteTeam:function(){_self=this,Showbo.Msg.confirm("提示","此操作将移除这些团队成员是否继续?",function(){var s=[];if(jQuery(".el-table__body").find("input:checked").each(function(e,t){var i=jQuery(t).parent().parent().next();s.push(jQuery(i).attr("aid"))}),s.length<1)Showbo.Msg.alert("请选择要删除的相关团队成员!");else{var e;e={distinguishName:s},_self.actions.removeTeamMember(_self.options.openId,e,function(e){"success"==e.type&&(Showbo.Msg.alert("操作成功!"),_self.loadTeam())}.bind(self))}setTimeout(function(){jQuery("#notifyEdit").remove(),0<jQuery(".mask").length&&(jQuery(".mask").attr("style","left: 0px; top: 0px; width: 100%; overflow: hidden; position: absolute; z-index: 500000; background-color: rgb(255, 255, 255)"),jQuery(".mask").attr("class",""))},200)},function(){})},businessCreate:function(){that=this,MWF.xDesktop.requireApp("CRM","ChanceEdit",function(){new MWF.xApplication.CRM.ChanceEdit(null,{},null,{app:this.app,container:this.app.content,lp:this.app.lp.chance,actions:this.actions,css:{},customer:{id:that.options.openCustomerId},callback:function(){}}).create()}.bind(this)),that.app.content.getElement("#customer").setProperty("value",that.options.openCustomerName)},loadEvent:function(){that=this,jQuery(that.sectionArea).find(".tabPanel div").click(function(){jQuery(this).addClass("hit").siblings().removeClass("hit"),jQuery(that.sectionArea).find(".panes>div:eq("+jQuery(this).index()+")").show().siblings().hide(),that.createTypeHtml()}),jQuery(that.sectionArea).find(".headMoreBottonDiv").click(function(){jQuery(that.sectionArea).find(".el-dropdown-menu").toggle(100)}),jQuery(that.sectionArea).find(".el-dropdown-menu__item").click(function(){"删除"==jQuery(this).text()&&that.deleteContacks(),"recordType"==jQuery(this).parent().attr("tid")&&(jQuery(that.sectionArea).find(".se-select-name").text(jQuery(this).text()),jQuery(this).parent().toggle(100))}),jQuery(that.sectionArea).find(".headMoveBottonDiv").click(function(){that.transfer()}),jQuery(that.sectionArea).find(".headEditBottonDiv").click(function(){that.contactsEdit()}),jQuery(that.sectionArea).find(".bar-input").change(function(e){var t=e.target.files,i=e.target.id;if(t&&0<t.length){for(var s='<div class="fileList">',n=0;n<t.length;n++){var a=t[n],o=a.size/1024;s=s+'<div class="fileItem"><div class="fname">'+a.name+'</div><div class="fsize">'+that.toDecimal(o)+'kb</div><div class="ftime">'+that.getFormateTime(new Date)+"</div></div>","bar-img"==i&&that.imgArr.push(a),"bar-file"==i&&that.fileArr.push(a)}s+="</div>",jQuery(that.sectionArea).find(".mix-container").append(s)}}),jQuery(that.sectionArea).find(".se-send").click(function(){that.sendRecord()}),jQuery(that.sectionArea).find(".el-dropdown-selfdefine").click(function(){jQuery("[tid='recordType']").toggle(100)})},sendRecord:function(){that=this;var e;e={types:"contacts",typesid:that.options.openId,content:jQuery(that.sectionArea).find(".el-textarea__inner").val(),category:jQuery(that.sectionArea).find(".se-select-name").text(),nexttime:jQuery(that.sectionArea).find(".hasDatepicker").val(),businessids:"",contactsids:"",createuser:""},that.actions.createRecord(e,function(s){if("success"==s.type){Showbo.Msg.alert("跟进记录发布成功!");var e=jQuery(that.sectionArea).find("#bar-file")[0];jQuery(that.fileArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("att",s.data.id,"record",i,t,function(e){}.bind(that))});var t=jQuery(that.sectionArea).find("#bar-img")[0];jQuery(that.imgArr).each(function(e,t){t.name;var i=new FormData;i.append("fileName",t.name),i.append("file",t),that.actions.updateAttachment("img",s.data.id,"record",i,t,function(e){}.bind(that))}),e.value="",t.value="",that.fileArr=[],that.imgArr=[],0<jQuery(".fileList").length&&jQuery(".fileList").remove(),jQuery(".el-textarea__inner").val(""),that.loadRecord()}}.bind(that),function(e,t,i){}.bind(that))},loadRecord:function(){this.actions.getRecord(this.options.openId,function(e){if("success"==e.type){var t=e.data;jQuery(that.sectionArea).find(".fl-c").remove();var s="";for(i in t)if(i<t.length){var n=t[i],a="/x_component_CRM/$Template/portrait.png";n.hasOwnProperty("ICONBase64")&&""!=n.ICONBase64&&(a="data:image/png;base64,"+n.ICONBase64);var o="";if(0<n.attachmentListPreview.length){o+='<div class="my-gallery">';var l=n.attachmentListPreview;for(j in l)if(j<l.length){var r=l[j],c=this.actions.action.address+"/jaxrs/attachment/download/"+r.id+"/work/"+r.wcrm;o=o+'<figure><div class="fl-b-img-item"><a href="'+c+'" data-size="500x400"><img style="height:100%;" src="'+c+'"></a></div><figcaption style="display:none;">'+r.name+"</figcaption></figure>"}o+="</div>"}if(0<n.attachmentList.length){o+='<div class="fl-b-files">';var d=n.attachmentList;for(j in d)if(j<d.length){var p=d[j];o=o+'<div class="vux-flexbox cell vux-flex-row"><img  src="/x_component_CRM/$Record/default/icons/att.png" class="cell-head"> <div class="cell-body">'+p.name+'<span  style="color: rgb(204, 204, 204);">（'+that.toDecimal(p.length)+'KB）</span></div><button  type="button" class="el-button el-button--primary aname" aid="'+p.id+'" wcrm="'+p.wcrm+'"><img  src="/x_component_CRM/$Record/default/icons/down.png" style="margin-bottom:-3px;"><span>下载</span></button></div>'}o+="</div>"}s=s+'<div class="fl-c"><div class="vux-flexbox fl-h vux-flex-row"><div class="div-photo fl-h-img"  style="background-image: url(&quot;'+a+'&quot;);" lazy="loaded"></div> <div class="fl-h-b"><div class="fl-h-name">'+n.person.name+'</div><div class="fl-h-time">'+n.updateTime+'</div></div></div><div class="fl-b"><div class="fl-b-content">'+n.content+"</div>"+o+'<div class="follow"><span class="follow-info">'+n.category+'</span></div></div><div  class="full-container" style="display: none;"></div></div>'}""!=s&&jQuery(that.sectionArea).find(".load").before(s),t.length<1?(jQuery(that.sectionArea).find(".load").hide(),jQuery(that.sectionArea).find(".empty-mask").show()):jQuery(that.sectionArea).find(".empty-mask").hide(),jQuery(".aname").click(function(){var e=that.actions.action.address+"/jaxrs/attachment/download/"+jQuery(this).attr("aid")+"/work/"+jQuery(this).attr("wcrm");window.open(e)}),jQuery("figure").each(function(e,t){var i=jQuery(t).find("a").attr("href"),s=new Image;s.src=i,s.complete?jQuery(t).find("a").attr("data-size",s.width+"x"+s.height):s.onload=function(){jQuery(t).find("a").attr("data-size",s.width+"x"+s.height)}}),MWF.xDesktop.requireApp("CRM","PicTool",function(){that.PicToolModule=new MWF.xApplication.CRM.PicTool(that),0<jQuery(".my-gallery").length&&that.PicToolModule.initPhotoHtml(".notify"),that.PicToolModule.initPhotoSwipeFromDOM(".my-gallery")}.bind(that)),jQuery(".my-gallery>figure>div").each(function(){jQuery(this).height(jQuery(this).width())})}}.bind(this))},deleteContacks:function(){_self=this,Showbo.Msg.confirm("提示","确定要删除此联系人吗?",function(){_self.confirmDelContacts()},function(){})},confirmDelContacts:function(){this.actions.deleteContacts(this.options.openId,function(e){"success"==e.type&&(this.isCurrentItem,Showbo.Msg.alert("删除成功!",jQuery("#contact").click()))}.bind(this))},open:function(e){this.fireEvent("queryOpen"),this._open(),this.fireEvent("postOpen")},create:function(){this.fireEvent("queryCreate"),this.isNew=!0,this._open(),this.fireEvent("postCreate")},edit:function(){this.fireEvent("queryEdit"),this.isEdited=!0,this._open(),this.fireEvent("postEdit")},_open:function(){if(this.options.hasMask&&(this.formMaskNode=new Element("div.formMaskNode",{styles:this.css.formMaskNode,events:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},click:function(e){e.stopPropagation()}}}).inject(this.container||this.app.content)),this.formAreaNode=new Element("div.formAreaNode",{styles:this.css.formAreaNode}),this.createFormNode(),this.formAreaNode.inject(this.formMaskNode||this.container||this.app.content,"after"),this.formAreaNode.fade("in"),this.setFormNodeSize(),this.setFormNodeSizeFun=this.setFormNodeSize.bind(this),this.app&&this.app.addEvent("resize",this.setFormNodeSizeFun),this.options.draggable&&this.formTopNode){var e=(this.container||this.app.content).getSize(),t=this.formAreaNode.getSize();this.formAreaNode.makeDraggable({handle:this.formTopNode,limit:{x:[0,e.x-t.x],y:[0,e.y-t.y]}})}},createFormNode:function(){this.formNode=new Element("div.formNode",{styles:this.css.formNode}).inject(this.formAreaNode),this.options.hasTop&&this.createTopNode(),this.options.hasIcon&&(this.formIconNode=new Element("div.formIconNode",{styles:this.isNew?this.css.formNewNode:this.css.formIconNode}).inject(this.formNode)),this.createContent(),this.options.hasBottom&&this.createBottomNode(),this._setCustom(),this.options.hasScroll&&MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.formTableContainer,{indent:!1,style:"default",where:"before",distance:30,friction:4,axis:{x:!1,y:!0},onScroll:function(e){}})}.bind(this))},createContent:function(){this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode),this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode),this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea,text:"loading..."}).inject(this.formTableContainer),this._createTableContent()},createBottomNode:function(){this.formBottomNode=new Element("div.formBottomNode",{styles:this.css.formBottomNode}).inject(this.formNode),this._createBottomContent()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title+(this.data.title?"-"+this.data.title:"")}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode),this._createTopContent())},_createTopContent:function(){},_createTableContent:function(){this.loadFormData()},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.lp.actionCancel}).inject(this.formBottomNode),(this.options.isNew||this.options.isEdited)&&(this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))),this.cancelActionNode.addEvent("click",function(e){this.cancel(e)}.bind(this))},loadFormData:function(){this.loadForm()},ok:function(e){this.fireEvent("queryOk");var t=this.form.getResult(!0,",",!0,!1,!0);t&&this._ok(t,function(e){"error"==e.type?this.app&&this.app.notice(e.message,"error"):(this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.explorer&&this.explorer.view&&this.explorer.view.reload(),this.app&&this.app.notice(this.isNew?this.lp.createSuccess:this.lp.updateSuccess,"success"),this.fireEvent("postOk"))}.bind(this))},loadForm:function(){(_self=this).form=new MForm(this.formTableArea,this.data,{style:"default",isEdited:this.isEdited||this.isNew,itemTemplate:this.getItemTemplate(this.lp)},this.app,this.css);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>",t=this.form.itemTemplate;for(i in t)e=e+"<tr>   <td styles='formTableTitle'><span lable='"+i+"'>"+t[i].text+"</td>   <td styles='formTableValue' item='"+i+"'></td></tr>";e+="</table>",this.formTableArea.set("html",e),this.form.load(),this.isNew||this.actions.getCustomerInfo(this.options.openId,function(e){var t=e.data,i=this.formTableArea.getElements("span");for(j in i)if(j<i.length&&null!=i[j].get("name")){var s=i[j].get("name");for(var n in t)n==s&&i[j].set("text",t[n])}}.bind(this)),this.formTableArea.getElements("textarea").setStyles({height:"100px",overflow:"auto",color:"#666666"}),this.formTableArea.getElements("input").setStyles({color:"#666666"})},getItemTemplate:function(e){return _self=this,{contactsname:{type:"text",notEmpty:!0,text:e.contactsname,value:this.customerData&&this.customerData.customername?this.customerData.customername:""},customername:{text:e.customername,notEmpty:!0,type:"openSelect"},cellphone:{text:e.cellphone,notEmpty:!0,type:"text"},telephone:{type:"text",text:e.telephone},email:{text:e.email,type:"text"},decision:{type:"select",notEmpty:!0,text:e.decision,value:_self.app.lp.contact.decision.value},post:{text:e.post,type:"text"},sex:{type:"select",text:e.sex,value:_self.app.lp.contact.sex.value},detailaddress:{text:e.detailaddress,type:"text"},nexttime:{text:e.nexttime,notEmpty:!0,attr:{id:"nexttime"},type:"datetime"},remark:{text:e.remark,type:"textarea"}}},getContactTemplate:function(e){return _self=this,{contactsname:{text:e.contactsname,type:"text",notEmpty:!0},customername:{text:e.customername,type:"readonly",notEmpty:!0},telephone:{type:"text",text:e.telephone},cellphone:{text:e.cellphone,type:"text"},email:{type:"text",text:e.email},decision:{type:"select",text:e.decision,value:this.app.lp.contact.decision.value},post:{text:e.post,type:"text"},sex:{type:"select",text:e.sex,value:this.app.lp.contact.sex.value},detailaddress:{text:e.detailaddress,type:"text"},nexttime:{text:e.nexttime,attr:{id:"nexttime"},type:"datetime"},remark:{text:e.remark,type:"textarea"}}},selectPerson:function(e,t,n,i){var s={type:"",types:["person"],values:this.configData,count:i,zIndex:5e4,onComplete:function(e){MWF.require("MWF.widget.O2Identity",function(){var i=[],s=[];this.configData=[],this.process=null,e.each(function(e){if("i"==e.data.distinguishedName.split("@").getLast().toLowerCase()){new MWF.widget.O2Identity(e.data,it.form.getItem("invitePersonList").container,{style:"room"});i.push(e.data.distinguishedName)}else{i.push(e.data.name),s.push(e.data.distinguishedName);var t={name:e.data.name,distinguishedName:e.data.distinguishedName,employee:e.data.employee};this.configData.push(t)}}.bind(this)),0==e.length?document.getElementById(t).innerHTML="+点击选择":(document.getElementById(t).innerHTML=i.join(","),""!=n&&(document.getElementById(n).innerHTML=s.join(",")))}.bind(this))}.bind(this)};new MWF.O2Selector(e,s)},getFormateTime:function(e){_self=this;var t=new Date(e);return t.getFullYear()+"-"+_self.checkTime(t.getMonth()+1)+"-"+_self.checkTime(t.getDate())+" "+_self.checkTime(t.getHours())+":"+_self.checkTime(t.getMinutes())+":"+_self.checkTime(t.getSeconds())},checkTime:function(e){return e<10&&(e="0"+e),e},toDecimal:function(e){if(""==e)return"";var t=parseFloat(e);return isNaN(t)?e:t=Math.round(100*e)/100},createCustomBottom:function(){this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.lp.actionConfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.ok(e)}.bind(this))},_ok:function(data,callback){var saveDataStr="";for(i in this.data)saveDataStr=saveDataStr+"'"+i+"':'"+this.data[i]+"',";saveDataStr="'{"+saveDataStr.replace(/'/g,'"')+"}'";var saveData=eval("("+saveDataStr.substring(1,saveDataStr.length-1)+")");this.app.createShade(),this.actions.saveClue(saveData,function(e){this.app.destroyShade(),this.app.notice(this.lp.saveSuccess,"success"),this.close(),this.fireEvent("reloadView",e)}.bind(this),function(e,t,i){this.app.showErrorMessage(e,t,i),this.app.destroyShade()}.bind(this))}}),MWF.xApplication.CRM.ContactsOpen.selectForm=new Class({Extends:MPopupForm,options:{style:"default",width:"700",height:"800",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:"选择客户",defaultCalendarId:"",callback:function(){console.log("you can do something when is ok")}.bind(this)},load:function(){this.cssPath="/x_component_CRM/$CustomerEdit/"+this.options.style+"/opencss.wcss",this.path="/x_component_CRM/$CustomerEdit/",this.type={},this._loadCss(),this.loadData()},_createTableContent:function(){var e=this.path+"customerSelect.json";this.form=new MWF.xApplication.CRM.ContactsOpen.SelectCustomer(this.formTableArea,null,this.app,this,{templateUrl:e,filterData:{},listPageName:"ListMyParticipate_customer"},{lp:{}}),this.form.load()},_ok:function(e,t){e&&("function"==typeof this.options.callback&&this.options.callback(),this.container.getElement("#customername").setProperty("value",e.customername),this.container.getElement("#customername").setProperty("cid",e.id),this.app.Customer=e,this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode&&this.formAreaNode.destroy(),this.fireEvent("postOk"))},loadData:function(){}}),MWF.xApplication.CRM.ContactsOpen.SelectCustomer=new Class({Extends:MWF.xApplication.CRM.Template.SelectForm,_getCurrentPageData:function(t,e,i,s){this.category=this.options.category;e||(e=10),i||(i=1);this.items.length&&this.items[this.items.length-1].data.id;var n=this.options.filterData||{};s&&(n={key:s}),this.actions.ListMyParticipate_customer(i,e,n,function(e){t&&t(e)}.bind(this))}});